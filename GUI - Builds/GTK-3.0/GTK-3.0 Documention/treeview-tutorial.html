<!--
SPDX-FileCopyrightText: GTK Development Team

SPDX-License-Identifier: LGPL-2.1-or-later
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Gtk &ndash; 3.0: Tree View Tutorial</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta charset="utf-8" />

  
  <meta property="og:type" content="website"/>

  
  <meta property="og:image:width" content="256"/>
  <meta property="og:image:height" content="256"/>
  <meta property="og:image:secure_url" content="gtk-logo.svg"/>
  <meta property="og:image:alt" content="Gtk-3.0"/>
  

  
  <meta property="og:title" content="Gtk: Tree View Tutorial"/>
  <meta property="og:description" content="Reference for Gtk-3.0: Tree View Tutorial"/>
  <meta name="twitter:title" content="Gtk: Tree View Tutorial"/>
  <meta name="twitter:description" content="Reference for Gtk-3.0: Tree View Tutorial"/>


  
  <meta name="twitter:card" content="summary"/>

  
  
  
  <link rel="search" type="application/opensearchdescription+xml" title="Gtk" href="opensearch.xml">
  
  

  <link rel="stylesheet" href="style.css" type="text/css" />

  

  
  <script src="urlmap.js"></script>
  
  
  <script src="fzy.js"></script>
  <script src="search.js"></script>
  
  <script src="main.js"></script>

  
</head>

<body>
  <div id="body-wrapper" tabindex="-1">

    <nav class="sidebar devhelp-hidden">
      
      <div class="section">
        <a href="index.html"><img src="gtk-logo.svg" class="logo"/></a>
      </div>
      
      
      <div class="search section">
        <form id="search-form" autocomplete="off">
          <input id="search-input" type="text" name="do-not-autocomplete" placeholder="Click, or press 's' to search" autocomplete="off"/>
        </form>
      </div>
      
      <div class="section namespace">
        <h3><a href="index.html">Gtk</a></h3>
        <p>API Version: 3.0</p>
        
        <p>Library Version: 3.24</p>
        
      </div>
      
      
      <div class="section generator">
        <p>Generated by <a href="https://gitlab.gnome.org/GNOME/gi-docgen">gi-docgen</a> 2024.2</p>
      </div>
    </nav>

    <button id="btn-to-top" class="hidden"><span class="up-arrow"></span></button>

    
<section id="main" class="content">
  
  <h4 id="title" style="display:flex;">
    Tree View Tutorial
    <a href="treeview-tutorial.html#title" class="anchor"></a>
    
  </h4>
  
  <section>
    <div class="docblock">
    <h1 id="tree-view-tutorial">Tree View Tutorial<a class="md-anchor" href="treeview-tutorial.html#tree-view-tutorial" title="Permanent link"></a></h1>
<p>This is a tutorial on how to use the <span class="caps">GTK</span> <code>GtkTreeView</code> widget through its C&nbsp;interface.</p>
<p>This tutorial is based on the <a href="http://scentric.net/tutorial"><span class="caps">GTK</span> 2.0 Tree View
Tutorial</a> by Tim-Philipp&nbsp;Müller.</p>
<h2 id="lists-and-trees-the-gtktreeview-widget">Lists and Trees: the <code>GtkTreeView</code> Widget<a class="md-anchor" href="treeview-tutorial.html#lists-and-trees-the-gtktreeview-widget" title="Permanent link"></a></h2>
<p><code>GtkTreeView</code> is a widget that displays single- or multi-columned lists and
trees. It replaces the old <span class="caps">GTK</span> 1.2 <code>GtkCList</code> and <code>GtkCTree</code> widgets. Even
though <code>GtkTreeView</code> is slightly harder to master than its predecessors, it
is so much more powerful and flexible that most application developers will
not want to miss it once they have come to know&nbsp;it.</p>
<p>The purpose of this chapter is not to provide an exhaustive documentation of
<code>GtkTreeView</code>—that is what the <span class="caps">API</span> documentation is for, which should be
read alongside with this tutorial. The goal is rather to present an
introduction to the most commonly-used aspects of <code>GtkTreeView</code>, and to
demonstrate how the various <code>GtkTreeView</code> components and concepts work
together. Furthermore, an attempt has been made to shed some light on custom
tree models and custom cell renderers, which seem to be often-mentioned, but
rarely&nbsp;explained.</p>
<p>Developers looking for a quick and dirty introduction that teaches them
everything they need to know in less than five paragraphs will not find it
here. In the author&#8217;s experience, developers who do not understand how the
tree view and the models work together will run into problems once they try
to modify the given examples, whereas developers who have worked with other
toolkits that employ the Model/View/Controller-design will find that the <span class="caps">API</span>
reference provides all the information they need to know in more condensed
form anyway. Those who disagree may jump straight to the working example
code of&nbsp;course.</p>
<p>Please note that the code examples in the following sections do not
necessarily demonstrate how <code>GtkTreeView</code> is used best in a particular
situation. There are different ways to achieve the same result, and the
examples merely show those different ways, so that developers are able to
decide which one is most suitable for the task at&nbsp;hand.</p>
<h3 id="hello-world">Hello World<a class="md-anchor" href="treeview-tutorial.html#hello-world" title="Permanent link"></a></h3>
<p>For the impatient, here is a small tree view &#8216;Hello World&#8217;&nbsp;program:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtk/gtk.h&gt;</span>

<span class="k">enum</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">COL_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="n">COL_AGE</span><span class="p">,</span>
<span class="w">  </span><span class="n">NUM_COLS</span>
<span class="p">}</span><span class="w"> </span><span class="p">;</span>


<span class="k">static</span><span class="w"> </span><span class="n">GtkTreeModel</span><span class="w"> </span><span class="o">*</span>
<span class="nf">create_and_fill_model</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkListStore</span><span class="w"> </span><span class="o">*</span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_list_store_new</span><span class="w"> </span><span class="p">(</span><span class="n">NUM_COLS</span><span class="p">,</span>
<span class="w">                                            </span><span class="n">G_TYPE_STRING</span><span class="p">,</span>
<span class="w">                                            </span><span class="n">G_TYPE_UINT</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Append a row and fill in some data */</span>
<span class="w">  </span><span class="n">GtkTreeIter</span><span class="w"> </span><span class="n">iter</span><span class="p">;</span>
<span class="w">  </span><span class="n">gtk_list_store_append</span><span class="w"> </span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_list_store_set</span><span class="w"> </span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span>
<span class="w">                      </span><span class="n">COL_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Heinz El-Mann&quot;</span><span class="p">,</span>
<span class="w">                      </span><span class="n">COL_AGE</span><span class="p">,</span><span class="w"> </span><span class="mi">51</span><span class="p">,</span>
<span class="w">                      </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* append another row and fill in some data */</span>
<span class="w">  </span><span class="n">gtk_list_store_append</span><span class="w"> </span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_list_store_set</span><span class="w"> </span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span>
<span class="w">                      </span><span class="n">COL_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jane Doe&quot;</span><span class="p">,</span>
<span class="w">                      </span><span class="n">COL_AGE</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span>
<span class="w">                      </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* ... and a third row */</span>
<span class="w">  </span><span class="n">gtk_list_store_append</span><span class="w"> </span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_list_store_set</span><span class="w"> </span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span>
<span class="w">                      </span><span class="n">COL_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Joe Bungop&quot;</span><span class="p">,</span>
<span class="w">                      </span><span class="n">COL_AGE</span><span class="p">,</span><span class="w"> </span><span class="mi">91</span><span class="p">,</span>
<span class="w">                      </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">GTK_TREE_MODEL</span><span class="w"> </span><span class="p">(</span><span class="n">store</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span>
<span class="nf">create_view_and_model</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_new</span><span class="w"> </span><span class="p">();</span>

<span class="w">  </span><span class="n">GtkCellRenderer</span><span class="w"> </span><span class="o">*</span><span class="n">renderer</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/* --- Column #1 --- */</span>
<span class="w">  </span><span class="n">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_cell_renderer_text_new</span><span class="w"> </span><span class="p">();</span>
<span class="w">  </span><span class="n">gtk_tree_view_insert_column_with_attributes</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="w"> </span><span class="p">(</span><span class="n">view</span><span class="p">),</span>
<span class="w">                                               </span><span class="mi">-1</span><span class="p">,</span><span class="w">      </span>
<span class="w">                                               </span><span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">                                               </span><span class="n">renderer</span><span class="p">,</span>
<span class="w">                                               </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">COL_NAME</span><span class="p">,</span>
<span class="w">                                               </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* --- Column #2 --- */</span>
<span class="w">  </span><span class="n">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_cell_renderer_text_new</span><span class="w"> </span><span class="p">();</span>
<span class="w">  </span><span class="n">gtk_tree_view_insert_column_with_attributes</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="w"> </span><span class="p">(</span><span class="n">view</span><span class="p">),</span>
<span class="w">                                               </span><span class="mi">-1</span><span class="p">,</span><span class="w">      </span>
<span class="w">                                               </span><span class="s">&quot;Age&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">                                               </span><span class="n">renderer</span><span class="p">,</span>
<span class="w">                                               </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">COL_AGE</span><span class="p">,</span>
<span class="w">                                               </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="n">GtkTreeModel</span><span class="w"> </span><span class="o">*</span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_and_fill_model</span><span class="w"> </span><span class="p">();</span>

<span class="w">  </span><span class="n">gtk_tree_view_set_model</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="w"> </span><span class="p">(</span><span class="n">view</span><span class="p">),</span><span class="w"> </span><span class="n">model</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* The tree view has acquired its own reference to the</span>
<span class="cm">   *  model, so we can drop ours. That way the model will</span>
<span class="cm">   *  be freed automatically when the tree view is destroyed</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="n">g_object_unref</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">gtk_init</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">argv</span><span class="p">);</span>

<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_window_new</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WINDOW_TOPLEVEL</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;destroy&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">gtk_main_quit</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_view_and_model</span><span class="w"> </span><span class="p">();</span>

<span class="w">  </span><span class="n">gtk_container_add</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_CONTAINER</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">),</span><span class="w"> </span><span class="n">view</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_widget_show_all</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_main</span><span class="w"> </span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="components-model-renderer-column-view">Components: Model, Renderer, Column, View<a class="md-anchor" href="treeview-tutorial.html#components-model-renderer-column-view" title="Permanent link"></a></h2>
<p>The most important concept underlying <code>GtkTreeView</code> is that of complete
separation between data and how that data is displayed on the screen. This
is commonly known as Model/View/Controller-design (<span class="caps">MVC</span>). Data of various
type (strings, numbers, images, etc.) is stored in a &#8216;model&#8217;. The &#8216;view&#8217; is
then told which data to display, where to display it, and how to display it.
One of the advantages of this approach is that you can have multiple views
that display the same data (a directory tree for example) in different ways,
or in the same way multiple times, with only one copy of the underlying
data. This avoids duplication of data and programming effort if the same
data is re-used in different contexts. Also, when the data in the model is
updated, all views automatically get updated as&nbsp;well.</p>
<p>So, while <code>GtkTreeModel</code> is used to store data, there are other components
that determine which data is displayed in the <code>GtkTreeView</code> and how it is
displayed. These components are <code>GtkTreeViewColumn</code> and <code>GtkCellRenderer</code>. A
<code>GtkTreeView</code> is made up of tree view columns. These are the columns that
users perceive as columns. They have a clickable column header with a column
title that can be hidden, and can be resized and sorted. Tree view columns
do not display any data, they are only used as a device to represent the
user-side of the tree view (sorting etc.) and serve as packing widgets for
the components that do the actual rendering of data onto the screen, namely
the <code>GtkCellRenderer</code> family of objects (I call them &#8216;objects&#8217; because they
do not inherit from <code>GtkWidget</code>). There are a number of different cell
renderers that specialise in rendering certain data like strings, pixbufs,
or toggle buttons. More on this&nbsp;later.</p>
<p>Cell renderers are packed into tree view columns to display data. A tree
view column needs to contain at least one cell renderer, but can contain
multiple cell renderers. For example, if one wanted to display a &#8216;Filename&#8217;
column where each filename has a little icon on the left indicating the file
type, one would pack a <code>GtkCellRendererPixbuf</code> and a <code>GtkCellRendererText</code>
into one tree view column. Packing renderers into a tree view column is
similar to packing widgets into a <code>GtkBox</code>.</p>
<h2 id="models-for-data-storage-gtkliststore-and-gtktreestore">Models for Data Storage: <code>GtkListStore</code> and <code>GtkTreeStore</code><a class="md-anchor" href="treeview-tutorial.html#models-for-data-storage-gtkliststore-and-gtktreestore" title="Permanent link"></a></h2>
<p>It is important to realise what <code>GtkTreeModel</code> is and what it is not.
<code>GtkTreeModel</code> is basically just an &#8216;interface&#8217; to the data store, meaning
that it is a standardised set of functions that allows a <code>GtkTreeView</code>
widget (and the application programmer) to query certain characteristics of
a data store, for example how many rows there are, which rows have children,
and how many children a particular row has. It also provides functions to
retrieve data from the data store, and tell the tree view what type of data
is stored in the model. Every data store must implement the <code>GtkTreeModel</code>
interface and provide these functions, which you can use by casting a store
to a tree model with <code>GTK_TREE_MODEL(store)</code>. <code>GtkTreeModel</code> itself only
provides a way to query a data store&#8217;s characteristics and to retrieve
existing data, it does not provide a way to remove or add rows to the store
or put data into the store. This is done using the specific store&#8217;s&nbsp;functions.</p>
<p><span class="caps">GTK</span> comes with two built-in data stores (models): <code>GtkListStore</code> and
<code>GtkTreeStore</code>. As the names imply, <code>GtkListStore</code> is used for simple lists
of data items where items have no hierarchical parent-child relationships,
and <code>GtkTreeStore</code> is used for tree-like data structures, where items can
have parent-child relationships. A list of files in a directory would be an
example of a simple list structure, whereas a directory tree is an example
for a tree structure. A list is basically just a special case of a tree with
none of the items having any children, so one could use a tree store to
maintain a simple list of items as well. The only reason <code>GtkListStore</code>
exists is in order to provide an easier interface that does not need to
cater for child-parent relationships, and because a simple list model can be
optimised for the special case where no children exist, which makes it
faster and more&nbsp;efficient.</p>
<p><code>GtkListStore</code> and <code>GtkTreeStore</code> should cater for most types of data an
application developer might want to display in a <code>GtkTreeView</code>. However, it
should be noted that <code>GtkListStore</code> and <code>GtkTreeStore</code> have been designed
with flexibility in mind. If you plan to store a lot of data, or have a
large number of rows, you should consider implementing your own custom model
that stores and manipulates data your own way and implements the
<code>GtkTreeModel</code> interface. This will not only be more efficient, but probably
also lead to saner code in the long run, and give you more control over your
data. See below for more details on how to implement custom&nbsp;models.</p>
<p>Tree model implementations like <code>GtkListStore</code> and <code>GtkTreeStore</code> will take
care of the view side for you once you have configured the <code>GtkTreeView</code> to
display what you want. If you change data in the store, the model will
notify the tree view and your data display will be updated. If you add or
remove rows, the model will also notify the store, and your row will appear
in or disappear from the view as&nbsp;well.</p>
<h3 id="how-data-is-organised-in-a-store">How Data is Organised in a Store<a class="md-anchor" href="treeview-tutorial.html#how-data-is-organised-in-a-store" title="Permanent link"></a></h3>
<p>A model (data store) has model columns and rows. While a tree view will
display each row in the model as a row in the view, the model&#8217;s columns are
not to be confused with a view&#8217;s columns. A model column represents a
certain data field of an item that has a fixed data type. You need to know
what kind of data you want to store when you create a list store or a tree
store, as you can not add new fields later&nbsp;on.</p>
<p>For example, we might want to display a list of files. We would create a
list store with two fields: a field that stores the filename (i.e. a string)
and a field that stores the file size (i.e. an unsigned integer). The
filename would be stored in column 0 of the model, and the file size would
be stored in column 1 of the model. For each file we would add a row to the
list store, and set the row&#8217;s fields to the filename and the file&nbsp;size.</p>
<p>The GLib type system (GType) is used to indicate what type of data is stored
in a model column. These are the most commonly used&nbsp;types:</p>
<ul>
<li><code>G_TYPE_BOOLEAN</code></li>
<li><code>G_TYPE_INT</code>, <code>G_TYPE_UINT</code></li>
<li><code>G_TYPE_LONG</code>, <code>G_TYPE_ULONG</code>, <code>G_TYPE_INT64</code>, <code>G_TYPE_UINT64</code></li>
<li><code>G_TYPE_FLOAT</code>, <code>G_TYPE_DOUBLE</code></li>
<li><code>G_TYPE_STRING</code> - stores a string in the store (makes a copy of the
  original&nbsp;string)</li>
<li><code>G_TYPE_POINTER</code> - stores a pointer value (does not copy any data into the
  store, just stores the pointer&nbsp;value!)</li>
<li><code>G_TYPE_OBJECT</code>, <code>GDK_TYPE_PIXBUF</code> - stores an object in the store (acquires
  a reference on the object&nbsp;instance)</li>
</ul>
<p>You do not need to understand the type system, it will usually suffice to
know the above types, so you can tell a list store or tree store what kind
of data you want to store. Advanced users can derive their own types from
the fundamental GLib types. For simple structures you could register a new
boxed type for example, but that is usually not necessary. <code>G_TYPE_POINTER</code>
will often do as well, you will just need to take care of memory allocation
and freeing yourself&nbsp;then.</p>
<p>Storing GObject-derived types (most <code>GDK_TYPE_FOO</code> and <code>GTK_TYPE_FOO</code>) is a
special case that is dealt with further&nbsp;below.</p>
<p>Here is an example of how to create a list&nbsp;store:</p>
<div class="codehilite"><pre><span></span><code><span class="n">GtkListStore</span><span class="w"> </span><span class="o">*</span><span class="n">list_store</span><span class="p">;</span>

<span class="n">list_store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_list_store_new</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_STRING</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_UINT</span><span class="p">);</span>
</code></pre></div>

<p>This creates a new list store with two columns. Column 0 stores a string and
column 1 stores an unsigned integer for each row. At this point the model
has no rows yet of course. Before we start to add rows, let&#8217;s have a look at
the different ways used to refer to a particular&nbsp;row.</p>
<h3 id="gtktreeiter-gtktreepath-gtktreerowreference"><code>GtkTreeIter</code>, <code>GtkTreePath</code>, <code>GtkTreeRowReference</code><a class="md-anchor" href="treeview-tutorial.html#gtktreeiter-gtktreepath-gtktreerowreference" title="Permanent link"></a></h3>
<p>There are different ways to refer to a specific row. The two you will have
to deal with are <code>GtkTreeIter</code> and <code>GtkTreePath</code>.</p>
<h4 id="gtktreepath"><code>GtkTreePath</code><a class="md-anchor" href="treeview-tutorial.html#gtktreepath" title="Permanent link"></a></h4>
<p>A <code>GtkTreePath</code> is a comparatively straight-forward way to describe the
logical position of a row in the model. As a GtkTreeView always displays all
rows in a model, a tree path always describes the same row in both model and&nbsp;view.</p>
<p><img alt="" src="treepath.png" /></p>
<p>The picture shows the tree path in string form next to the label. Basically,
it just counts the children from the imaginary root of the tree view. An
empty tree path string would specify that imaginary invisible root. Now
&#8216;Songs&#8217; is the first child (from the root) and thus its tree path is just
&#8220;0&#8221;. &#8216;Videos&#8217; is the second child from the root, and its tree path is &#8220;1&#8221;.
&#8216;oggs&#8217; is the second child of the first item from the root, so its tree path
is &#8220;0:1&#8221;. So you just count your way down from the root to the row in
question, and you get your tree&nbsp;path.</p>
<p>To clarify this, a tree path of &#8220;3:9:4:1&#8221; would basically mean in human
language (attention - this is not what it really means!) something along the
lines of: go to the 3rd top-level row. Now go to the 9th child of that row.
Proceed to the 4th child of the previous row. Then continue to the 1st child
of that. Now you are at the row this tree path describes. This is not what
it means for <span class="caps">GTK</span> though. While humans start counting at 1, computers usually
start counting at 0. So the real meaning of the tree path &#8220;3:9:4:1&#8221; is: Go
to the 4th top-level row. Then go to the 10th child of that row. Pick the
5th child of that row. Then proceed to the 2nd child of the previous row.
Now you are at the row this tree path describes.&nbsp;:)</p>
<p>The implication of this way of referring to rows is as follows: if you
insert or delete rows in the middle or if the rows are resorted, a tree path
might suddenly refer to a completely different row than it referred to
before the insertion/deletion/resorting. This is important to keep in mind.
(See the section on <code>GtkTreeRowReference</code>s below for a tree path that keeps
updating itself to make sure it always refers to the same row when the model&nbsp;changes).</p>
<p>This effect becomes apparent if you imagine what would happen if we were to
delete the row entitled &#8216;funny clips&#8217; from the tree in the above picture.
The row &#8216;movie trailers&#8217; would suddenly be the first and only child of
&#8216;clips&#8217;, and be described by the tree path that formerly belonged to &#8216;funny
clips&#8217;, ie.&nbsp;&#8220;1:0:0&#8221;.</p>
<p>You can get a new <code>GtkTreePath</code> from a path in string form using
<code>gtk_tree_path_new_from_string()</code>, and you can convert a given <code>GtkTreePath</code>
into its string notation with <code>gtk_tree_path_to_string()</code>. Usually you will
rarely have to handle the string notation, it is described here merely to
demonstrate the concept of tree&nbsp;paths.</p>
<p>Instead of the string notation, <code>GtkTreePath</code> uses an integer array
internally. You can get the depth (i.e. the nesting level) of a tree path
with <code>gtk_tree_path_get_depth()</code>. A depth of 0 is the imaginary invisible
root node of the tree view and model. A depth of 1 means that the tree path
describes a top-level row. As lists are just trees without child nodes, all
rows in a list always have tree paths of depth 1.
<code>gtk_tree_path_get_indices()</code> returns the internal integer array of a tree
path. You will rarely need to operate with those&nbsp;either.</p>
<p>If you operate with tree paths, you are most likely to use a given tree
path, and use functions like <code>gtk_tree_path_up()</code>, <code>gtk_tree_path_down()</code>,
<code>gtk_tree_path_next()</code>, <code>gtk_tree_path_prev()</code>,
<code>gtk_tree_path_is_ancestor()</code>, or <code>gtk_tree_path_is_descendant()</code>. Note that
this way you can construct and operate on tree paths that refer to rows that
do not exist in model or view! The only way to check whether a path is valid
for a specific model (i.e. the row described by the path exists) is to
convert the path into an iterator using <code>gtk_tree_model_get_iter()</code>.</p>
<p><code>GtkTreePath</code> is an opaque structure, with its details hidden from the
compiler. If you need to make a copy of a tree path, use
<code>gtk_tree_path_copy()</code>.</p>
<h4 id="gtktreeiter"><code>GtkTreeIter</code><a class="md-anchor" href="treeview-tutorial.html#gtktreeiter" title="Permanent link"></a></h4>
<p>Another way to refer to a row in a list or tree is GtkTreeIter. A tree iter
is just a structure that contains a couple of pointers that mean something
to the model you are using. Tree iters are used internally by models, and
they often contain a direct pointer to the internal data of the row in
question. You should never look at the content of a tree iter and you must
not modify it directly&nbsp;either.</p>
<p>All tree models (and therefore also GtkListStore and GtkTreeStore) must
support the GtkTreeModel functions that operate on tree iters (e.g. get the
tree iter for the first child of the row specified by a given tree iter, get
the first row in the list/tree, get the n-th child of a given iter etc.).
Some of these functions&nbsp;are:</p>
<ul>
<li><code>gtk_tree_model_get_iter_first()</code>: sets the given iter to the first
  top-level item in the list or&nbsp;tree</li>
<li><code>gtk_tree_model_iter_next()</code>: sets the given iter to the next item at the
  current level in a list or&nbsp;tree.</li>
<li><code>gtk_tree_model_iter_children()</code>: sets the first given iter to the first
  child of the row referenced by the second iter (not very useful for lists,
  mostly useful for&nbsp;trees).</li>
<li><code>gtk_tree_model_iter_n_children()</code>: returns the number of children the row
  referenced by the provided iter has. If you pass <code>NULL</code> instead of a pointer
  to an iter structure, this function will return the number of top-level
  rows. You can also use this function to count the number of items in a
  list&nbsp;store.</li>
<li><code>gtk_tree_model_iter_nth_child()</code>: sets the first iter to the n-th child
  of the row referenced by the second iter. If you pass <code>NULL</code> instead of a
  pointer to an iter structure as the second iter, you can get the first
  iter set to the n-th row of a&nbsp;list.</li>
<li><code>gtk_tree_model_iter_parent()</code>: sets the first iter to the parent of the
  row referenced by the second iter (does nothing for lists, only useful for&nbsp;trees). </li>
</ul>
<p>Almost all of those functions return <code>TRUE</code> if the requested operation
succeeded, and return <code>FALSE</code> otherwise. There are more functions that operate
on iters. Check out the <code>GtkTreeModel</code> <span class="caps">API</span> reference for&nbsp;details.</p>
<p>You might notice that there is no <code>gtk_tree_model_iter_prev()</code>. This is
unlikely to be implemented for a variety of reasons. It should be fairly
simple to write a helper function that provides this functionality though
once you have read this&nbsp;section.</p>
<p>Tree iters are used to retrieve data from the store, and to put data into
the store. You also get a tree iter as result if you add a new row to the
store using <code>gtk_list_store_append()</code> or <code>gtk_tree_store_append()</code>.</p>
<p>Tree iters are often only valid for a short time, and might become invalid
if the store changes with some models. It is therefore usually a bad idea to
store tree iters, unless you really know what you are doing. You can use
<code>gtk_tree_model_get_flags()</code> to get a model&#8217;s flags, and check whether the
<code>GTK_TREE_MODEL_ITERS_PERSIST</code> flag is set (in which case a tree iter will be
valid as long as a row exists), yet still it is not advisable to store iter
structures unless you really mean to do that. There is a better way to keep
track of a row over time: <code>GtkTreeRowReference</code>.</p>
<h4 id="gtktreerowreference"><code>GtkTreeRowReference</code><a class="md-anchor" href="treeview-tutorial.html#gtktreerowreference" title="Permanent link"></a></h4>
<p>A <code>GtkTreeRowReference</code> is basically an object that takes a tree path, and
watches a model for changes. If anything changes, like rows getting inserted
or removed, or rows getting re-ordered, the tree row reference object will
keep the given tree path up to date, so that it always points to the same
row as before. In case the given row is removed, the tree row reference will
become&nbsp;invalid.</p>
<p>A new tree row reference can be created with <code>gtk_tree_row_reference_new()</code>,
given a model and a tree path. After that, the tree row reference will keep
updating the path whenever the model changes. The current tree path of the
row originally refered to when the tree row reference was created can be
retrieved with <code>gtk_tree_row_reference_get_path()</code>. If the row has been
deleted, <code>NULL</code> will be returned instead of of a tree path. The tree path
returned is a copy, so it will need to be freed with <code>gtk_tree_path_free()</code>
when it is no longer&nbsp;needed.</p>
<p>You can check whether the row referenced still exists with
<code>gtk_tree_row_reference_valid()</code>, and free it with when no longer&nbsp;needed.</p>
<p>For the curious: internally, the tree row reference connects to the tree
model&#8217;s &#8220;row-inserted&#8221;, &#8220;row-deleted&#8221;, and &#8220;rows-reordered&#8221; signals and
updates its internal tree path whenever something happened to the model that
affects the position of the referenced&nbsp;row.</p>
<p>Note that using tree row references entails a small overhead. This is hardly
significant for 99.9% of all applications out there, but when you have
multiple thousands of rows and/or row references, this might be something to
keep in mind (because whenever rows are inserted, removed, or reordered, a
signal will be sent out and processed for each row&nbsp;reference).</p>
<p>If you have read the tutorial only up to here so far, it is hard to explain
really what tree row references are good for. An example where tree row
references come in handy can be found further below in the section on
removing multiple rows in one&nbsp;go.</p>
<p>In practice, a programmer can either use tree row references to keep track
of rows over time, or store tree iters directly (if, and only if, the model
has persistent iters). Both GtkListStore and GtkTreeStore have persistent
iters, so storing iters is possible. However, using tree row references is
definitively the Right Way(tm) to do things, even though it comes with some
overhead that might impact performance in case of trees that have a very
large number of rows (in that case it might be preferable to write a custom
model anyway though). Especially beginners might find it easier to handle
and store tree row references than iters, because tree row references are
handled by pointer value, which you can easily add to a GList or pointer
array, while it is easy to store tree iters in a wrong&nbsp;way.</p>
<h4 id="usage">Usage<a class="md-anchor" href="treeview-tutorial.html#usage" title="Permanent link"></a></h4>
<p>Tree iters can easily be converted into tree paths using
<code>gtk_tree_model_get_path()</code>, and tree paths can easily be converted into tree
iters using <code>gtk_tree_model_get_iter()</code>. Here is an example that shows how to
get the iter from the tree path that is passed to us from the tree view in
the &#8220;row-activated&#8221; signal callback. We need the iter here to retrieve data
from the&nbsp;store:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">void</span>
<span class="nf">onTreeViewRowActivated</span><span class="w"> </span><span class="p">(</span><span class="n">GtkTreeView</span><span class="w"> </span><span class="o">*</span><span class="n">view</span><span class="p">,</span>
<span class="w">                        </span><span class="n">GtkTreePath</span><span class="w"> </span><span class="o">*</span><span class="n">path</span><span class="p">,</span>
<span class="w">                        </span><span class="n">GtkTreeViewColumn</span><span class="w"> </span><span class="o">*</span><span class="n">col</span><span class="p">,</span>
<span class="w">                        </span><span class="n">gpointer</span><span class="w"> </span><span class="n">userdata</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkTreeModel</span><span class="w"> </span><span class="o">*</span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_get_model</span><span class="p">(</span><span class="n">view</span><span class="p">);</span>

<span class="w">  </span><span class="n">GtkTreeIter</span><span class="w"> </span><span class="n">iter</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_tree_model_get_iter</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">;</span>

<span class="w">      </span><span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="n">COL_NAME</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">      </span><span class="n">g_print</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;The row containing the name &#39;%s&#39; has been double-clicked.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>

<span class="w">      </span><span class="n">g_free</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Tree row references reveal the current path of a row with
<code>gtk_tree_row_reference_get_path()</code>. There is no direct way to get a tree
iter from a tree row reference, you have to retrieve the tree row
reference&#8217;s path first and then convert that into a tree&nbsp;iter.</p>
<p>As tree iters are only valid for a short time, they are usually allocated on
the stack, as in the following example (keep in mind that GtkTreeIter is
just a structure that contains data fields you do not need to know anything&nbsp;about):</p>
<div class="codehilite"><pre><span></span><code><span class="kt">void</span>
<span class="nf">traverse_list_store</span><span class="w"> </span><span class="p">(</span><span class="n">GtkListStore</span><span class="w"> </span><span class="o">*</span><span class="n">liststore</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkTreeIter</span><span class="w"> </span><span class="n">iter</span><span class="p">;</span>
<span class="w">  </span><span class="n">gboolean</span><span class="w"> </span><span class="n">valid</span><span class="p">;</span>

<span class="w">  </span><span class="n">g_return_if_fail</span><span class="w"> </span><span class="p">(</span><span class="n">liststore</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Get first row in list store */</span>
<span class="w">  </span><span class="n">valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_model_get_iter_first</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">liststore</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>

<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">valid</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="cm">/* ... do something with that row using the iter ...          */</span>
<span class="w">      </span><span class="cm">/* (Here column 0 of the list store is of type G_TYPE_STRING) */</span>
<span class="w">      </span><span class="n">gtk_list_store_set</span><span class="p">(</span><span class="n">liststore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Joe&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">      </span><span class="cm">/* Make iter point to the next row in the list store */</span>
<span class="w">      </span><span class="n">valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_model_iter_next</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">liststore</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>The code above asks the model to fill the iter structure to make it point to
the first row in the list store. If there is a first row and the list store
is not empty, the iter will be set, and <code>gtk_tree_model_get_iter_first()</code>
will return <code>TRUE</code>. If there is no first row, it will just return <code>FALSE</code>. If a
first row exists, the while loop will be entered and we change some of the
first row&#8217;s data. Then we ask the model to make the given iter point to the
next row, until there are no more rows, which is when
<code>gtk_tree_model_iter_next()</code> returns <code>FALSE</code>. Instead of traversing the list
store we could also have used <code>gtk_tree_model_foreach()</code>.</p>
<h3 id="adding-rows-to-a-store">Adding Rows to a Store<a class="md-anchor" href="treeview-tutorial.html#adding-rows-to-a-store" title="Permanent link"></a></h3>
<h4 id="adding-rows-to-a-list-store">Adding Rows to a List Store<a class="md-anchor" href="treeview-tutorial.html#adding-rows-to-a-list-store" title="Permanent link"></a></h4>
<p>Rows are added to a list store with <code>gtk_list_store_append()</code>. This will
insert a new empty row at the end of the list. There are other functions,
documented in the GtkListStore <span class="caps">API</span> reference, that give you more control
about where exactly the new row is inserted, but as they work very similar
to <code>gtk_list_store_append()</code> and are fairly straight-forward to use, we will
not deal with them&nbsp;here.</p>
<p>Here is a simple example of how to create a list store and add some (empty)
rows to&nbsp;it:</p>
<div class="codehilite"><pre><span></span><code><span class="n">GtkListStore</span><span class="w"> </span><span class="o">*</span><span class="n">liststore</span><span class="p">;</span>
<span class="n">GtkTreeIter</span><span class="w"> </span><span class="n">iter</span><span class="p">;</span>

<span class="n">liststore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_list_store_new</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_STRING</span><span class="p">);</span>

<span class="cm">/* Append an empty row to the list store. Iter will point to the new row */</span>
<span class="n">gtk_list_store_append</span><span class="p">(</span><span class="n">liststore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>

<span class="cm">/* Append an empty row to the list store. Iter will point to the new row */</span>
<span class="n">gtk_list_store_append</span><span class="p">(</span><span class="n">liststore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>

<span class="cm">/* Append an empty row to the list store. Iter will point to the new row */</span>
<span class="n">gtk_list_store_append</span><span class="p">(</span><span class="n">liststore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>
</code></pre></div>

<p>This in itself is not very useful yet of course. We will add data to the
rows in the next&nbsp;section.</p>
<h4 id="adding-rows-to-a-tree-store">Adding Rows to a Tree Store<a class="md-anchor" href="treeview-tutorial.html#adding-rows-to-a-tree-store" title="Permanent link"></a></h4>
<p>Adding rows to a tree store works similar to adding rows to a list store,
only that <code>gtk_tree_store_append()</code> is the function to use and one more argument
is required, namely the tree iter to the parent of the row to insert. If you
supply <code>NULL</code> instead of providing the tree iter of another row, a new
top-level row will be inserted. If you do provide a parent tree iter, the
new empty row will be inserted after any already existing children of the
parent. Again, there are other ways to insert a row into the tree store and
they are documented in the GtkTreeStore <span class="caps">API</span> reference manual. Another short&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code><span class="n">GtkListStore</span><span class="w"> </span><span class="o">*</span><span class="n">treestore</span><span class="p">;</span>
<span class="n">GtkTreeIter</span><span class="w"> </span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="n">child</span><span class="p">;</span>

<span class="n">treestore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_store_new</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_STRING</span><span class="p">);</span>

<span class="cm">/* Append an empty top-level row to the tree store.</span>
<span class="cm"> *  Iter will point to the new row */</span>
<span class="n">gtk_tree_store_append</span><span class="p">(</span><span class="n">treestore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="cm">/* Append another empty top-level row to the tree store.</span>
<span class="cm"> *  Iter will point to the new row */</span>
<span class="n">gtk_tree_store_append</span><span class="p">(</span><span class="n">treestore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="cm">/* Append a child to the row we just added.</span>
<span class="cm"> *  Child will point to the new row */</span>
<span class="n">gtk_tree_store_append</span><span class="p">(</span><span class="n">treestore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">child</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>

<span class="cm">/* Get the first row, and add a child to it as well (could have been done</span>
<span class="cm"> *  right away earlier of course, this is just for demonstration purposes) */</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_tree_model_get_iter_first</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">treestore</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">))</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* Child will point to new row */</span>
<span class="w">    </span><span class="n">gtk_tree_store_append</span><span class="p">(</span><span class="n">treestore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">child</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="k">else</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">g_error</span><span class="p">(</span><span class="s">&quot;Oops, we should have a first row in the tree store!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</code></pre></div>

<h4 id="speed-issues-when-adding-a-lot-of-rows">Speed Issues when Adding a Lot of Rows<a class="md-anchor" href="treeview-tutorial.html#speed-issues-when-adding-a-lot-of-rows" title="Permanent link"></a></h4>
<p>A common scenario is that a model needs to be filled with a lot of rows at
some point, either at start-up, or when some file is opened. An equally
common scenario is that this takes an awfully long time even on powerful
machines once the model contains more than a couple of thousand rows, with
an exponentially decreasing rate of insertion. As already pointed out above,
writing a custom model might be the best thing to do in this case.
Nevertheless, there are some things you can do to work around this problem
and speed things up a bit even with the stock <span class="caps">GTK</span>&nbsp;models:</p>
<p>Firstly, you should detach your list store or tree store from the tree view
before doing your mass insertions, then do your insertions, and only connect
your store to the tree view again when you are done with your insertions.
Like&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_get_model</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">view</span><span class="p">));</span>

<span class="n">g_object_ref</span><span class="p">(</span><span class="n">model</span><span class="p">);</span><span class="w"> </span><span class="cm">/* Make sure the model stays with us after the tree view unrefs it */</span>

<span class="n">gtk_tree_view_set_model</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">view</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"> </span><span class="cm">/* Detach model from view */</span>

<span class="c1">// ... insert a couple of thousand rows ...</span>

<span class="n">gtk_tree_view_set_model</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">view</span><span class="p">),</span><span class="w"> </span><span class="n">model</span><span class="p">);</span><span class="w"> </span><span class="cm">/* Re-attach model to view */</span>

<span class="n">g_object_unref</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
</code></pre></div>

<p>Secondly, you should make sure that sorting is disabled while you are doing
your mass insertions, otherwise your store might be resorted after each and
every single row insertion, which is going to be everything but&nbsp;fast.</p>
<p>Thirdly, you should not keep around a lot of tree row references if you have
so many rows, because with each insertion (or removal) every single tree row
reference will check whether its path needs to be updated or&nbsp;not.</p>
<h3 id="manipulating-row-data">Manipulating Row Data<a class="md-anchor" href="treeview-tutorial.html#manipulating-row-data" title="Permanent link"></a></h3>
<p>Adding empty rows to a data store is not terribly exciting, so let&#8217;s see how
we can add or change data in the&nbsp;store.</p>
<p><code>gtk_list_store_set()</code> and <code>gtk_tree_store_set()</code> are used to manipulate a
given row&#8217;s data. There is also <code>gtk_list_store_set_value()</code> and
<code>gtk_tree_store_set_value()</code>, but those should only be used by people
familiar with GLib&#8217;s GValue&nbsp;system.</p>
<p>Both <code>gtk_list_store_set()</code> and <code>gtk_tree_store_set()</code> take a variable
number of arguments, and must be terminated with a -1 argument. The first
two arguments are a pointer to the model, and the iter pointing to the row
whose data we want to change. They are followed by a variable number of
(column, data) argument pairs, terminated by a -1. The column refers to the
model column number and is usually an enum value (to make the code more
readable and to make changes easier). The data should be of the same data
type as the model&nbsp;column.</p>
<p>Here is an example where we create a store that stores two strings and one
integer for each&nbsp;row:</p>
<div class="codehilite"><pre><span></span><code><span class="k">enum</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">COL_FIRST_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="n">COL_LAST_NAME</span><span class="p">,</span>
<span class="w">  </span><span class="n">COL_YEAR_BORN</span><span class="p">,</span>
<span class="w">  </span><span class="n">NUM_COLS</span>
<span class="p">};</span>

<span class="n">GtkListStore</span><span class="w"> </span><span class="o">*</span><span class="n">liststore</span><span class="p">;</span>
<span class="n">GtkTreeIter</span><span class="w">   </span><span class="n">iter</span><span class="p">;</span>

<span class="n">liststore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_list_store_new</span><span class="p">(</span><span class="n">NUM_COLS</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_STRING</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_STRING</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_UINT</span><span class="p">);</span>

<span class="cm">/* Append an empty row to the list store. Iter will point to the new row */</span>
<span class="n">gtk_list_store_append</span><span class="p">(</span><span class="n">liststore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>

<span class="cm">/* Fill fields with some data */</span>
<span class="n">gtk_list_store_set</span><span class="w"> </span><span class="p">(</span><span class="n">liststore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span>
<span class="w">                    </span><span class="n">COL_FIRST_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Joe&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">COL_LAST_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Average&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">COL_YEAR_BORN</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">guint</span><span class="p">)</span><span class="w"> </span><span class="mi">1970</span><span class="p">,</span>
<span class="w">                    </span><span class="mi">-1</span><span class="p">);</span>
</code></pre></div>

<p>You do not need to worry about allocating and freeing memory for the data to
store. The model (or more precisely: the GLib/GObject GType and GValue
system) will take care of that for you. If you store a string, for example,
the model will make a copy of the string and store that. If you then set the
field to a new string later on, the model will automatically free the old
string and again make a copy of the new string and store the copy. This
applies to almost all types, be it <code>G_TYPE_STRING</code> or <code>GDK_TYPE_PIXBUF</code>.</p>
<p>The exception to note is <code>G_TYPE_POINTER</code>. If you allocate a chunk of data
or a complex structure and store it in a <code>G_TYPE_POINTER</code> field, only the
pointer value is stored. The model does not know anything about the size or
content of the data your pointer refers to, so it could not even make a copy
if it wanted to, so you need to allocate and free the memory yourself in
this case. However, if you do not want to do that yourself and want the
model to take care of your custom data for you, then you need to register
your own type and derive it from one of the GLib fundamental types (usually
<code>G_TYPE_BOXED</code>). See the GObject reference manual for details. Making a copy
of data involves memory allocation and other overhead of course, so one
should consider the performance implications of using a custom GLib type
over a <code>G_TYPE_POINTER</code> carefully before taking that approach. Again, a
custom model might be the better alternative, depending on the overall
amount of data to be stored (and&nbsp;retrieved).</p>
<h3 id="retrieving-row-data">Retrieving Row Data<a class="md-anchor" href="treeview-tutorial.html#retrieving-row-data" title="Permanent link"></a></h3>
<p>Storing data is not very useful if it cannot be retrieved again. This is
done using <code>gtk_tree_model_get()</code>, which takes similar arguments as
<code>gtk_list_store_set()</code> or <code>gtk_tree_store_set do()</code>, only that it takes (column,
pointer) arguments. The pointer must point to a variable that is of the same
type as the data stored in that particular model&nbsp;column.</p>
<p>Here is the previous example extended to traverse the list store and print
out the data stored. As an extra, we use <code>gtk_tree_model_foreach()</code> to traverse
the store and retrieve the row number from the <code>GtkTreePath</code> passed to us in
the foreach callback&nbsp;function:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtk/gtk.h&gt;</span>

<span class="k">enum</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">COL_FIRST_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="n">COL_LAST_NAME</span><span class="p">,</span>
<span class="w">  </span><span class="n">COL_YEAR_BORN</span><span class="p">,</span>
<span class="w">  </span><span class="n">NUM_COLS</span>
<span class="p">};</span>

<span class="n">gboolean</span>
<span class="nf">foreach_func</span><span class="w"> </span><span class="p">(</span><span class="n">GtkTreeModel</span><span class="w"> </span><span class="o">*</span><span class="n">model</span><span class="p">,</span>
<span class="w">              </span><span class="n">GtkTreePath</span><span class="w">  </span><span class="o">*</span><span class="n">path</span><span class="p">,</span>
<span class="w">              </span><span class="n">GtkTreeIter</span><span class="w">  </span><span class="o">*</span><span class="n">iter</span><span class="p">,</span>
<span class="w">              </span><span class="n">gpointer</span><span class="w">      </span><span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">first_name</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">last_name</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">tree_path_str</span><span class="p">;</span>
<span class="w">  </span><span class="n">guint</span><span class="w"> </span><span class="n">year_of_birth</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/* Note: here we use &#39;iter&#39; and not &#39;&amp;iter&#39;, because we did not allocate</span>
<span class="cm">   *  the iter on the stack and are already getting the pointer to a tree iter</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="n">gtk_tree_model_get</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">iter</span><span class="p">,</span>
<span class="w">                      </span><span class="n">COL_FIRST_NAME</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">first_name</span><span class="p">,</span>
<span class="w">                      </span><span class="n">COL_LAST_NAME</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">last_name</span><span class="p">,</span>
<span class="w">                      </span><span class="n">COL_YEAR_BORN</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">year_of_birth</span><span class="p">,</span>
<span class="w">                      </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">  </span><span class="n">tree_path_str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_path_to_string</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>

<span class="w">  </span><span class="n">g_print</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Row %s: %s %s, born %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">tree_path_str</span><span class="p">,</span>
<span class="w">           </span><span class="n">first_name</span><span class="p">,</span><span class="w"> </span><span class="n">last_name</span><span class="p">,</span><span class="w"> </span><span class="n">year_of_birth</span><span class="p">);</span>

<span class="w">  </span><span class="n">g_free</span><span class="p">(</span><span class="n">tree_path_str</span><span class="p">);</span>

<span class="w">  </span><span class="n">g_free</span><span class="p">(</span><span class="n">first_name</span><span class="p">);</span><span class="w"> </span><span class="cm">/* gtk_tree_model_get made copies of       */</span>
<span class="w">  </span><span class="n">g_free</span><span class="p">(</span><span class="n">last_name</span><span class="p">);</span><span class="w">  </span><span class="cm">/* the strings for us when retrieving them */</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">FALSE</span><span class="p">;</span><span class="w"> </span><span class="cm">/* do not stop walking the store, call us with next row */</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">create_and_fill_and_dump_store</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkListStore</span><span class="w"> </span><span class="o">*</span><span class="n">liststore</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkTreeIter</span><span class="w"> </span><span class="n">iter</span><span class="p">;</span>

<span class="w">  </span><span class="n">liststore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_list_store_new</span><span class="p">(</span><span class="n">NUM_COLS</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_STRING</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_STRING</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_UINT</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Append an empty row to the list store. Iter will point to the new row */</span>
<span class="w">  </span><span class="n">gtk_list_store_append</span><span class="p">(</span><span class="n">liststore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Fill fields with some data */</span>
<span class="w">  </span><span class="n">gtk_list_store_set</span><span class="w"> </span><span class="p">(</span><span class="n">liststore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span>
<span class="w">                      </span><span class="n">COL_FIRST_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Joe&quot;</span><span class="p">,</span>
<span class="w">                      </span><span class="n">COL_LAST_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Average&quot;</span><span class="p">,</span>
<span class="w">                      </span><span class="n">COL_YEAR_BORN</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">guint</span><span class="p">)</span><span class="w"> </span><span class="mi">1970</span><span class="p">,</span>
<span class="w">                      </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Append another row, and fill in some data */</span>
<span class="w">  </span><span class="n">gtk_list_store_append</span><span class="p">(</span><span class="n">liststore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_list_store_set</span><span class="w"> </span><span class="p">(</span><span class="n">liststore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span>
<span class="w">                      </span><span class="n">COL_FIRST_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jane&quot;</span><span class="p">,</span>
<span class="w">                      </span><span class="n">COL_LAST_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Common&quot;</span><span class="p">,</span>
<span class="w">                      </span><span class="n">COL_YEAR_BORN</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">guint</span><span class="p">)</span><span class="w"> </span><span class="mi">1967</span><span class="p">,</span>
<span class="w">                      </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Append yet another row, and fill it */</span>
<span class="w">  </span><span class="n">gtk_list_store_append</span><span class="p">(</span><span class="n">liststore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_list_store_set</span><span class="w"> </span><span class="p">(</span><span class="n">liststore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span>
<span class="w">                      </span><span class="n">COL_FIRST_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Yo&quot;</span><span class="p">,</span>
<span class="w">                      </span><span class="n">COL_LAST_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Da&quot;</span><span class="p">,</span>
<span class="w">                      </span><span class="n">COL_YEAR_BORN</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">guint</span><span class="p">)</span><span class="w"> </span><span class="mi">1873</span><span class="p">,</span>
<span class="w">                      </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Now traverse the list */</span>
<span class="w">  </span><span class="n">gtk_tree_model_foreach</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">liststore</span><span class="p">),</span><span class="w"> </span><span class="n">foreach_func</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">gtk_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">argv</span><span class="p">);</span>

<span class="w">  </span><span class="n">create_and_fill_and_dump_store</span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>Note that when a new row is created, all fields of a row are set to a
default &#8220;zero&#8221; value appropriate for the data type in question. A field of
type <code>G_TYPE_INT</code> will automatically contain the value 0 until it is set to a
different value, and strings and all kind of pointer types will be <code>NULL</code>
until set to something else. Those are valid contents for the model, and if
you are not sure that row contents have been set to something, you need to
be prepared to handle <code>NULL</code> pointers and the like in your&nbsp;code.</p>
<p>Run the above program with an additional empty row and look at the output to
see this in&nbsp;effect.</p>
<h4 id="freeing-retrieved-row-data">Freeing Retrieved Row Data<a class="md-anchor" href="treeview-tutorial.html#freeing-retrieved-row-data" title="Permanent link"></a></h4>
<p>Unless you are dealing with a model column of type <code>G_TYPE_POINTER</code>,
<code>gtk_tree_model_get()</code> will always make copies of the data&nbsp;retrieved.</p>
<p>In the case of strings, this means that you need to <code>g_free()</code> the string
returned when you don&#8217;t need it any longer, as in the example&nbsp;above.</p>
<p>If you retrieve a GObject such as a GdkPixbuf from the store,
<code>gtk_tree_model_get()</code> will automatically acquire a reference to it, so you
need to call <code>g_object_unref()</code> on the retrieved object once you are done
with it, to release the&nbsp;reference:</p>
<div class="codehilite"><pre><span></span><code><span class="n">GdkPixbuf</span><span class="w"> </span><span class="o">*</span><span class="n">pixbuf</span><span class="p">;</span>

<span class="n">gtk_tree_model_get</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span><span class="w"> </span>
<span class="w">                    </span><span class="n">COL_PICTURE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pixbuf</span><span class="p">,</span><span class="w"> </span>
<span class="w">                    </span><span class="nb">NULL</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pixbuf</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">do_something_with_pixbuf</span><span class="w"> </span><span class="p">(</span><span class="n">pixbuf</span><span class="p">);</span>
<span class="w">    </span><span class="n">g_object_unref</span><span class="w"> </span><span class="p">(</span><span class="n">pixbuf</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</code></pre></div>

<p>Similarly, GBoxed-derived types retrieved from a model need to be freed with
<code>g_boxed_free()</code> when done with them (don&#8217;t worry if you have never heard of&nbsp;GBoxed).</p>
<p>If the model column is of type <code>G_TYPE_POINTER</code>, <code>gtk_tree_model_get()</code> will
simply copy the pointer value, but not the data (even if if it wanted to, it
couldn&#8217;t copy the data, because it would not know how to copy it or what to
copy exactly). If you store pointers to objects or strings in a pointer
column (which you should not do unless you really know what you are doing
and why you are doing it), you do not need to unref or free the returned
values as described above, because <code>gtk_tree_model_get()</code> would not know what
kind of data they are and therefore won&#8217;t ref or copy them on&nbsp;retrieval.</p>
<h3 id="removing-rows">Removing Rows<a class="md-anchor" href="treeview-tutorial.html#removing-rows" title="Permanent link"></a></h3>
<p>Rows can easily be removed with <code>gtk_list_store_remove()</code> and
<code>gtk_tree_store_remove()</code>. The removed row will automatically be removed
from the tree view as well, and all data stored will automatically be freed,
with the exception of <code>G_TYPE_POINTER</code> columns (see&nbsp;above).</p>
<p>Removing a single row is fairly straight forward: you need to get the iter
that identifies the row you want to remove, and then use one of the above
functions. Here is a simple example that removes a row when you double-click
on it (bad from a user interface point of view, but then it is just an&nbsp;example):</p>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">onRowActivated</span><span class="w"> </span><span class="p">(</span><span class="n">GtkTreeView</span><span class="w">        </span><span class="o">*</span><span class="n">view</span><span class="p">,</span>
<span class="w">                </span><span class="n">GtkTreePath</span><span class="w">        </span><span class="o">*</span><span class="n">path</span><span class="p">,</span>
<span class="w">                </span><span class="n">GtkTreeViewColumn</span><span class="w">  </span><span class="o">*</span><span class="n">col</span><span class="p">,</span>
<span class="w">                </span><span class="n">gpointer</span><span class="w">            </span><span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkTreeModel</span><span class="w"> </span><span class="o">*</span><span class="n">model</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkTreeIter</span><span class="w">   </span><span class="n">iter</span><span class="p">;</span>

<span class="w">  </span><span class="n">g_print</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Row has been double-clicked. Removing row.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_get_model</span><span class="p">(</span><span class="n">view</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">gtk_tree_model_get_iter</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">))</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="cm">/* path describes a non-existing row - should not happen */</span>

<span class="w">  </span><span class="n">gtk_list_store_remove</span><span class="p">(</span><span class="n">GTK_LIST_STORE</span><span class="p">(</span><span class="n">model</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">create_treeview</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// ...</span>

<span class="w">  </span><span class="n">g_signal_connect</span><span class="p">(</span><span class="n">treeview</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;row-activated&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="p">(</span><span class="n">onRowActivated</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>

<p>If you want to remove the n-th row from a list (or the n-th child of a tree
node), you have two approaches: either you first create a <code>GtkTreePath</code> that
describes that row and then turn it into an iter and remove it; or you take
the iter of the parent node and use <code>gtk_tree_model_iter_nth_child()</code> (which
will also work for list stores if you use <code>NULL</code> as the parent iter. Of course
you could also start with the iter of the first top-level row, and then
step-by-step move it to the row you want, although that seems a rather
awkward way of doing&nbsp;it.</p>
<p>The following code snippet will remove the n-th row of a list if it&nbsp;exists:</p>
<div class="codehilite"><pre><span></span><code><span class="n">gboolean</span>
<span class="nf">list_store_remove_nth_row</span><span class="w"> </span><span class="p">(</span><span class="n">GtkListStore</span><span class="w"> </span><span class="o">*</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="n">gint</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkTreeIter</span><span class="w">  </span><span class="n">iter</span><span class="p">;</span>

<span class="w">  </span><span class="n">g_return_val_if_fail</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_IS_LIST_STORE</span><span class="p">(</span><span class="n">store</span><span class="p">),</span><span class="w"> </span><span class="n">FALSE</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* NULL means the parent is the virtual root node, so the</span>
<span class="cm">   * n-th top-level element is returned in iter, which is</span>
<span class="cm">   * the n-th row in a list store (as a list store only has</span>
<span class="cm">   * top-level elements, and no children)</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_tree_model_iter_nth_child</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">store</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">gtk_list_store_remove</span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">TRUE</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="removing-multiple-rows">Removing Multiple Rows<a class="md-anchor" href="treeview-tutorial.html#removing-multiple-rows" title="Permanent link"></a></h3>
<p>Removing multiple rows at once can be a bit tricky at times, and requires
some thought on how to do this best. For example, it is not possible to
traverse a store with <code>gtk_tree_model_foreach()</code>, check in the callback function
whether the given row should be removed and then just remove it by calling
one of the stores&#8217; remove functions. This will not work, because the model
is changed from within the foreach loop, which might suddenly invalidate
formerly valid tree iters in the foreach function, and thus lead to
unpredictable&nbsp;results.</p>
<p>You could traverse the store in a while loop of course, and call
<code>gtk_list_store_remove()</code> or <code>gtk_tree_store_remove()</code> whenever you want to
remove a row, and then just continue if the remove functions returns <code>TRUE</code>
(meaning that the iter is still valid and now points to the row after the
row that was&nbsp;removed).</p>
<p>Here is an example for an alternative approach to removing multiple rows in
one go (here we want to remove all rows from the store that contain persons
that have been born after 1980, but it could just as well be all selected
rows or some other&nbsp;criterion):</p>
<div class="codehilite"><pre><span></span><code><span class="n">gboolean</span>
<span class="nf">foreach_func</span><span class="w"> </span><span class="p">(</span><span class="n">GtkTreeModel</span><span class="w"> </span><span class="o">*</span><span class="n">model</span><span class="p">,</span>
<span class="w">              </span><span class="n">GtkTreePath</span><span class="w">  </span><span class="o">*</span><span class="n">path</span><span class="p">,</span>
<span class="w">              </span><span class="n">GtkTreeIter</span><span class="w">  </span><span class="o">*</span><span class="n">iter</span><span class="p">,</span>
<span class="w">              </span><span class="n">GList</span><span class="w">       </span><span class="o">**</span><span class="n">rowref_list</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">guint</span><span class="w"> </span><span class="n">year_of_birth</span><span class="p">;</span>

<span class="w">  </span><span class="n">g_assert</span><span class="w"> </span><span class="p">(</span><span class="n">rowref_list</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_tree_model_get</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="n">COL_YEAR_BORN</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">year_of_birth</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">year_of_birth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1980</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">GtkTreeRowReference</span><span class="w">  </span><span class="o">*</span><span class="n">rowref</span><span class="p">;</span>

<span class="w">      </span><span class="n">rowref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_row_reference_new</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>

<span class="w">      </span><span class="o">*</span><span class="n">rowref_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g_list_append</span><span class="p">(</span><span class="o">*</span><span class="n">rowref_list</span><span class="p">,</span><span class="w"> </span><span class="n">rowref</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">FALSE</span><span class="p">;</span><span class="w"> </span><span class="cm">/* do not stop walking the store, call us with next row */</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">remove_people_born_after_1980</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GList</span><span class="w"> </span><span class="o">*</span><span class="n">rr_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w">    </span><span class="cm">/* list of GtkTreeRowReferences to remove */</span>
<span class="w">  </span><span class="n">GList</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="p">;</span>

<span class="w">  </span><span class="n">gtk_tree_model_foreach</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">store</span><span class="p">),</span>
<span class="w">                         </span><span class="p">(</span><span class="n">GtkTreeModelForeachFunc</span><span class="p">)</span><span class="w"> </span><span class="n">foreach_func</span><span class="p">,</span>
<span class="w">                         </span><span class="o">&amp;</span><span class="n">rr_list</span><span class="p">);</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rr_list</span><span class="p">;</span><span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">GtkTreePath</span><span class="w"> </span><span class="o">*</span><span class="n">path</span><span class="p">;</span>

<span class="w">      </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_row_reference_get_path</span><span class="p">((</span><span class="n">GtkTreeRowReference</span><span class="o">*</span><span class="p">)</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="n">GtkTreeIter</span><span class="w"> </span><span class="n">iter</span><span class="p">;</span>

<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_tree_model_get_iter</span><span class="p">(</span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">store</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">))</span>
<span class="w">            </span><span class="n">gtk_list_store_remove</span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>

<span class="w">          </span><span class="n">gtk_tree_path_free</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="n">g_list_free_full</span><span class="p">(</span><span class="n">rr_list</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">GDestroyNotify</span><span class="p">)</span><span class="n">gtk_tree_row_reference_free</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p><code>gtk_list_store_clear()</code> and <code>gtk_tree_store_clear()</code> come in handy if you
want to remove all&nbsp;rows.</p>
<h3 id="storing-gobjects-pixbufs-etc">Storing GObjects (Pixbufs etc.)<a class="md-anchor" href="treeview-tutorial.html#storing-gobjects-pixbufs-etc" title="Permanent link"></a></h3>
<p>A special case are GObject types, like <code>GDK_TYPE_PIXBUF</code>, that get stored in a
list or tree store. The store will not make a copy of the object, rather it
will increase the object&#8217;s refcount. The store will then unref the object
again if it is no longer needed (ie. a new object is stored in the old
object&#8217;s place, the current value is replaced by <code>NULL</code>, the row is removed,
or the store is&nbsp;destroyed).</p>
<p>From a developer perspective, this means that you need to <code>g_object_unref()</code>
an object that you have just added to the store if you want the store to
automatically dispose of it when no longer needed. This is because on object
creation, the object has an initial refcount of 1, which is &#8220;your&#8221; refcount,
and the object will only be destroyed when it reaches a refcount of 0. Here
is the life cycle of a&nbsp;pixbuf:</p>
<div class="codehilite"><pre><span></span><code><span class="n">GtkListStore</span><span class="w"> </span><span class="o">*</span><span class="n">list_store</span><span class="p">;</span>
<span class="n">GtkTreeIter</span><span class="w"> </span><span class="n">iter</span><span class="p">;</span>
<span class="n">GdkPixbuf</span><span class="w"> </span><span class="o">*</span><span class="n">pixbuf</span><span class="p">;</span>
<span class="n">GError</span><span class="w"> </span><span class="o">*</span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>

<span class="n">list_store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_list_store_new</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">GDK_TYPE_PIXBUF</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_STRING</span><span class="p">);</span>

<span class="n">pixbuf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdk_pixbuf_new_from_file</span><span class="p">(</span><span class="s">&quot;icon.png&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>

<span class="cm">/* pixbuf has a refcount of 1 after creation */</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">g_critical</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Could not load pixbuf: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="o">-&gt;</span><span class="n">message</span><span class="p">);</span>
<span class="w">    </span><span class="n">g_error_free</span><span class="p">(</span><span class="n">error</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="n">gtk_list_store_append</span><span class="p">(</span><span class="n">list_store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>

<span class="n">gtk_list_store_set</span><span class="p">(</span><span class="n">list_store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pixbuf</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>

<span class="cm">/* pixbuf has a refcount of 2 now, as the list store has added its own reference */</span>

<span class="n">g_object_unref</span><span class="p">(</span><span class="n">pixbuf</span><span class="p">);</span>

<span class="cm">/* pixbuf has a refcount of 1 now that we have released our initial reference */</span>

<span class="cm">/* we don&#39;t want an icon in that row any longer */</span>
<span class="n">gtk_list_store_set</span><span class="p">(</span><span class="n">list_store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>

<span class="cm">/* pixbuf has automatically been destroyed after its refcount has reached 0.</span>
<span class="cm"> *  The list store called g_object_unref() on the pixbuf when it replaced</span>
<span class="cm"> *  the object in the store with a new value (NULL). */</span>
</code></pre></div>

<p>Having learned how to add, manipulate, and retrieve data from a store, the
next step is to get that data displayed in a GtkTreeView&nbsp;widget.</p>
<h2 id="creating-a-tree-view">Creating a Tree View<a class="md-anchor" href="treeview-tutorial.html#creating-a-tree-view" title="Permanent link"></a></h2>
<p>In order to display data in a tree view widget, we need to create one first,
and we need to instruct it where to get the data to display&nbsp;from.</p>
<p>A new tree view is created&nbsp;with:</p>
<div class="codehilite"><pre><span></span><code><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">view</span><span class="p">;</span>

<span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_new</span><span class="p">();</span>
</code></pre></div>

<h3 id="connecting-tree-view-and-model">Connecting Tree View and Model<a class="md-anchor" href="treeview-tutorial.html#connecting-tree-view-and-model" title="Permanent link"></a></h3>
<p>Before we proceed to the next section where we display data on the screen,
we need connect our data store to the tree view, so it knows where to get
the data to display from. This is achieved with <code>gtk_tree_view_set_model()</code>,
which will by itself do very little. However, it is a prerequisite for what
we do in the following sections. <code>gtk_tree_view_new_with_model()</code> is a
convenience function for the previous&nbsp;two.</p>
<p><code>gtk_tree_view_get_model()</code> will return the model that is currently attached
to a given tree view, which is particularly useful in callbacks where you
only get passed the tree view widget (after all, we do not want to go down
the road of global variables, which will inevitably lead to the Dark Side,
do&nbsp;we?).</p>
<h4 id="reference-counting">Reference counting<a class="md-anchor" href="treeview-tutorial.html#reference-counting" title="Permanent link"></a></h4>
<p>Tree models like GtkListStore and GtkTreeStore are GObjects and have a
reference count of 1 after creation. The tree view will add its own
reference to the model when you add the model with
<code>gtk_tree_view_set_model()</code>, and will unref it again when you replace the
model with another model, unset the model by passing <code>NULL</code> as a model, or
when the tree view is&nbsp;destroyed.</p>
<p><span class="quo">&#8216;</span>Reference counting&#8217; means that an object has a counter that can be
increased or decreased (ref-ed and unref-ed). If the counter is unref-ed to
0, the object is automatically destroyed. This is useful, because other
objects or application programmers only have to think about whether they
themselves are still using that object or not, without knowing anything
about others also using it. The object is simply automatically destroyed
when no one is using it any&nbsp;more. </p>
<p>This means that you need to take care of &#8220;your&#8221; reference yourself,
otherwise the model will not be destroyed properly when you disconnect it
from the tree view, and its memory will not be freed (which does not matter
much if the same model is connected to the tree view from application start
to end). If you plan to use the same model for a tree view for the whole
duration of the application, you can get rid of &#8220;your&#8221; reference right after
you have connected the model to the view - then the model will be destroyed
automatically when the tree view is destroyed (which will be automatically
destroyed when the window it is in is&nbsp;destroyed):</p>
<div class="codehilite"><pre><span></span><code><span class="n">GtkListStore</span><span class="w"> </span><span class="o">*</span><span class="n">liststore</span><span class="p">;</span>
<span class="n">GtkWidget</span><span class="w">    </span><span class="o">*</span><span class="n">view</span><span class="p">;</span>

<span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_new</span><span class="p">();</span>

<span class="n">liststore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_list_store_new</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_STRING</span><span class="p">);</span>

<span class="n">gtk_tree_view_set_model</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">view</span><span class="p">),</span><span class="w"> </span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">liststore</span><span class="p">));</span>

<span class="n">g_object_unref</span><span class="p">(</span><span class="n">liststore</span><span class="p">);</span>

<span class="cm">/* Now the model will be destroyed when the tree view is destroyed */</span>
</code></pre></div>

<h3 id="tree-view-look-and-feel">Tree View Look and Feel<a class="md-anchor" href="treeview-tutorial.html#tree-view-look-and-feel" title="Permanent link"></a></h3>
<p>There are a couple of ways to influence the look and feel of the tree view.
You can hide or show column headers with
<code>gtk_tree_view_set_headers_visible()</code>, and set them clickable or not with
<code>gtk_tree_view_set_headers_clickable()</code> (which will be done automatically
for you if you enable&nbsp;sorting).</p>
<p><code>gtk_tree_view_set_rules_hint()</code> will enable or disable rules in the tree
view. As the function name implies, this setting is only a hint; in the end
it depends on the active <span class="caps">GTK</span> theme engine if the tree view shows ruled lines
or not. Users seem to have strong feelings about rules in tree views, so it
is probably a good idea to provide an option somewhere to disable rule
hinting if you set it on tree views (but then, people also seem to have
strong feelings about options abundance and &#8216;sensible&#8217; default options, so
whatever you do will probably upset someone at some&nbsp;point).</p>
<p>The expander column can be set with <code>gtk_tree_view_set_expander_column()</code>.
This is the column where child elements are indented with respect to their
parents, and where rows with children have an &#8216;expander&#8217; arrow with which a
node&#8217;s children can be collapsed (hidden) or expanded (shown). By default,
this is the first&nbsp;column.</p>
<h2 id="mapping-data-to-the-screen-gtktreeviewcolumn-and-gtkcellrenderer">Mapping Data to the Screen: GtkTreeViewColumn and GtkCellRenderer<a class="md-anchor" href="treeview-tutorial.html#mapping-data-to-the-screen-gtktreeviewcolumn-and-gtkcellrenderer" title="Permanent link"></a></h2>
<p>As outlined above, tree view columns represent the visible columns on the
screen that have a column header with a column name and can be resized or
sorted. A tree view is made up of tree view columns, and you need at least
one tree view column in order to display something in the tree view. Tree
view columns, however, do not display anything by themselves, this is done
by specialised GtkCellRenderer objects. Cell renderers are packed into tree
view columns much like widgets are packed into <code>GtkBox</code>es.</p>
<p>Here is a diagram (courtesy of Owen Taylor) that pictures the relationship
between tree view columns and cell&nbsp;renderers: </p>
<p><img alt="" src="tree-view-column.png" /></p>
<p>In the above diagram, both &#8216;Country&#8217; and &#8216;Representative&#8217; are tree view
columns, where the &#8216;Country&#8217; and &#8216;Representative&#8217; labels are the column
headers. The &#8216;Country&#8217; column contains two cell renderers, one to display
the flag icons, and one to display the country name. The &#8216;Representative&#8217;
column only contains one cell renderer to display the representative&#8217;s&nbsp;name.</p>
<h3 id="cell-renderers">Cell Renderers<a class="md-anchor" href="treeview-tutorial.html#cell-renderers" title="Permanent link"></a></h3>
<p>Cell renderers are objects that are responsible for the actual rendering of
data within a GtkTreeViewColumn. They are basically just GObjects (ie. not
widgets) that have certain properties, and those properties determine how a
single cell is&nbsp;drawn.</p>
<p>In order to draw cells in different rows with different content, a cell
renderer&#8217;s properties need to be set accordingly for each single row/cell to
render. This is done either via attributes or cell data functions (see
below). If you set up attributes, you tell Gtk which model column contains
the data from which a property should be set before rendering a certain row.
Then the properties of a cell renderer are set automatically according to
the data in the model before each row is rendered. Alternatively, you can
set up cell data functions, which are called for each row to be rendererd,
so that you can manually set the properties of the cell renderer before it
is rendered. Both approaches can be used at the same time as well. Lastly,
you can set a cell renderer property when you create the cell renderer. That
way it will be used for all rows/cells to be rendered (unless it is changed
later of&nbsp;course).</p>
<p>Different cell renderers exist for different&nbsp;purposes:</p>
<ul>
<li>GtkCellRendererText renders strings or numbers or boolean values as text
  (&#8220;Joe&#8221;, &#8220;99.32&#8221;,&nbsp;&#8220;true&#8221;)</li>
<li>GtkCellRendererPixbuf is used to display images; either user-defined
  images, or one of the stock icons that come with <span class="caps">GTK</span>.</li>
<li>GtkCellRendererToggle displays a boolean value in form of a check box or
  as a radio&nbsp;button.</li>
<li>GtkCellEditable is a special cell that implements editable cells (ie.
  GtkEntry or GtkSpinbutton in a treeview). This is not a cell renderer! If
  you want to have editable text cells, use GtkCellRendererText and make
  sure the &#8220;editable&#8221; property is set. GtkCellEditable is only used by
  implementations of editable cells and widgets that can be inside of
  editable cells. You are unlikely to ever need&nbsp;it.</li>
</ul>
<p>Contrary to what one may think, a cell renderer does not render just one
single cell, but is responsible for rendering part or whole of a tree view
column for each single row. It basically starts in the first row and renders
its part of the column there. Then it proceeds to the next row and renders
its part of the column there again. And so&nbsp;on.</p>
<p>How does a cell renderer know what to render? A cell renderer object has
certain &#8216;properties&#8217; that are documented in the <span class="caps">API</span> reference (just like
most other objects, and widgets). These properties determine what the cell
renderer is going to render and how it is going to be rendered. Whenever the
cell renderer is called upon to render a certain cell, it looks at its
properties and renders the cell accordingly. This means that whenever you
set a property or change a property of the cell renderer, this will affect
all rows that are rendered after the change, until you change the property&nbsp;again.</p>
<p>Here is a diagram (courtesy of Owen Taylor) that tries to show what is going
on when rows are&nbsp;rendered:</p>
<p><img alt="" src="cell-renderer-properties.png" /></p>
<p>The above diagram shows the process when attributes are used. In the
example, a text cell renderer&#8217;s &#8220;text&#8221; property has been linked to the
first model column. The &#8220;text&#8221; property contains the string to be rendered.
The &#8220;foreground&#8221; property, which contains the colour of the text to be
shown, has been linked to the second model column. Finally, the
&#8220;strikethrough&#8221; property, which determines whether the text should be with
a horizontal line that strikes through the text, has been connected to the
third model column (of type <code>G_TYPE_BOOLEAN</code>).</p>
<p>With this setup, the cell renderer&#8217;s properties are &#8216;loaded&#8217; from the model
before each cell is&nbsp;rendered.</p>
<p>Here is a silly and utterly useless little example that demonstrates this
behaviour, and introduces some of the most commonly used properties of
<code>GtkCellRendererText</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtk/gtk.h&gt;</span>

<span class="k">enum</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">COL_FIRST_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="n">COL_LAST_NAME</span><span class="p">,</span>
<span class="w">  </span><span class="n">NUM_COLS</span>
<span class="p">}</span><span class="w"> </span><span class="p">;</span>

<span class="k">static</span><span class="w"> </span><span class="n">GtkTreeModel</span><span class="w"> </span><span class="o">*</span>
<span class="nf">create_and_fill_model</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkTreeStore</span><span class="w">  </span><span class="o">*</span><span class="n">treestore</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkTreeIter</span><span class="w">    </span><span class="n">toplevel</span><span class="p">,</span><span class="w"> </span><span class="n">child</span><span class="p">;</span>

<span class="w">  </span><span class="n">treestore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_store_new</span><span class="p">(</span><span class="n">NUM_COLS</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_STRING</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_STRING</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Append a top level row and leave it empty */</span>
<span class="w">  </span><span class="n">gtk_tree_store_append</span><span class="p">(</span><span class="n">treestore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">toplevel</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Append a second top level row, and fill it with some data */</span>
<span class="w">  </span><span class="n">gtk_tree_store_append</span><span class="p">(</span><span class="n">treestore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">toplevel</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_tree_store_set</span><span class="p">(</span><span class="n">treestore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">toplevel</span><span class="p">,</span>
<span class="w">                     </span><span class="n">COL_FIRST_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Joe&quot;</span><span class="p">,</span>
<span class="w">                     </span><span class="n">COL_LAST_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Average&quot;</span><span class="p">,</span>
<span class="w">                     </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Append a child to the second top level row, and fill in some data */</span>
<span class="w">  </span><span class="n">gtk_tree_store_append</span><span class="p">(</span><span class="n">treestore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">child</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">toplevel</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_tree_store_set</span><span class="p">(</span><span class="n">treestore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">child</span><span class="p">,</span>
<span class="w">                     </span><span class="n">COL_FIRST_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jane&quot;</span><span class="p">,</span>
<span class="w">                     </span><span class="n">COL_LAST_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Average&quot;</span><span class="p">,</span>
<span class="w">                     </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">treestore</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span>
<span class="nf">create_view_and_model</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkTreeViewColumn</span><span class="w">   </span><span class="o">*</span><span class="n">col</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkCellRenderer</span><span class="w">     </span><span class="o">*</span><span class="n">renderer</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w">           </span><span class="o">*</span><span class="n">view</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkTreeModel</span><span class="w">        </span><span class="o">*</span><span class="n">model</span><span class="p">;</span>

<span class="w">  </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_new</span><span class="p">();</span>

<span class="w">  </span><span class="cm">/* --- Column #1 --- */</span>

<span class="w">  </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_column_new</span><span class="p">();</span>

<span class="w">  </span><span class="n">gtk_tree_view_column_set_title</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;First Name&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* pack tree view column into tree view */</span>
<span class="w">  </span><span class="n">gtk_tree_view_append_column</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">view</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="p">);</span>

<span class="w">  </span><span class="n">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_cell_renderer_text_new</span><span class="p">();</span>

<span class="w">  </span><span class="cm">/* pack cell renderer into tree view column */</span>
<span class="w">  </span><span class="n">gtk_tree_view_column_pack_start</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* set &#39;text&#39; property of the cell renderer */</span>
<span class="w">  </span><span class="n">g_object_set</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Boooo!&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>


<span class="w">  </span><span class="cm">/* --- Column #2 --- */</span>

<span class="w">  </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_column_new</span><span class="p">();</span>

<span class="w">  </span><span class="n">gtk_tree_view_column_set_title</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Last Name&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* pack tree view column into tree view */</span>
<span class="w">  </span><span class="n">gtk_tree_view_append_column</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">view</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="p">);</span>

<span class="w">  </span><span class="n">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_cell_renderer_text_new</span><span class="p">();</span>

<span class="w">  </span><span class="cm">/* pack cell renderer into tree view column */</span>
<span class="w">  </span><span class="n">gtk_tree_view_column_pack_start</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* set &#39;cell-background&#39; property of the cell renderer */</span>
<span class="w">  </span><span class="n">g_object_set</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span>
<span class="w">               </span><span class="s">&quot;cell-background&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Orange&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="s">&quot;cell-background-set&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">,</span>
<span class="w">               </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_and_fill_model</span><span class="p">();</span>

<span class="w">  </span><span class="n">gtk_tree_view_set_model</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">view</span><span class="p">),</span><span class="w"> </span><span class="n">model</span><span class="p">);</span>

<span class="w">  </span><span class="n">g_object_unref</span><span class="p">(</span><span class="n">model</span><span class="p">);</span><span class="w"> </span><span class="cm">/* destroy model automatically with view */</span>

<span class="w">  </span><span class="n">gtk_tree_selection_set_mode</span><span class="p">(</span><span class="n">gtk_tree_view_get_selection</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">view</span><span class="p">)),</span>
<span class="w">                              </span><span class="n">GTK_SELECTION_NONE</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span>
<span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">window</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">view</span><span class="p">;</span>

<span class="w">  </span><span class="n">gtk_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">argv</span><span class="p">);</span>

<span class="w">  </span><span class="n">window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_window_new</span><span class="p">(</span><span class="n">GTK_WINDOW_TOPLEVEL</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;delete_event&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">gtk_main_quit</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"> </span><span class="cm">/* dirty */</span>

<span class="w">  </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_view_and_model</span><span class="p">();</span>

<span class="w">  </span><span class="n">gtk_container_add</span><span class="p">(</span><span class="n">GTK_CONTAINER</span><span class="p">(</span><span class="n">window</span><span class="p">),</span><span class="w"> </span><span class="n">view</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_widget_show_all</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_main</span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>The above code should produce something looking like&nbsp;this:</p>
<p><img alt="" src="renderer.png" /></p>
<p>It looks like the tree view display is partly correct and partly
incomplete. On the one hand the tree view renders the correct number of
rows (note how there is no orange on the right after row 3), and it
displays the hierarchy correctly (on the left), but it does not display any
of the data that we have stored in the model. This is because we have made
no connection between what the cell renderers should render and the data in
the model. We have simply set some cell renderer properties on start-up,
and the cell renderers adhere to those set properties&nbsp;meticulously.</p>
<p>There are two different ways to connect cell renderers to data in the model:
attributes and cell data&nbsp;functions.</p>
<h3 id="attributes">Attributes<a class="md-anchor" href="treeview-tutorial.html#attributes" title="Permanent link"></a></h3>
<p>An attribute is a connection between a cell renderer property and a
field/column in the model. Whenever a cell is to be rendered, a cell
renderer property will be set to the values of the specified model column of
the row that is to be rendered. It is very important that the column&#8217;s data
type is the same type that a property takes according to the <span class="caps">API</span> reference
manual. Here is some code to look&nbsp;at:</p>
<div class="codehilite"><pre><span></span><code><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_column_new</span><span class="p">();</span>

<span class="n">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_cell_renderer_text_new</span><span class="p">();</span>

<span class="n">gtk_tree_view_column_pack_start</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">);</span>

<span class="n">gtk_tree_view_column_add_attribute</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">COL_FIRST_NAME</span><span class="p">);</span>
</code></pre></div>

<p>This means that the text cell renderer property &#8220;text&#8221; will be set to the
string in model column <code>COL_FIRST_NAME</code> of each row to be drawn. It is
important to internalise the difference between
<code>gtk_tree_view_column_add_attribute()</code> and <code>g_object_set()</code>:
<code>g_object_set()</code> sets a property to a certain value, while
<code>gtk_tree_view_column_add_attribute()</code> sets a property to whatever is in the
specified <em>model column</em> at the time of&nbsp;rendering.</p>
<p>Again, when setting attributes it is very important that the data type
stored in a model column is the same as the data type that a property
requires as argument. Check the <span class="caps">API</span> reference manual to see the data type
that is required for each property. When reading through the example a bit
further above, you might have noticed that we set the &#8220;cell-background&#8221;
property of a GtkCellRendererText, even though the <span class="caps">API</span> documentation does
not list such a property. We can do this, because GtkCellRendererText is
derived from GtkCellRenderer, which does in fact have such a property.
Derived classes inherit the properties of their parents. This is the same as
with widgets that you can cast into one of their ancestor classes. The <span class="caps">API</span>
reference has an object hierarchy that shows you which classes a widget or
some other object is derived&nbsp;from.</p>
<p>There are two more noteworthy things about <code>GtkCellRenderer</code> properties: one
is that sometimes there are different properties which do the same, but take
different arguments, such as the &#8220;foreground&#8221; and &#8220;foreground-gdk&#8221;
properties of <code>GtkCellRendererText</code> (which specify the text colour). The
&#8220;foreground&#8221; property take a colour in string form, such as &#8220;Orange&#8221; or
&#8220;CornflowerBlue&#8221;, whereas &#8220;foreground-gdk&#8221; takes a <code>GdkColor</code> argument. It is
up to you to decide which one to use - the effect will be the same. The
other thing worth mentioning is that most properties have a &#8220;foo-set&#8221;
property taking a boolean value as argument, such as &#8220;foreground-set&#8221;. This
is useful when you want to have a certain setting have an effect or not. If
you set the &#8220;foreground&#8221; property, but set &#8220;foreground-set&#8221; to <code>FALSE</code>, then
your foreground color setting will be disregarded. This is useful in cell
data functions (see below), or, for example, if you want set the foreground
colour to a certain value at start-up, but only want this to be in effect in
some columns, but not in others (in which case you could just connect the
&#8220;foreground-set&#8221; property to a model column of type <code>G_TYPE_BOOLEAN</code> with
<code>gtk_tree_view_column_add_attribute()</code>.</p>
<p>Setting column attributes is the most straight-forward way to get your model
data to be displayed. This is usually used whenever you want the data in the
model to be displayed exactly as it is in the&nbsp;model.</p>
<p>Another way to get your model data displayed on the screen is to set up cell
data&nbsp;functions.</p>
<h3 id="cell-data-functions">Cell Data Functions<a class="md-anchor" href="treeview-tutorial.html#cell-data-functions" title="Permanent link"></a></h3>
<p>A cell data function is a function that is called for a specific cell
renderer for each single row before that row is rendered. It gives you
maximum control over what exactly is going to be rendered, as you can set
the cell renderer&#8217;s properties just like you want to have them. Remember not
only to set a property if you want it to be active, but also to unset a
property if it should not be active (and it might have been set in the
previous&nbsp;row).</p>
<p>Cell data functions are often used if you want more fine-grained control
over what is to be displayed, or if the standard way to display something is
not quite like you want it to be. A case in point are floating point
numbers. If you want floating point numbers to be displayed in a certain
way, say with only one digit after the colon/comma, then you need to use a
cell data function. Use <code>gtk_tree_view_column_set_cell_data_func()</code> to set
up a cell data function for a particular cell renderer. Here is an&nbsp;example: </p>
<div class="codehilite"><pre><span></span><code><span class="k">enum</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">COLUMN_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="n">COLUMN_AGE_FLOAT</span><span class="p">,</span>
<span class="w">  </span><span class="n">NUM_COLS</span>
<span class="p">};</span>

<span class="c1">// ...</span>

<span class="kt">void</span>
<span class="nf">age_cell_data_function</span><span class="w"> </span><span class="p">(</span><span class="n">GtkTreeViewColumn</span><span class="w"> </span><span class="o">*</span><span class="n">col</span><span class="p">,</span>
<span class="w">                        </span><span class="n">GtkCellRenderer</span><span class="w">   </span><span class="o">*</span><span class="n">renderer</span><span class="p">,</span>
<span class="w">                        </span><span class="n">GtkTreeModel</span><span class="w">      </span><span class="o">*</span><span class="n">model</span><span class="p">,</span>
<span class="w">                        </span><span class="n">GtkTreeIter</span><span class="w">       </span><span class="o">*</span><span class="n">iter</span><span class="p">,</span>
<span class="w">                        </span><span class="n">gpointer</span><span class="w">           </span><span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w">  </span><span class="n">age</span><span class="p">;</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>

<span class="w">  </span><span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="n">COLUMN_AGE_FLOAT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">  </span><span class="n">g_snprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;%.1f&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">);</span>

<span class="w">  </span><span class="n">g_object_set</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ...</span>

<span class="n">liststore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_list_store_new</span><span class="p">(</span><span class="n">NUM_COLS</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_STRING</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_FLOAT</span><span class="p">);</span>

<span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_column_new</span><span class="p">();</span>

<span class="n">cell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_cell_renderer_text_new</span><span class="p">();</span>

<span class="n">gtk_tree_view_column_pack_start</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">cell</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">);</span>

<span class="n">gtk_tree_view_column_set_cell_data_func</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">cell</span><span class="p">,</span><span class="w"> </span><span class="n">age_cell_data_func</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
</code></pre></div>

<p>for each row to be rendered by this particular cell renderer, the cell data
function is going to be called, which then retrieves the float from the
model, and turns it into a string where the float has only one digit after
the colon/comma, and renders that with the text cell&nbsp;renderer.</p>
<p>This is only a simple example, you can make cell data functions a lot more
complicated if you want to. As always, there is a trade-off to keep in mind
though. Your cell data function is going to be called every single time a
cell in that (renderer) column is going to be rendered. Go and check how
often this function is called in your program if you ever use one. If you do
time-consuming operations within a cell data function, things are not going
to be fast, especially if you have a lot of rows. The alternative in this
case would have been to make an additional column <code>COLUMN_AGE_FLOAT_STRING</code> of
type <code>G_TYPE_STRING</code>, and to set the float in string form whenever you set the
float itself in a row, and then hook up the string column to a text cell
renderer using attributes. This way the float to string conversion would
only need to be done once. This is a cpu cycles / memory trade-off, and it
depends on your particular case which one is more suitable. Things you
should probably not do is to convert long strings into <span class="caps">UTF8</span> format in a cell
data function, for&nbsp;example.</p>
<p>You might notice that your cell data function is called at times even for
rows that are not visible at the moment. This is because the tree view needs
to know its total height, and in order to calculate this it needs to know
the height of each and every single row, and it can only know that by having
it measured, which is going to be slow when you have a lot of rows with
different heights (if your rows all have the same height, there should not
be any visible delay&nbsp;though).</p>
<h3 id="gtkcellrenderertext-and-integer-boolean-and-float-types"><code>GtkCellRendererText</code> and Integer, Boolean and Float Types<a class="md-anchor" href="treeview-tutorial.html#gtkcellrenderertext-and-integer-boolean-and-float-types" title="Permanent link"></a></h3>
<p>It has been said before that, when using attributes to connect data from the
model to a cell renderer property, the data in the model column specified in
<code>gtk_tree_view_column_add_attribute()</code> must always be of the same type as the
data type that the property&nbsp;requires.</p>
<p>This is usually true, but there is an exception: if you use
<code>gtk_tree_view_column_add_attribute()</code> to connect a text cell renderer&#8217;s &#8220;text&#8221;
property to a model column, the model column does not need to be of
<code>G_TYPE_STRING</code>, it can also be one of most other fundamental GLib types, e.g.
<code>G_TYPE_BOOLEAN</code>, <code>G_TYPE_INT</code>, <code>G_TYPE_UINT</code>, <code>G_TYPE_LONG</code>, <code>G_TYPE_ULONG</code>,
<code>G_TYPE_INT64</code>, <code>G_TYPE_UINT64</code>, <code>G_TYPE_FLOAT</code>, or <code>G_TYPE_DOUBLE</code>. The text cell
renderer will automatically display the values of these types correctly in
the tree view. For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">enum</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">COL_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="n">COL_YEAR_BORN</span><span class="p">,</span>
<span class="w">  </span><span class="n">NUM_COLS</span>
<span class="p">};</span>

<span class="n">liststore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_list_store_new</span><span class="p">(</span><span class="n">NUM_COLS</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_STRING</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_UINT</span><span class="p">);</span>

<span class="c1">// ...</span>

<span class="n">cell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_cell_renderer_text_new</span><span class="p">();</span>
<span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_column_new</span><span class="p">();</span>
<span class="n">gtk_tree_view_column_add_attribute</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">cell</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">COL_YEAR_BORN</span><span class="p">);</span>
</code></pre></div>

<p>Even though the &#8220;text&#8221; property would require a string value, we use a model
column of an integer type when setting attributes. The integer will then
automatically be converted into a string before the cell renderer property
is&nbsp;set.</p>
<p>If you are using a floating point type, ie. <code>G_TYPE_FLOAT</code> or
<code>G_TYPE_DOUBLE</code>, there is no way to tell the text cell renderer how many
digits after the floating point (or comma) should be rendered. If you only
want a certain amount of digits after the point/comma, you will need to use
a cell data&nbsp;function.</p>
<h3 id="gtkcellrenderertext-utf8-and-pango-markup">GtkCellRendererText, UTF8, and pango markup<a class="md-anchor" href="treeview-tutorial.html#gtkcellrenderertext-utf8-and-pango-markup" title="Permanent link"></a></h3>
<p>All text used in <span class="caps">GTK</span> widgets needs to be in <span class="caps">UTF8</span> encoding, and
<code>GtkCellRendererText</code> is no exception. Text in plain <span class="caps">ASCII</span> is automatically
valid <span class="caps">UTF8</span>, but as soon as you have special characters that do not exist in
plain <span class="caps">ASCII</span> (usually characters that are not used in the English language
alphabet), they need to be in <span class="caps">UTF8</span> encoding. There are many different
character encodings that all specify different ways to tell the computer
which character is meant. <span class="caps">GTK</span> uses <span class="caps">UTF8</span>, and whenever you have text that is
in a different encoding, you need to convert it to <span class="caps">UTF8</span> encoding first,
using one of the GLib <code>g_convert*()</code> family of functions. If you only use
text input from other <span class="caps">GTK</span> widgets, you are on the safe side, as they will
return all text in <span class="caps">UTF8</span> as&nbsp;well.</p>
<p>However, if you use &#8216;external&#8217; sources of text input, then you must convert
that text from the text&#8217;s encoding (or the user&#8217;s locale) to <span class="caps">UTF8</span>, or it
will not be rendered correctly (either not at all, or it will be cut off
after the first invalid character). Filenames are especially hard, because
there is no indication whatsoever what character encoding a filename is in
(it might have been created when the user was using a different locale, so
filename encoding is basically unreliable and broken). You may want to
convert to <span class="caps">UTF8</span> with fallback characters in that case. You can check whether
a string is valid <span class="caps">UTF8</span> with <code>g_utf8_validate()</code>. You should, in this author&#8217;s
opinion at least, put these checks into your code at crucial places wherever
it is not affecting performance, especially if you are an English-speaking
programmer that has little experience with non-English locales. It will make
it easier for others and yourself to spot problems with non-English locales
later&nbsp;on.</p>
<p>In addition to the &#8220;text&#8221; property, <code>GtkCellRendererText</code> also has a &#8220;markup&#8221;
property that takes text with Pango markup as input. Pango markup allows you
to place special tags into a text string that affect the style the text is
rendered (see the pango documentation). Basically you can achieve everything
you can achieve with the other properties also with Pango markup (only that
using properties is more efficient and less messy). Pango markup has one
distinct advantage though that you cannot achieve with text cell renderer
properties: with Pango markup, you can change the text style in the middle
of the text, so you could, for example, render one part of a text string in
bold print, and the rest of the text in normal. Here is an example of a
string with pango&nbsp;markup:</p>
<div class="codehilite"><pre><span></span><code>&quot;You can have text in &lt;b&gt;bold&lt;/b&gt; or in a &lt;span color=&#39;Orange&#39;&gt;different color&lt;/span&gt;&quot;
</code></pre></div>

<p>When using the &#8220;markup&#8221; property, you need to take into account that the
&#8220;markup&#8221; and &#8220;text&#8221; properties do not seem to be mutually exclusive (I
suppose this could be called a bug). In other words: whenever you set
&#8220;markup&#8221; (and have used the &#8220;text&#8221; property before), set the &#8220;text&#8221; property
to <code>NULL</code>, and vice versa.&nbsp;Example:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">void</span>
<span class="nf">foo_cell_data_function</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// ...</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">is_important</span><span class="p">)</span>
<span class="w">    </span><span class="n">g_object_set</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;markup&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&lt;b&gt;important&lt;/b&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="n">g_object_set</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;markup&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;not important&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>

<p>Another thing to keep in mind when using pango markup text is that you might
need to escape text if you construct strings with pango markup on the fly
using random input data. For&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">void</span>
<span class="nf">foo_cell_data_function</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">markuptxt</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/* This might be problematic if artist_string or title_string</span>
<span class="cm">   * contain markup characters/entities:</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="n">markuptxt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g_strdup_printf</span><span class="p">(</span><span class="s">&quot;&lt;b&gt;%s&lt;/b&gt; - &lt;i&gt;%s&lt;/i&gt;&quot;</span><span class="p">,</span>
<span class="w">                              </span><span class="n">artist_string</span><span class="p">,</span><span class="w"> </span><span class="n">title_string</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// ...</span>

<span class="w">  </span><span class="n">g_object_set</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;markup&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">markuptxt</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="c1">//...</span>

<span class="w">  </span><span class="n">g_free</span><span class="p">(</span><span class="n">markuptxt</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>The above example will not work if <code>artist_string</code> is &#8220;Simon <span class="amp">&amp;</span> Garfunkel&#8221;
for example, because the <span class="amp">&amp;</span> character is one of the characters that is
special. They need to be escaped, so that pango knows that they do not refer
to any pango markup, but are just characters. In this case the string would
need to be &#8220;Simon <span class="amp">&amp;</span> Garfunkel&#8221; in order to make sense in between the
pango markup in which it is going to be pasted. You can escape a string with
<code>g_markup_escape()</code> (and you will need to free the resulting newly-allocated
string again with <code>g_free()</code>).</p>
<p>It is possible to combine both pango markup and text cell renderer
properties. Both will be &#8216;added&#8217; together to render the string in question,
only that the text cell renderer properties will be applied to the whole
string. If you set the &#8220;markup&#8221; property to normal text without any pango
markup, it will render as normal text just as if you had used the &#8220;text&#8221;
property. However, as opposed to the &#8220;text&#8221; property, special characters in
the &#8220;markup&#8221; property text would still need to be escaped, even if you do
not use pango markup in the&nbsp;text.</p>
<h3 id="a-working-example">A Working Example<a class="md-anchor" href="treeview-tutorial.html#a-working-example" title="Permanent link"></a></h3>
<p>Here is our example from the very beginning again (with an additional column
though), only that the contents of the model are rendered properly on the
screen this time. Both attributes and a cell data function are used for
demonstration&nbsp;purposes.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtk/gtk.h&gt;</span>

<span class="k">enum</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">COL_FIRST_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="n">COL_LAST_NAME</span><span class="p">,</span>
<span class="w">  </span><span class="n">COL_YEAR_BORN</span><span class="p">,</span>
<span class="w">  </span><span class="n">NUM_COLS</span>
<span class="p">}</span><span class="w"> </span><span class="p">;</span>

<span class="k">static</span><span class="w"> </span><span class="n">GtkTreeModel</span><span class="w"> </span><span class="o">*</span>
<span class="nf">create_and_fill_model</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkTreeStore</span><span class="w">  </span><span class="o">*</span><span class="n">treestore</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkTreeIter</span><span class="w">    </span><span class="n">toplevel</span><span class="p">,</span><span class="w"> </span><span class="n">child</span><span class="p">;</span>

<span class="w">  </span><span class="n">treestore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_store_new</span><span class="p">(</span><span class="n">NUM_COLS</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">G_TYPE_STRING</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">G_TYPE_STRING</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">G_TYPE_UINT</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Append a top level row and leave it empty */</span>
<span class="w">  </span><span class="n">gtk_tree_store_append</span><span class="p">(</span><span class="n">treestore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">toplevel</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_tree_store_set</span><span class="p">(</span><span class="n">treestore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">toplevel</span><span class="p">,</span>
<span class="w">                     </span><span class="n">COL_FIRST_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Maria&quot;</span><span class="p">,</span>
<span class="w">                     </span><span class="n">COL_LAST_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Incognito&quot;</span><span class="p">,</span>
<span class="w">                     </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Append a second top level row, and fill it with some data */</span>
<span class="w">  </span><span class="n">gtk_tree_store_append</span><span class="p">(</span><span class="n">treestore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">toplevel</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_tree_store_set</span><span class="p">(</span><span class="n">treestore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">toplevel</span><span class="p">,</span>
<span class="w">                     </span><span class="n">COL_FIRST_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jane&quot;</span><span class="p">,</span>
<span class="w">                     </span><span class="n">COL_LAST_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Average&quot;</span><span class="p">,</span>
<span class="w">                     </span><span class="n">COL_YEAR_BORN</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">guint</span><span class="p">)</span><span class="w"> </span><span class="mi">1962</span><span class="p">,</span>
<span class="w">                     </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Append a child to the second top level row, and fill in some data */</span>
<span class="w">  </span><span class="n">gtk_tree_store_append</span><span class="p">(</span><span class="n">treestore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">child</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">toplevel</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_tree_store_set</span><span class="p">(</span><span class="n">treestore</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">child</span><span class="p">,</span>
<span class="w">                     </span><span class="n">COL_FIRST_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Janinita&quot;</span><span class="p">,</span>
<span class="w">                     </span><span class="n">COL_LAST_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Average&quot;</span><span class="p">,</span>
<span class="w">                     </span><span class="n">COL_YEAR_BORN</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">guint</span><span class="p">)</span><span class="w"> </span><span class="mi">1985</span><span class="p">,</span>
<span class="w">                     </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">treestore</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">age_cell_data_func</span><span class="w"> </span><span class="p">(</span><span class="n">GtkTreeViewColumn</span><span class="w"> </span><span class="o">*</span><span class="n">col</span><span class="p">,</span>
<span class="w">                    </span><span class="n">GtkCellRenderer</span><span class="w">   </span><span class="o">*</span><span class="n">renderer</span><span class="p">,</span>
<span class="w">                    </span><span class="n">GtkTreeModel</span><span class="w">      </span><span class="o">*</span><span class="n">model</span><span class="p">,</span>
<span class="w">                    </span><span class="n">GtkTreeIter</span><span class="w">       </span><span class="o">*</span><span class="n">iter</span><span class="p">,</span>
<span class="w">                    </span><span class="n">gpointer</span><span class="w">           </span><span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">guint</span><span class="w">  </span><span class="n">year_born</span><span class="p">;</span>
<span class="w">  </span><span class="n">guint</span><span class="w">  </span><span class="n">year_now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2003</span><span class="p">;</span><span class="w"> </span><span class="cm">/* to save code not relevant for the example */</span>
<span class="w">  </span><span class="n">gchar</span><span class="w">  </span><span class="n">buf</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>

<span class="w">  </span><span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="n">COL_YEAR_BORN</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">year_born</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">year_born</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">year_now</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">year_born</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">guint</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year_now</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">year_born</span><span class="p">;</span>

<span class="w">    </span><span class="n">g_snprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;%u years old&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">);</span>

<span class="w">    </span><span class="n">g_object_set</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foreground-set&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FALSE</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"> </span><span class="cm">/* print this normal */</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">g_snprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;age unknown&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* make red */</span>
<span class="w">    </span><span class="n">g_object_set</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foreground&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Red&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foreground-set&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">g_object_set</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span>
<span class="nf">create_view_and_model</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkTreeViewColumn</span><span class="w">   </span><span class="o">*</span><span class="n">col</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkCellRenderer</span><span class="w">     </span><span class="o">*</span><span class="n">renderer</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w">           </span><span class="o">*</span><span class="n">view</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkTreeModel</span><span class="w">        </span><span class="o">*</span><span class="n">model</span><span class="p">;</span>

<span class="w">  </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_new</span><span class="p">();</span>

<span class="w">  </span><span class="cm">/* --- Column #1 --- */</span>

<span class="w">  </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_column_new</span><span class="p">();</span>

<span class="w">  </span><span class="n">gtk_tree_view_column_set_title</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;First Name&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* pack tree view column into tree view */</span>
<span class="w">  </span><span class="n">gtk_tree_view_append_column</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">view</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="p">);</span>

<span class="w">  </span><span class="n">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_cell_renderer_text_new</span><span class="p">();</span>

<span class="w">  </span><span class="cm">/* pack cell renderer into tree view column */</span>
<span class="w">  </span><span class="n">gtk_tree_view_column_pack_start</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* connect &#39;text&#39; property of the cell renderer to</span>
<span class="cm">   *  model column that contains the first name */</span>
<span class="w">  </span><span class="n">gtk_tree_view_column_add_attribute</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">COL_FIRST_NAME</span><span class="p">);</span>


<span class="w">  </span><span class="cm">/* --- Column #2 --- */</span>

<span class="w">  </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_column_new</span><span class="p">();</span>

<span class="w">  </span><span class="n">gtk_tree_view_column_set_title</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Last Name&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* pack tree view column into tree view */</span>
<span class="w">  </span><span class="n">gtk_tree_view_append_column</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">view</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="p">);</span>

<span class="w">  </span><span class="n">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_cell_renderer_text_new</span><span class="p">();</span>

<span class="w">  </span><span class="cm">/* pack cell renderer into tree view column */</span>
<span class="w">  </span><span class="n">gtk_tree_view_column_pack_start</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* connect &#39;text&#39; property of the cell renderer to</span>
<span class="cm">   *  model column that contains the last name */</span>
<span class="w">  </span><span class="n">gtk_tree_view_column_add_attribute</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">COL_LAST_NAME</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* set &#39;weight&#39; property of the cell renderer to</span>
<span class="cm">   *  bold print (we want all last names in bold) */</span>
<span class="w">  </span><span class="n">g_object_set</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span>
<span class="w">               </span><span class="s">&quot;weight&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">PANGO_WEIGHT_BOLD</span><span class="p">,</span>
<span class="w">               </span><span class="s">&quot;weight-set&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">,</span>
<span class="w">               </span><span class="nb">NULL</span><span class="p">);</span>


<span class="w">  </span><span class="cm">/* --- Column #3 --- */</span>

<span class="w">  </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_column_new</span><span class="p">();</span>

<span class="w">  </span><span class="n">gtk_tree_view_column_set_title</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Age&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* pack tree view column into tree view */</span>
<span class="w">  </span><span class="n">gtk_tree_view_append_column</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">view</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="p">);</span>

<span class="w">  </span><span class="n">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_cell_renderer_text_new</span><span class="p">();</span>

<span class="w">  </span><span class="cm">/* pack cell renderer into tree view column */</span>
<span class="w">  </span><span class="n">gtk_tree_view_column_pack_start</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* connect a cell data function */</span>
<span class="w">  </span><span class="n">gtk_tree_view_column_set_cell_data_func</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="n">age_cell_data_func</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>


<span class="w">  </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_and_fill_model</span><span class="p">();</span>

<span class="w">  </span><span class="n">gtk_tree_view_set_model</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">view</span><span class="p">),</span><span class="w"> </span><span class="n">model</span><span class="p">);</span>

<span class="w">  </span><span class="n">g_object_unref</span><span class="p">(</span><span class="n">model</span><span class="p">);</span><span class="w"> </span><span class="cm">/* destroy model automatically with view */</span>

<span class="w">  </span><span class="n">gtk_tree_selection_set_mode</span><span class="p">(</span><span class="n">gtk_tree_view_get_selection</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">view</span><span class="p">)),</span>
<span class="w">                              </span><span class="n">GTK_SELECTION_NONE</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span>
<span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">window</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">view</span><span class="p">;</span>

<span class="w">  </span><span class="n">gtk_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">argv</span><span class="p">);</span>

<span class="w">  </span><span class="n">window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_window_new</span><span class="p">(</span><span class="n">GTK_WINDOW_TOPLEVEL</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;delete_event&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">gtk_main_quit</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"> </span><span class="cm">/* dirty */</span>

<span class="w">  </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_view_and_model</span><span class="p">();</span>

<span class="w">  </span><span class="n">gtk_container_add</span><span class="p">(</span><span class="n">GTK_CONTAINER</span><span class="p">(</span><span class="n">window</span><span class="p">),</span><span class="w"> </span><span class="n">view</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_widget_show_all</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_main</span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="how-to-make-a-whole-row-bold-or-coloured">How to Make a Whole Row Bold or Coloured<a class="md-anchor" href="treeview-tutorial.html#how-to-make-a-whole-row-bold-or-coloured" title="Permanent link"></a></h3>
<p>This seems to be a frequently asked question, so it is worth mentioning it
here. You have the two approaches mentioned above: either you use cell data
functions, and check in each whether a particular row should be highlighted
in a particular way (bold, coloured, whatever), and then set the renderer
properties accordingly (and unset them if you want that row to look normal),
or you use attributes. Cell data functions are most likely not the right
choice in this case&nbsp;though.</p>
<p>If you only want every second line to have a gray background to make it
easier for the user to see which data belongs to which line in wide tree
views, then you do not have to bother with the stuff mentioned here. Instead
just set the rules hint on the tree view as described in the here, and
everything will be done automatically, in colours that conform to the chosen
theme even (unless the theme disables rule hints, that&nbsp;is).</p>
<p>Otherwise, the most suitable approach for most cases is that you add two
columns to your model, one for the property itself (e.g. a column
<code>COL_ROW_COLOR</code> of type <code>G_TYPE_STRING</code>), and one for the boolean flag of the
property (e.g. a column <code>COL_ROW_COLOR_SET</code> of type <code>G_TYPE_BOOLEAN</code>). You would
then connect these columns with the &#8220;foreground&#8221; and &#8220;foreground-set&#8221;
properties of each renderer. Now, whenever you set a row&#8217;s <code>COL_ROW_COLOR</code>
field to a colour, and set that row&#8217;s <code>COL_ROW_COLOR_SET</code> field to <code>TRUE</code>, then
this column will be rendered in the colour of your choice. If you only want
either the default text colour or one special other colour, you could even
achieve the same thing with just one extra model column: in this case you
could just set all renderer&#8217;s &#8220;foreground&#8221; property to whatever special
color you want, and only connect the <code>COL_ROW_COLOR_SET</code> column to all
renderer&#8217;s &#8220;foreground-set&#8221; property using attributes. This works similar
with any other attribute, only that you need to adjust the data type for the
property of course (e.g. &#8220;weight&#8221; would take a <code>PANGO_TYPE_WEIGHT</code>).</p>
<p>As a general rule, you should not change the text colour or the background
colour of a cell unless you have a really good reason for it. To quote Havoc
Pennington: &#8220;Because colors in <span class="caps">GTK</span> represent a theme the user has chosen,
you should never set colors purely for aesthetic reasons. If users don&#8217;t
like <span class="caps">GTK</span> gray, they can change it themselves to their favorite shade of&nbsp;orange.&#8221;</p>
<h3 id="how-to-pack-icons-into-the-tree-view">How to Pack Icons into the Tree View<a class="md-anchor" href="treeview-tutorial.html#how-to-pack-icons-into-the-tree-view" title="Permanent link"></a></h3>
<p>So far we have only put text in the tree view. While everything you need to
know to display icons (in the form of <code>GdkPixbuf</code>s) has been introduced in the
previous sections, a short example might help to make things clearer. The
following code will pack an icon and some text into the same tree view&nbsp;column:</p>
<div class="codehilite"><pre><span></span><code><span class="k">enum</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">COL_ICON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="n">COL_TEXT</span><span class="p">,</span>
<span class="w">  </span><span class="n">NUM_COLS</span>
<span class="p">};</span>

<span class="n">GtkListStore</span><span class="w"> </span><span class="o">*</span>
<span class="nf">create_liststore</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkListStore</span><span class="w">  </span><span class="o">*</span><span class="n">store</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkTreeIter</span><span class="w">    </span><span class="n">iter</span><span class="p">;</span>
<span class="w">  </span><span class="n">GdkPixbuf</span><span class="w">     </span><span class="o">*</span><span class="n">icon</span><span class="p">;</span>
<span class="w">  </span><span class="n">GError</span><span class="w">        </span><span class="o">*</span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>

<span class="w">  </span><span class="n">store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_list_store_new</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">GDK_TYPE_PIXBUF</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_STRING</span><span class="p">);</span>

<span class="w">  </span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdk_pixbuf_new_from_file</span><span class="p">(</span><span class="s">&quot;icon.png&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">g_warning</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Could not load icon: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="o">-&gt;</span><span class="n">message</span><span class="p">);</span>
<span class="w">    </span><span class="n">g_error_free</span><span class="p">(</span><span class="n">error</span><span class="p">);</span>
<span class="w">    </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">gtk_list_store_append</span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_list_store_set</span><span class="p">(</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span>
<span class="w">                     </span><span class="n">COL_ICON</span><span class="p">,</span><span class="w"> </span><span class="n">icon</span><span class="p">,</span>
<span class="w">                     </span><span class="n">COL_TEXT</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;example&quot;</span><span class="p">,</span>
<span class="w">                     </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">store</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span>
<span class="nf">create_treeview</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkTreeModel</span><span class="w">      </span><span class="o">*</span><span class="n">model</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkTreeViewColumn</span><span class="w"> </span><span class="o">*</span><span class="n">col</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkCellRenderer</span><span class="w">   </span><span class="o">*</span><span class="n">renderer</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w">         </span><span class="o">*</span><span class="n">view</span><span class="p">;</span>

<span class="w">  </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">create_liststore</span><span class="p">());</span>

<span class="w">  </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_new_with_model</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>

<span class="w">  </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_column_new</span><span class="p">();</span>
<span class="w">  </span><span class="n">gtk_tree_view_column_set_title</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Title&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="n">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_cell_renderer_pixbuf_new</span><span class="p">();</span>
<span class="w">  </span><span class="n">gtk_tree_view_column_pack_start</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="n">FALSE</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_tree_view_column_set_attributes</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">renderer</span><span class="p">,</span>
<span class="w">                                      </span><span class="s">&quot;pixbuf&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">COL_ICON</span><span class="p">,</span>
<span class="w">                                      </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="n">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_cell_renderer_text_new</span><span class="p">();</span>
<span class="w">  </span><span class="n">gtk_tree_view_column_pack_start</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_tree_view_column_set_attributes</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">renderer</span><span class="p">,</span>
<span class="w">                                      </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">COL_TEXT</span><span class="p">,</span>
<span class="w">                                      </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_tree_view_append_column</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">view</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_widget_show_all</span><span class="p">(</span><span class="n">view</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>Note that the tree view will not resize icons for you, but displays them in
their original size. If you want to display stock icons instead of
<code>GdkPixbuf</code>s loaded from file, you should have a look at the &#8220;stock-id&#8221;
property of <code>GtkCellRendererPixbuf</code> (and your model column should be of type
<code>G_TYPE_STRING</code>, as all stock IDs are just strings by which to identify the
stock&nbsp;icon).</p>
<h2 id="selections-double-clicks-and-context-menus">Selections, Double-Clicks and Context Menus<a class="md-anchor" href="treeview-tutorial.html#selections-double-clicks-and-context-menus" title="Permanent link"></a></h2>
<h3 id="handling-selections">Handling Selections<a class="md-anchor" href="treeview-tutorial.html#handling-selections" title="Permanent link"></a></h3>
<p>One of the most basic features of a list or tree view is that rows can be
selected or unselected. Selections are handled using the <code>GtkTreeSelection</code>
object of a tree view. Every tree view automatically has a
<code>GtkTreeSelection</code>
associated with it, and you can get it using <code>gtk_tree_view_get_selection()</code>.
Selections are handled completely on the tree view side, which means that
the model knows nothing about which rows are selected or not. There is no
particular reason why selection handling could not have been implemented
with functions that access the tree view widget directly, but for reasons of
<span class="caps">API</span> cleanliness and code clarity the <span class="caps">GTK</span> developers decided to create this
special <code>GtkTreeSelection</code> object that then internally deals with the tree
view widget. You will never need to create a tree selection object, it will
be created for you automatically when you create a new tree view. You only
need to use said <code>gtk_tree_view_get_selection()</code> function to get a pointer to
the selection&nbsp;object.</p>
<p>There are three ways to deal with tree view selections: either you get a
list of the currently selected rows whenever you need it, for example within
a context menu function, or you keep track of all select and unselect
actions and keep a list of the currently selected rows around for whenever
you need them; as a last resort, you can also traverse your list or tree and
check each single row for whether it is selected or not (which you need to
do if you want all rows that are not selected for&nbsp;example).</p>
<h4 id="selection-modes">Selection Modes<a class="md-anchor" href="treeview-tutorial.html#selection-modes" title="Permanent link"></a></h4>
<p>You can use <code>gtk_tree_selection_set_mode()</code> to influence the way that
selections are handled. There are four selection&nbsp;modes:</p>
<ul>
<li><code>GTK_SELECTION_NONE</code> - no items can be&nbsp;selected</li>
<li><code>GTK_SELECTION_SINGLE</code> - no more than one item can be&nbsp;selected</li>
<li><code>GTK_SELECTION_BROWSE</code> - exactly one item is always&nbsp;selected</li>
<li><code>GTK_SELECTION_MULTIPLE</code> - anything between no item and all items can be&nbsp;selected</li>
</ul>
<h4 id="getting-the-currently-selected-rows">Getting the Currently Selected Rows<a class="md-anchor" href="treeview-tutorial.html#getting-the-currently-selected-rows" title="Permanent link"></a></h4>
<p>You can access the currently selected rows either by traversing all selected
rows using <code>gtk_tree_selection_selected_foreach()</code> or get a <code>GList</code> of tree
paths of the selected rows using <code>gtk_tree_selection_get_selected_rows()</code>.</p>
<p>If the selection mode you are using is either <code>GTK_SELECTION_SINGLE</code> or
<code>GTK_SELECTION_BROWSE</code>, the most convenient way to get the selected row is
the function <code>gtk_tree_selection_get_selected()</code>, which will return <code>TRUE</code>
and fill in the specified tree iter with the selected row (if a row is
selected), and return <code>FALSE</code> otherwise. It is used like&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">GtkTreeSelection</span><span class="w"> </span><span class="o">*</span><span class="n">selection</span><span class="p">;</span>
<span class="n">GtkTreeModel</span><span class="w"> </span><span class="o">*</span><span class="n">model</span><span class="p">;</span>
<span class="n">GtkTreeIter</span><span class="w"> </span><span class="n">iter</span><span class="p">;</span>

<span class="cm">/* This will only work in single or browse selection mode! */</span>

<span class="n">selection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_get_selection</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">view</span><span class="p">));</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_tree_selection_get_selected</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">))</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">;</span>

<span class="w">    </span><span class="n">gtk_tree_model_get</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="n">COL_NAME</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">    </span><span class="n">g_print</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;selected row is: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>

<span class="w">    </span><span class="n">g_free</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="k">else</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">g_print</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;no row selected.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</code></pre></div>

<p>One thing you need to be aware of is that you need to take care when
removing rows from the model in a <code>gtk_tree_selection_selected_foreach()</code>
callback, or when looping through the list that
<code>gtk_tree_selection_get_selected_rows()</code> returns (because it contains paths,
and when you remove rows in the middle, then the old paths will point to
either a non-existing row, or to another row than the one selected). You
have two ways around this problem: one way is to use the solution to
removing multiple rows that has been described above, ie. to get tree row
references for all selected rows and then remove the rows one by one; the
other solution is to sort the list of selected tree paths so that the last
rows come first in the list, so that you remove rows from the end of the
list or tree. You cannot remove rows from within a foreach callback in any
case, that is simply not&nbsp;allowed.</p>
<p>Here is an example of how to use <code>gtk_tree_selection_selected_foreach()</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">gboolean</span>
<span class="nf">view_selected_foreach_func</span><span class="w"> </span><span class="p">(</span><span class="n">GtkTreeModel</span><span class="w">  </span><span class="o">*</span><span class="n">model</span><span class="p">,</span>
<span class="w">                            </span><span class="n">GtkTreePath</span><span class="w">   </span><span class="o">*</span><span class="n">path</span><span class="p">,</span>
<span class="w">                            </span><span class="n">GtkTreeIter</span><span class="w">   </span><span class="o">*</span><span class="n">iter</span><span class="p">,</span>
<span class="w">                            </span><span class="n">gpointer</span><span class="w">       </span><span class="n">userdata</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">;</span>

<span class="w">  </span><span class="n">gtk_tree_model_get</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="n">COL_NAME</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">  </span><span class="n">g_print</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;%s is selected</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>

<span class="w">  </span><span class="n">g_free</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span>
<span class="nf">do_something_with_all_selected_rows</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">treeview</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkTreeSelection</span><span class="w"> </span><span class="o">*</span><span class="n">selection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_get_selection</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">treeview</span><span class="p">));</span>

<span class="w">  </span><span class="n">gtk_tree_selection_selected_foreach</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span><span class="w"> </span><span class="n">view_selected_foreach_func</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span>
<span class="nf">create_view</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">view</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkTreeSelection</span><span class="w"> </span><span class="o">*</span><span class="n">selection</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// ...</span>

<span class="w">  </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_new</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// ...</span>

<span class="w">  </span><span class="n">selection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_get_selection</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">view</span><span class="p">));</span>

<span class="w">  </span><span class="n">gtk_tree_selection_set_mode</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span><span class="w"> </span><span class="n">GTK_SELECTION_MULTIPLE</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="using-selection-functions">Using Selection Functions<a class="md-anchor" href="treeview-tutorial.html#using-selection-functions" title="Permanent link"></a></h4>
<p>You can set up a custom selection function with
<code>gtk_tree_selection_set_select_function()</code>. This function will then be
called every time a row is going to be selected or unselected (meaning: it
will be called before the selection status of that row is changed).
Selection functions are commonly used for the following&nbsp;things:</p>
<ol>
<li>&#8230; to keep track of the currently selected items (then you maintain a
    list of selected items yourself). In this case, note again that your
    selection function is called before the row&#8217;s selection status is
    changed. In other words: if the row is going to be selected, then the
    boolean path_currently_selected variable that is passed to the selection
    function is still <code>FALSE</code>. Also note that the selection function might not
    always be called when a row is removed, so you either have to unselect a
    row before you remove it to make sure your selection function is called
    and removes the row from your list, or check the validity of a row when
    you process the selection list you keep. You should not store tree paths
    in your self-maintained list of of selected rows, because whenever rows
    are added or removed or the model is resorted the paths might point to
    other rows. Use tree row references or other unique means of identifying
    a row&nbsp;instead.</li>
<li>&#8230; to tell <span class="caps">GTK</span> whether it is allowed to select or unselect that
    specific row (you should make sure though that it is otherwise obvious
    to a user whether a row can be selected or not, otherwise the user will
    be confused if she just cannot select or unselect a row). This is done
    by returning <code>TRUE</code> or <code>FALSE</code> in the selection&nbsp;function.</li>
<li>&#8230; to take additional action whenever a row is selected or&nbsp;unselected. </li>
</ol>
<p>Yet another simple&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code><span class="n">gboolean</span>
<span class="nf">view_selection_func</span><span class="w"> </span><span class="p">(</span><span class="n">GtkTreeSelection</span><span class="w"> </span><span class="o">*</span><span class="n">selection</span><span class="p">,</span>
<span class="w">                     </span><span class="n">GtkTreeModel</span><span class="w">     </span><span class="o">*</span><span class="n">model</span><span class="p">,</span>
<span class="w">                     </span><span class="n">GtkTreePath</span><span class="w">      </span><span class="o">*</span><span class="n">path</span><span class="p">,</span>
<span class="w">                     </span><span class="n">gboolean</span><span class="w">          </span><span class="n">path_currently_selected</span><span class="p">,</span>
<span class="w">                     </span><span class="n">gpointer</span><span class="w">          </span><span class="n">userdata</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkTreeIter</span><span class="w"> </span><span class="n">iter</span><span class="p">;</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_tree_model_get_iter</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">;</span>

<span class="w">      </span><span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="n">COL_NAME</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">path_currently_selected</span><span class="p">)</span>
<span class="w">        </span><span class="n">g_print</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;%s is going to be selected.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<span class="w">      </span><span class="k">else</span>
<span class="w">        </span><span class="n">g_print</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;%s is going to be unselected.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>

<span class="w">      </span><span class="n">g_free</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">TRUE</span><span class="p">;</span><span class="w"> </span><span class="cm">/* allow selection state to change */</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">create_view</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">view</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkTreeSelection</span><span class="w"> </span><span class="o">*</span><span class="n">selection</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// ...</span>

<span class="w">  </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_new</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// ...</span>

<span class="w">  </span><span class="n">selection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_get_selection</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">view</span><span class="p">));</span>

<span class="w">  </span><span class="n">gtk_tree_selection_set_select_function</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span><span class="w"> </span><span class="n">view_selection_func</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="checking-whether-a-row-is-selected">Checking Whether a Row is Selected<a class="md-anchor" href="treeview-tutorial.html#checking-whether-a-row-is-selected" title="Permanent link"></a></h4>
<p>You can check whether a given row is selected or not using the functions
<code>gtk_tree_selection_iter_is_selected()</code> or
<code>gtk_tree_selection_path_is_selected()</code>.  If you want to know all rows that
are not selected, for example, you could just traverse the whole list or
tree, and use the above functions to check for each row whether it is
selected or&nbsp;not. </p>
<h4 id="selecting-and-unselecting-rows">Selecting and Unselecting Rows<a class="md-anchor" href="treeview-tutorial.html#selecting-and-unselecting-rows" title="Permanent link"></a></h4>
<p>You can select or unselect rows manually with
<code>gtk_tree_selection_select_iter()</code>, <code>gtk_tree_selection_select_path()</code>,
<code>gtk_tree_selection_unselect_iter()</code>, <code>gtk_tree_selection_unselect_path()</code>,
<code>gtk_tree_selection_select_all()</code>, and <code>gtk_tree_selection_unselect_all()</code>
should you ever need to do&nbsp;that.</p>
<h4 id="getting-the-number-of-selected-rows">Getting the Number of Selected Rows<a class="md-anchor" href="treeview-tutorial.html#getting-the-number-of-selected-rows" title="Permanent link"></a></h4>
<p>Sometimes you want to know the number of rows that are currently selected
(for example to set context menu entries active or inactive before you pop
up a context menu). If you are using selection mode <code>GTK_SELECTION_SINGLE</code>
or <code>GTK_SELECTION_BROWSE</code>, this is trivial to check with
<code>gtk_tree_selection_get_selected()</code>, which will return either <code>TRUE</code> or
<code>FALSE</code> (meaning one selected row or no selected&nbsp;row).</p>
<p>If you are using <code>GTK_SELECTION_MULTIPLE</code> or want a more general approach
that works for all selection modes,
`gtk_tree_selection_count_selected_rows() will return the information you
are looking&nbsp;for.</p>
<h3 id="double-clicks-on-a-row">Double-Clicks on a Row<a class="md-anchor" href="treeview-tutorial.html#double-clicks-on-a-row" title="Permanent link"></a></h3>
<p>Catching double-clicks on a row is quite easy and is done by connecting to a
tree view&#8217;s &#8220;row-activated&#8221; signal, like&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">void</span>
<span class="nf">view_onRowActivated</span><span class="w"> </span><span class="p">(</span><span class="n">GtkTreeView</span><span class="w">        </span><span class="o">*</span><span class="n">treeview</span><span class="p">,</span>
<span class="w">                     </span><span class="n">GtkTreePath</span><span class="w">        </span><span class="o">*</span><span class="n">path</span><span class="p">,</span>
<span class="w">                     </span><span class="n">GtkTreeViewColumn</span><span class="w">  </span><span class="o">*</span><span class="n">col</span><span class="p">,</span>
<span class="w">                     </span><span class="n">gpointer</span><span class="w">            </span><span class="n">userdata</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkTreeModel</span><span class="w"> </span><span class="o">*</span><span class="n">model</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkTreeIter</span><span class="w"> </span><span class="n">iter</span><span class="p">;</span>

<span class="w">  </span><span class="n">g_print</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;A row has been double-clicked!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_get_model</span><span class="p">(</span><span class="n">treeview</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_tree_model_get_iter</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">;</span>

<span class="w">      </span><span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="n">COLUMN_NAME</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">      </span><span class="n">g_print</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Double-clicked row contains name %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>

<span class="w">      </span><span class="n">g_free</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">create_view</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_new</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// ...</span>

<span class="w">  </span><span class="n">g_signal_connect</span><span class="p">(</span><span class="n">view</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;row-activated&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="p">(</span><span class="n">view_onRowActivated</span><span class="o">-</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="context-menus-on-right-click">Context Menus on Right Click<a class="md-anchor" href="treeview-tutorial.html#context-menus-on-right-click" title="Permanent link"></a></h3>
<p>Context menus are context-dependent menus that pop up when a user
right-clicks on a list or tree and usually let the user do something with
the selected items or manipulate the list or tree in other&nbsp;ways.</p>
<p>Right-clicks on a tree view are caught just like mouse button clicks are
caught with any other widgets, namely by connecting to the tree view&#8217;s
&#8220;button-press-event&#8221; signal handler (which is a <code>GtkWidget</code> signal, and as
<code>GtkTreeView</code> is derived from <code>GtkWidget</code> it has this signal as well).
Additionally, you should also connect to the &#8220;popup-menu&#8221; signal, so users
can access your context menu without a mouse. The &#8220;popup-menu&#8221; signal is
emitted when the user presses Shift-F10. Also, you should make sure that all
functions provided in your context menu can also be accessed by other means
such as the application&#8217;s main menu. See the <span class="caps">GNOME</span> Human Interface
Guidelines for more&nbsp;details.</p>
<p>Straight from the
a-snippet-of-code-says-more-than-a-thousand-words-department, some code to
look&nbsp;at:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">void</span>
<span class="nf">view_popup_menu_onDoSomething</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">menuitem</span><span class="p">,</span>
<span class="w">                               </span><span class="n">gpointer</span><span class="w"> </span><span class="n">userdata</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="cm">/* we passed the view as userdata when we connected the signal */</span>
<span class="w">  </span><span class="n">GtkTreeView</span><span class="w"> </span><span class="o">*</span><span class="n">treeview</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">userdata</span><span class="p">);</span>

<span class="w">  </span><span class="n">g_print</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Do something!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">view_popup_menu</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">treeview</span><span class="p">,</span>
<span class="w">                 </span><span class="n">GdkEventButton</span><span class="w"> </span><span class="o">*</span><span class="n">event</span><span class="p">,</span>
<span class="w">         </span><span class="n">gpointer</span><span class="w"> </span><span class="n">userdata</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">menu</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">menuitem</span><span class="p">;</span>

<span class="w">  </span><span class="n">menu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_menu_new</span><span class="p">();</span>

<span class="w">  </span><span class="n">menuitem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_menu_item_new_with_label</span><span class="p">(</span><span class="s">&quot;Do something&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="n">g_signal_connect</span><span class="p">(</span><span class="n">menuitem</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;activate&quot;</span><span class="p">,</span>
<span class="w">                   </span><span class="p">(</span><span class="n">GCallback</span><span class="p">)</span><span class="w"> </span><span class="n">view_popup_menu_onDoSomething</span><span class="p">,</span><span class="w"> </span><span class="n">treeview</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_menu_shell_append</span><span class="p">(</span><span class="n">GTK_MENU_SHELL</span><span class="p">(</span><span class="n">menu</span><span class="p">),</span><span class="w"> </span><span class="n">menuitem</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_widget_show_all</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Note: event can be NULL here when called from view_onPopupMenu;</span>
<span class="cm">   * gdk_event_get_time() accepts a NULL argument</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="n">gtk_menu_popup</span><span class="p">(</span><span class="n">GTK_MENU</span><span class="p">(</span><span class="n">menu</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span>
<span class="w">                 </span><span class="p">(</span><span class="n">event</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">event</span><span class="o">-&gt;</span><span class="n">button</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">                 </span><span class="n">gdk_event_get_time</span><span class="p">((</span><span class="n">GdkEvent</span><span class="o">*</span><span class="p">)</span><span class="n">event</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">gboolean</span>
<span class="nf">view_onButtonPressed</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">treeview</span><span class="p">,</span>
<span class="w">                      </span><span class="n">GdkEventButton</span><span class="w"> </span><span class="o">*</span><span class="n">event</span><span class="p">,</span>
<span class="w">              </span><span class="n">gpointer</span><span class="w"> </span><span class="n">userdata</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="cm">/* single click with the right mouse button? */</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GDK_BUTTON_PRESS</span><span class="w">  </span><span class="o">&amp;&amp;</span><span class="w">  </span><span class="n">event</span><span class="o">-&gt;</span><span class="n">button</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">g_print</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Single right click on the tree view.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* optional: select row if no row is selected or only</span>
<span class="cm">     *  one other row is selected (will only do something</span>
<span class="cm">     *  if you set a tree selection mode as described later</span>
<span class="cm">     *  in the tutorial) */</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">GtkTreeSelection</span><span class="w"> </span><span class="o">*</span><span class="n">selection</span><span class="p">;</span>

<span class="w">      </span><span class="n">selection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_get_selection</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">treeview</span><span class="p">));</span>

<span class="w">      </span><span class="cm">/* Note: gtk_tree_selection_count_selected_rows() does not</span>
<span class="cm">       *   exist in gtk+-2.0, only in gtk+ &gt;= v2.2 ! */</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_tree_selection_count_selected_rows</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span><span class="w">  </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">         </span><span class="n">GtkTreePath</span><span class="w"> </span><span class="o">*</span><span class="n">path</span><span class="p">;</span>

<span class="w">         </span><span class="cm">/* Get tree path for row that was clicked */</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_tree_view_get_path_at_pos</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">treeview</span><span class="p">),</span>
<span class="w">                                           </span><span class="p">(</span><span class="n">gint</span><span class="p">)</span><span class="w"> </span><span class="n">event</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                           </span><span class="p">(</span><span class="n">gint</span><span class="p">)</span><span class="w"> </span><span class="n">event</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">,</span>
<span class="w">                                           </span><span class="o">&amp;</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">           </span><span class="n">gtk_tree_selection_unselect_all</span><span class="p">(</span><span class="n">selection</span><span class="p">);</span>
<span class="w">           </span><span class="n">gtk_tree_selection_select_path</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
<span class="w">           </span><span class="n">gtk_tree_path_free</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="cm">/* end of optional bit */</span>

<span class="w">    </span><span class="n">view_popup_menu</span><span class="p">(</span><span class="n">treeview</span><span class="p">,</span><span class="w"> </span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="n">userdata</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">GDK_EVENT_STOP</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">GDK_EVENT_PROPAGATE</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">gboolean</span>
<span class="nf">view_onPopupMenu</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">treeview</span><span class="p">,</span>
<span class="w">                  </span><span class="n">gpointer</span><span class="w"> </span><span class="n">userdata</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">view_popup_menu</span><span class="p">(</span><span class="n">treeview</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">userdata</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">GDK_EVENT_STOP</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">create_view</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_new</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// ...</span>

<span class="w">  </span><span class="n">g_signal_connect</span><span class="p">(</span><span class="n">view</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;button-press-event&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="p">(</span><span class="n">view_onButtonPressed</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="p">(</span><span class="n">view</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;popup-menu&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="p">(</span><span class="n">view_onPopupMenu</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="sorting">Sorting<a class="md-anchor" href="treeview-tutorial.html#sorting" title="Permanent link"></a></h2>
<p>Lists and trees are meant to be sorted. This is done using the
<code>GtkTreeSortable</code> interface that can be implemented by tree models.
&#8216;Interface&#8217; means that you can just cast a <code>GtkTreeModel</code> into a
GtkTreeSortable with <code>GTK_TREE_SORTABLE(model)</code> and use the documented tree
sortable functions on it, just like we did before when we cast a list store
to a tree model and used the <code>gtk_tree_model_foo()</code> family of functions.
Both <code>GtkListStore</code> and <code>GtkTreeStore</code> implement the tree sortable&nbsp;interface.</p>
<p>The most straight forward way to sort a list store or tree store is to
directly use the tree sortable interface on them. This will sort the store
in place, meaning that rows will actually be reordered in the store if
required. This has the advantage that the position of a row in the tree view
will always be the same as the position of a row in the model, in other
words: a tree path refering to a row in the view will always refer to the
same row in the model, so you can get a row&#8217;s iter easily with
<code>gtk_tree_model_get_iter()</code> using a tree path supplied by the tree view.
This is not only convenient, but also sufficient for most&nbsp;scenarios.</p>
<p>However, there are cases when sorting a model in place is not desirable, for
example when several tree views display the same model with different
sortings, or when the unsorted state of the model has some special meaning
and needs to be restored at some point. This is where <code>GtkTreeModelSort</code> comes
in, which is a special model that maps the unsorted rows of a child model
(e.g. a list store or tree store) into a sorted state without changing the
child&nbsp;model.</p>
<h3 id="gtktreesortable">GtkTreeSortable<a class="md-anchor" href="treeview-tutorial.html#gtktreesortable" title="Permanent link"></a></h3>
<p>The tree sortable interface is fairly simple and should be easy to use.
Basically you define a &#8216;sort column <span class="caps">ID</span>&#8217; integer for every criterion you
might want to sort by and tell the tree sortable which function should be
called to compare two rows (represented by two tree iters) for every sort <span class="caps">ID</span>
with <code>gtk_tree_sortable_set_sort_func()</code>. Then you sort the model by setting
the sort column <span class="caps">ID</span> and sort order with
<code>gtk_tree_sortable_set_sort_column_id()</code>, and the model will be re-sorted
using the compare function you have set up. Your sort column IDs can
correspond to your model columns, but they do not have to (you might want to
sort according to a criterion that is not directly represented by the data
in one single model column, for example). Some code to illustrate&nbsp;this: </p>
<div class="codehilite"><pre><span></span><code><span class="k">enum</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">COL_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="n">COL_YEAR_BORN</span>
<span class="p">};</span>

<span class="k">enum</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">SORTID_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="n">SORTID_YEAR</span>
<span class="p">};</span>

<span class="n">GtkTreeModel</span><span class="w">  </span><span class="o">*</span><span class="n">liststore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>

<span class="kt">void</span>
<span class="nf">toolbar_onSortByYear</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkTreeSortable</span><span class="w"> </span><span class="o">*</span><span class="n">sortable</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkSortType</span><span class="w"> </span><span class="n">order</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">sortid</span><span class="p">;</span>

<span class="w">  </span><span class="n">sortable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GTK_TREE_SORTABLE</span><span class="p">(</span><span class="n">liststore</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* If we are already sorting by year, reverse sort order,</span>
<span class="cm">   * otherwise set it to year in ascending order</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_tree_sortable_get_sort_column_id</span><span class="p">(</span><span class="n">sortable</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sortid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">      </span><span class="n">sortid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SORTID_YEAR</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">GtkSortType</span><span class="w"> </span><span class="n">neworder</span><span class="p">;</span>

<span class="w">      </span><span class="n">neworder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">order</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GTK_SORT_ASCENDING</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">GTK_SORT_DESCENDING</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">GTK_SORT_ASCENDING</span><span class="p">;</span>

<span class="w">      </span><span class="n">gtk_tree_sortable_set_sort_column_id</span><span class="p">(</span><span class="n">sortable</span><span class="p">,</span><span class="w"> </span><span class="n">SORTID_YEAR</span><span class="p">,</span><span class="w"> </span><span class="n">neworder</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">gtk_tree_sortable_set_sort_column_id</span><span class="p">(</span><span class="n">sortable</span><span class="p">,</span><span class="w"> </span><span class="n">SORTID_YEAR</span><span class="p">,</span><span class="w"> </span><span class="n">GTK_SORT_ASCENDING</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* This is not pretty. Of course you can also use a</span>
<span class="cm"> * separate compare function for each sort ID value</span>
<span class="cm"> */</span>
<span class="kt">int</span>
<span class="nf">sort_iter_compare_func</span><span class="w"> </span><span class="p">(</span><span class="n">GtkTreeModel</span><span class="w"> </span><span class="o">*</span><span class="n">model</span><span class="p">,</span>
<span class="w">                        </span><span class="n">GtkTreeIter</span><span class="w">  </span><span class="o">*</span><span class="n">a</span><span class="p">,</span>
<span class="w">                        </span><span class="n">GtkTreeIter</span><span class="w">  </span><span class="o">*</span><span class="n">b</span><span class="p">,</span>
<span class="w">                        </span><span class="n">gpointer</span><span class="w">      </span><span class="n">userdata</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">sortcol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPOINTER_TO_INT</span><span class="p">(</span><span class="n">userdata</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">sortcol</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">SORTID_NAME</span><span class="p">:</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name1</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">name2</span><span class="p">;</span>

<span class="w">        </span><span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">COL_NAME</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name1</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>
<span class="w">        </span><span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">COL_NAME</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">name2</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">name2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">name2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">              </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="cm">/* both equal =&gt; ret = 0 */</span>

<span class="w">            </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">name1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g_utf8_collate</span><span class="p">(</span><span class="n">name1</span><span class="p">,</span><span class="n">name2</span><span class="p">);</span>
<span class="w">          </span><span class="p">}</span>

<span class="w">        </span><span class="n">g_free</span><span class="p">(</span><span class="n">name1</span><span class="p">);</span>
<span class="w">        </span><span class="n">g_free</span><span class="p">(</span><span class="n">name2</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">SORTID_YEAR</span><span class="p">:</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="n">guint</span><span class="w"> </span><span class="n">year1</span><span class="p">,</span><span class="w"> </span><span class="n">year2</span><span class="p">;</span>

<span class="w">        </span><span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">COL_YEAR_BORN</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">year1</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>
<span class="w">        </span><span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">COL_YEAR_BORN</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">year2</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">year1</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">year2</span><span class="p">)</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">year1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">year2</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="cm">/* else both equal =&gt; ret = 0 */</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>

<span class="w">    </span><span class="k">default</span><span class="o">:</span>
<span class="w">      </span><span class="n">g_return_val_if_reached</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">create_list_and_view</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkTreeSortable</span><span class="w"> </span><span class="o">*</span><span class="n">sortable</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// ...</span>

<span class="w">  </span><span class="n">liststore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_list_store_new</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_STRING</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_UINT</span><span class="p">);</span>

<span class="w">  </span><span class="n">sortable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GTK_TREE_SORTABLE</span><span class="p">(</span><span class="n">liststore</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_tree_sortable_set_sort_func</span><span class="p">(</span><span class="n">sortable</span><span class="p">,</span><span class="w"> </span><span class="n">SORTID_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">sort_iter_compare_func</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">SORTID_NAME</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_tree_sortable_set_sort_func</span><span class="p">(</span><span class="n">sortable</span><span class="p">,</span><span class="w"> </span><span class="n">SORTID_YEAR</span><span class="p">,</span><span class="w"> </span><span class="n">sort_iter_compare_func</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">SORTID_YEAR</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// set initial sort order</span>
<span class="w">  </span><span class="n">gtk_tree_sortable_set_sort_column_id</span><span class="p">(</span><span class="n">sortable</span><span class="p">,</span><span class="w"> </span><span class="n">SORTID_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">GTK_SORT_ASCENDING</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// ...</span>

<span class="w">  </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_new_with_model</span><span class="p">(</span><span class="n">liststore</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>

<p>Usually things are a bit easier if you make use of the tree view column
headers for sorting, in which case you only need to assign sort column IDs
and your compare functions, but do not need to set the current sort column
<span class="caps">ID</span> or order yourself (see&nbsp;below).</p>
<p>Your tree iter compare function should return a negative value if the row
specified by iter a comes before the row specified by iter b, and a positive
value if row b comes before row a. It should return 0 if both rows are equal
according to your sorting criterion (you might want to use a second sort
criterion though to avoid &#8216;jumping&#8217; of equal rows when the store gets
resorted). Your tree iter compare function should not take the sort order
into account, but assume an ascending sort order (otherwise bad things will&nbsp;happen).</p>
<h3 id="gtktreemodelsort"><code>GtkTreeModelSort</code><a class="md-anchor" href="treeview-tutorial.html#gtktreemodelsort" title="Permanent link"></a></h3>
<p><code>GtkTreeModelSort</code> is a wrapper tree model. It takes another tree model such
as a list store or a tree store as child model, and presents the child model
to the &#8216;outside&#8217; (ie. a tree view or whoever else is accessing it via the
tree model interface) in a sorted state. It does that without changing the
order of the rows in the child model. This is useful if you want to display
the same model in different tree views with different sorting criteria for
each tree view, for example, or if you need to restore the original unsorted
state of your store again at some&nbsp;point.</p>
<p><code>GtkTreeModelSort</code> implements the <code>GtkTreeSortable</code> interface, so you can
treat it just as if it was your data store for sorting purposes. Here is the
basic setup with a tree&nbsp;view:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">void</span>
<span class="nf">create_list_and_view</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// ...</span>

<span class="w">  </span><span class="n">liststore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_list_store_new</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_STRING</span><span class="p">,</span><span class="w"> </span><span class="n">G_TYPE_UINT</span><span class="p">);</span>

<span class="w">  </span><span class="n">sortmodel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_model_sort_new_with_model</span><span class="p">(</span><span class="n">liststore</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_tree_sortable_set_sort_func</span><span class="p">(</span><span class="n">GTK_TREE_SORTABLE</span><span class="p">(</span><span class="n">sortmodel</span><span class="p">),</span><span class="w"> </span><span class="n">SORTID_NAME</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">sort_func</span><span class="p">,</span><span class="w"> </span><span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">SORTID_NAME</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_tree_sortable_set_sort_func</span><span class="p">(</span><span class="n">GTK_TREE_SORTABLE</span><span class="p">(</span><span class="n">sortmodel</span><span class="p">),</span><span class="w"> </span><span class="n">SORTID_YEAR</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">sort_func</span><span class="p">,</span><span class="w"> </span><span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">SORTID_YEAR</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// set initial sort order</span>
<span class="w">  </span><span class="n">gtk_tree_sortable_set_sort_column_id</span><span class="p">(</span><span class="n">GTK_TREE_SORTABLE</span><span class="p">(</span><span class="n">sortmodel</span><span class="p">),</span>
<span class="w">                                       </span><span class="n">SORTID_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">GTK_SORT_ASCENDING</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// ...</span>

<span class="w">  </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_new_with_model</span><span class="p">(</span><span class="n">sortmodel</span><span class="p">);</span>

<span class="w">  </span><span class="c1">//...</span>
<span class="p">}</span>
</code></pre></div>

<p>However, when using the sort tree model, you need to be careful when you use
iters and paths with the model. This is because a path pointing to a row in
the view (and the sort tree model here) does probably not point to the same
row in the child model which is your original list store or tree store,
because the row order in the child model is probably different from the
sorted order. Similarly, an iter that is valid for the sort tree model is
not valid for the child model, and vice versa. You can convert paths and
iters from and to the child model using
<code>gtk_tree_model_sort_convert_child_path_to_path()</code>,
<code>gtk_tree_model_sort_convert_child_iter_to_iter()</code>,
<code>gtk_tree_model_sort_convert_path_to_child_path()</code>, and
<code>gtk_tree_model_sort_convert_iter_to_child_iter()</code>. You are unlikely to need
these functions frequently though, as you can still directly use
<code>gtk_tree_model_get()</code> on the sort tree model with a path supplied by the
tree&nbsp;view.</p>
<p>For the tree view, the sort tree model is the &#8216;real&#8217; model - it knows
nothing about the sort tree model&#8217;s child model at all, which means that any
path or iter that you get passed from the tree view in a callback or
otherwise will refer to the sort tree model, and that you need to pass a
path or iter refering to the sort tree model as well if you call tree view&nbsp;functions.</p>
<h3 id="sorting-and-tree-view-column-headers">Sorting and Tree View Column Headers<a class="md-anchor" href="treeview-tutorial.html#sorting-and-tree-view-column-headers" title="Permanent link"></a></h3>
<p>Unless you have hidden your tree view column headers or use custom tree view
column header widgets, each tree view column&#8217;s header can be made clickable.
Clicking on a tree view column&#8217;s header will then sort the list according to
the data in that column. You need to do two things to make this happen:
firstly, you need to tell your model which sort function to use for which
sort column <span class="caps">ID</span> with <code>gtk_tree_sortable_set_sort_func()</code>. Once you have done
this, you tell each tree view column which sort column <span class="caps">ID</span> should be active
if this column&#8217;s header is clicked. This is done with
<code>gtk_tree_view_column_set_sort_column_id()</code>.</p>
<p>And that is really all you need to do to get your list or tree sorted. The
tree view columns will automatically set the active sort column <span class="caps">ID</span> and sort
order for you if you click on a column&nbsp;header.</p>
<h3 id="case-insensitive-string-comparing">Case-insensitive String Comparing<a class="md-anchor" href="treeview-tutorial.html#case-insensitive-string-comparing" title="Permanent link"></a></h3>
<p>As described above in the &#8220;GtkCellRendererText, <span class="caps">UTF8</span>, and Pango markup&#8221;
section, all strings that are to be displayed in the tree view need to be
encoded in <span class="caps">UTF8</span> encoding. All <span class="caps">ASCII</span> strings are valid <span class="caps">UTF8</span>, but as soon as
non-<span class="caps">ASCII</span> characters are used, things get a bit tricky and the character
encoding&nbsp;matters.</p>
<p>Comparing two <span class="caps">ASCII</span> strings ignoring the case is trivial and can be done
using <code>g_ascii_strcasecmp()</code>, for example. strcasecmp will usually do the
same, only that it is also locale-aware to some extent. The only problem is
that a lot of users use locale character encodings that are not <span class="caps">UTF8</span>, so
strcasecmp does not take us very&nbsp;far.</p>
<p><code>g_utf8_collate()</code> will compare two strings in <span class="caps">UTF8</span> encoding, but it does not
ignore the case. In order to achieve at least half-way correct linguistic
case-insensitive sorting, we need to take a two-step approach. For example,
we could use <code>g_utf8_casefold()</code> to convert the strings to compare into a form
that is independent of case, and then use <code>g_utf8_collate()</code> to compare those
two strings (note that the strings returned by <code>g_utf8_casefold()</code> will not
resemble the original string in any recognisable way; they will work fine
for comparisons though). Alternatively, one could use <code>g_utf8_strdown()</code> on both
strings and then compare the results again with <code>g_utf8_collate()</code>.</p>
<p>Obviously, all this is not going to be very fast, and adds up if you have a
lot of rows. To speed things up, you can create a &#8216;collation key&#8217; with
<code>g_utf8_collate_key()</code> and store that in your model as well. A collation key is
just a string that does not mean anything to us, but can be used with strcmp
for string comparison purposes (which is a lot faster than <code>g_utf8_collate()</code>).</p>
<p>It should be noted that the way <code>g_utf8_collate()</code> sorts is dependent on the
current locale. Make sure you are not working in the &#8216;C&#8217; locale (=default,
none specified) before you are wondering about weird sorting orders. Check
with <code>echo $LANG</code> on a command line what you current locale is set&nbsp;to.</p>
<p>Check out the &#8220;Unicode Manipulation&#8221; section in the GLib <span class="caps">API</span> Reference for
more&nbsp;details.</p>
<h2 id="editable-cells">Editable Cells<a class="md-anchor" href="treeview-tutorial.html#editable-cells" title="Permanent link"></a></h2>
<h3 id="editable-text-cells">Editable Text Cells<a class="md-anchor" href="treeview-tutorial.html#editable-text-cells" title="Permanent link"></a></h3>
<p>With <code>GtkCellRendererText</code> you can not only display text, but you can also
allow the user to edit a single cell&#8217;s text right in the tree view by
double-clicking on a&nbsp;cell.</p>
<p>To make this work you need to tell the cell renderer that a cell is
editable, which you can do by setting the &#8220;editable&#8221; property of the text
cell renderer in question to <code>TRUE</code>. You can either do this on a per-row basis
(which allows you to set each single cell either editable or not) by
connecting the &#8220;editable&#8221; property to a boolean type column in your tree
model using attributes; or you can just&nbsp;use:</p>
<div class="codehilite"><pre><span></span><code><span class="n">g_object_set</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;editable&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
</code></pre></div>

<p>when you create the renderer, which sets all rows in that particular
renderer column to be&nbsp;editable.</p>
<p>Now that our cells are editable, we also want to be notified when a cell has
been edited. This can be achieved by connecting to the cell renderer&#8217;s
&#8220;edited&#8221;&nbsp;signal:</p>
<div class="codehilite"><pre><span></span><code><span class="n">g_signal_connect</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;edited&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="p">(</span><span class="n">cell_edited_callback</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
</code></pre></div>

<p>This callback is then called whenever a cell has been edited. Instead of
<span class="caps">NULL</span> we could have passed a pointer to the model as user data for
convenience, as we probably want to store the new value in the&nbsp;model.</p>
<p>The callback for the &#8220;edited&#8221; signal looks like this (the <span class="caps">API</span> reference is a
bit lacking in this particular&nbsp;case):</p>
<div class="codehilite"><pre><span></span><code><span class="kt">void</span>
<span class="nf">cell_edited_callback</span><span class="w"> </span><span class="p">(</span><span class="n">GtkCellRendererText</span><span class="w"> </span><span class="o">*</span><span class="n">cell</span><span class="p">,</span>
<span class="w">                      </span><span class="kt">char</span><span class="w">                </span><span class="o">*</span><span class="n">path_string</span><span class="p">,</span>
<span class="w">                      </span><span class="kt">char</span><span class="w">                </span><span class="o">*</span><span class="n">new_text</span><span class="p">,</span>
<span class="w">                      </span><span class="n">gpointer</span><span class="w">             </span><span class="n">user_data</span><span class="p">);</span>
</code></pre></div>

<p>The tree path is passed to the &#8220;edited&#8221; signal callback in string form. You
can convert this into a <code>GtkTreePath</code> with
<code>gtk_tree_path_new_from_string()</code>, or convert it into an iter with
<code>gtk_tree_model_get_iter_from_string()</code>.</p>
<p>Note that the cell renderer will not change the data for you in the store.
After a cell has been edited, you will only receive an &#8220;edited&#8221; signal. If
you do not change the data in the store, the old text will be rendered again
as if nothing had&nbsp;happened.</p>
<p>If you have multiple (renderer) columns with editable cells, it is not
necessary to have a different callback for each renderer, you can use the
same callback for all renderers, and attach some data to each renderer,
which you can later retrieve again in the callback to know which
renderer/column has been edited. This is done like this, for&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code><span class="n">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_cell_renderer_text_new</span><span class="p">();</span>
<span class="n">g_object_set_data</span><span class="p">(</span><span class="n">G_OBJECT</span><span class="p">(</span><span class="n">renderer</span><span class="p">),</span>
<span class="w">                  </span><span class="s">&quot;my_column_num&quot;</span><span class="p">,</span>
<span class="w">                  </span><span class="n">GUINT_TO_POINTER</span><span class="p">(</span><span class="n">COLUMN_NAME</span><span class="p">));</span>

<span class="p">...</span>

<span class="n">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_cell_renderer_text_new</span><span class="p">();</span>
<span class="n">g_object_set_data</span><span class="p">(</span><span class="n">G_OBJECT</span><span class="p">(</span><span class="n">renderer</span><span class="p">),</span>
<span class="w">                  </span><span class="s">&quot;my_column_num&quot;</span><span class="p">,</span>
<span class="w">                  </span><span class="n">GUINT_TO_POINTER</span><span class="p">(</span><span class="n">COLUMN_YEAR_OF_BIRTH</span><span class="p">));</span>
</code></pre></div>

<p>where <code>COLUMN_NAME</code> and <code>COLUMN_YEAR_OF_BIRTH</code> are enum values. In your
callback you can then get the column number&nbsp;with</p>
<div class="codehilite"><pre><span></span><code><span class="n">guint</span><span class="w"> </span><span class="n">column_number</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="n">GPOINTER_TO_UINT</span><span class="p">(</span><span class="n">g_object_get_data</span><span class="p">(</span><span class="n">G_OBJECT</span><span class="p">(</span><span class="n">renderer</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;my_column_num&quot;</span><span class="p">));</span>
</code></pre></div>

<p>You can use this mechanism to attach all kinds of custom data to any object
or widget, with a string identifier to your&nbsp;liking.</p>
<h4 id="setting-the-cursor-to-a-specific-cell">Setting the cursor to a specific cell<a class="md-anchor" href="treeview-tutorial.html#setting-the-cursor-to-a-specific-cell" title="Permanent link"></a></h4>
<p>You can move the cursor to a specific cell in a tree view with
<code>gtk_tree_view_set_cursor()</code> (or <code>gtk_tree_view_set_cursor_on_cell()</code> if you have
multiple editable cell renderers packed into one tree view column), and
start editing the cell if you want to. Similarly, you can get the current
row and focus column with <code>gtk_tree_view_get_cursor()</code>. Use
<code>gtk_widget_grab_focus(treeview)</code> will make sure that the tree view has the
keyboard&nbsp;focus.</p>
<p>As the <span class="caps">API</span> reference points out, the tree view needs to be realised for cell
editing to happen. In other words: If you want to start editing a specific
cell right at program startup, you need to set up an idle timeout with
<code>g_idle_add()</code> that does this for you as soon as the window and everything
else has been realised (return <code>G_SOURCE_REMOVE</code> in the timeout to make it
run only once).  Alternatively you could connect to the &#8220;realize&#8221; signal of
the treeview with <code>g_signal_connect_after()</code> to achieve the same&nbsp;thing.</p>
<p>Connect to the tree view&#8217;s &#8220;cursor-changed&#8221; and/or &#8220;move-cursor&#8221; signals to
keep track of the current position of the&nbsp;cursor.</p>
<h3 id="editable-toggle-and-radio-button-cells">Editable Toggle and Radio Button Cells<a class="md-anchor" href="treeview-tutorial.html#editable-toggle-and-radio-button-cells" title="Permanent link"></a></h3>
<p>Just like you can set a <code>GtkCellRendererText</code> editable, you can specify
whether a <code>GtkCellRendererToggle</code> should change its state when clicked by
setting the &#8220;activatable&#8221; property - either when you create the renderer (in
which case all cells in that column will be clickable) or by connecting the
renderer property to a model column of boolean type via&nbsp;attributes.</p>
<p>Connect to the &#8220;toggled&#8221; signal of the toggle cell renderer to be notified
when the user clicks on a toggle button (or radio button). The user click
will not change the value in the store, or the appearance of the value
rendered. The toggle button will only change state when you update the value
in the store. Until then it will be in an &#8220;inconsistent&#8221; state, which is
also why you should read the current value of that cell from the model, and
not from the cell&nbsp;renderer.</p>
<p>The callback for the &#8220;toggled&#8221; signal looks like this (the <span class="caps">API</span> reference is
a bit lacking in this particular&nbsp;case):</p>
<div class="codehilite"><pre><span></span><code><span class="kt">void</span>
<span class="nf">cell_toggled_callback</span><span class="w"> </span><span class="p">(</span><span class="n">GtkCellRendererToggle</span><span class="w"> </span><span class="o">*</span><span class="n">cell</span><span class="p">,</span>
<span class="w">                       </span><span class="kt">char</span><span class="w">                  </span><span class="o">*</span><span class="n">path_string</span><span class="p">,</span>
<span class="w">                       </span><span class="n">gpointer</span><span class="w">               </span><span class="n">user_data</span><span class="p">);</span>
</code></pre></div>

<p>Just like with the &#8220;edited&#8221; signal of the text cell renderer, the tree path
is passed to the &#8220;toggled&#8221; signal callback in string form. You can convert
this into a <code>GtkTreePath</code> with <code>gtk_tree_path_new_from_string()</code>, or convert
it into an iter with <code>gtk_tree_model_get_iter_from_string()</code>.</p>
<h3 id="editable-spin-button-cells">Editable Spin Button Cells<a class="md-anchor" href="treeview-tutorial.html#editable-spin-button-cells" title="Permanent link"></a></h3>
<p><span class="caps">GTK</span> provides a <code>GtkCellRendererSpin</code> cell renderer, which exposes a spin
button when editing its contents. You must provide a <code>GtkAdjustment</code> object
to control the range of appropriate values, as well as the increments to be&nbsp;applied.</p>
<h2 id="miscellaneous">Miscellaneous<a class="md-anchor" href="treeview-tutorial.html#miscellaneous" title="Permanent link"></a></h2>
<p>This section deals with issues and questions that did not seem to fit in
anywhere else in the&nbsp;tutorial.</p>
<h3 id="getting-the-column-number-from-a-tree-view-column-widget">Getting the Column Number from a Tree View Column Widget<a class="md-anchor" href="treeview-tutorial.html#getting-the-column-number-from-a-tree-view-column-widget" title="Permanent link"></a></h3>
<p>Signal callbacks often only get passed a pointer to a GtkTreeViewColumn when
the application programmer really just wants to know which column number was
affected. There are two ways to find out the position of a column within the
tree view. One way is to write a small helper function that looks up the
column number from a given tree view column object, like this for&nbsp;example:</p>
<div class="codehilite"><pre><span></span><code><span class="cm">/* Returns column number or -1 if not found or on error */</span>

<span class="kt">int</span>
<span class="nf">get_col_number_from_tree_view_column</span><span class="w"> </span><span class="p">(</span><span class="n">GtkTreeViewColumn</span><span class="w"> </span><span class="o">*</span><span class="n">col</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GList</span><span class="w"> </span><span class="o">*</span><span class="n">cols</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">num</span><span class="p">;</span>

<span class="w">  </span><span class="n">g_return_val_if_fail</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="p">);</span>
<span class="w">  </span><span class="n">g_return_val_if_fail</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">col</span><span class="o">-&gt;</span><span class="n">tree_view</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="p">);</span>

<span class="w">  </span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_get_columns</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">col</span><span class="o">-&gt;</span><span class="n">tree_view</span><span class="p">));</span>

<span class="w">  </span><span class="n">num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g_list_index</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">gpointer</span><span class="p">)</span><span class="w"> </span><span class="n">col</span><span class="p">);</span>

<span class="w">  </span><span class="n">g_list_free</span><span class="p">(</span><span class="n">cols</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">num</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>Alternatively, it is possible to use <code>g_object_set_data()</code> and
<code>g_object_get_data()</code> on the tree view column in order to identify which
column it is. This also has the advantage that you can still keep track of
your columns even if the columns get re-ordered within the tree view (a
feature which is usually disabled though). Use like&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code><span class="p">...</span>

<span class="k">enum</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">COL_FIRSTNAME</span><span class="p">,</span>
<span class="w">  </span><span class="n">COL_SURNAME</span><span class="p">,</span>
<span class="p">};</span>

<span class="p">...</span>

<span class="kt">void</span>
<span class="n">some_callback</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">treeview</span><span class="p">,</span><span class="w"> </span><span class="p">...,</span><span class="w"> </span><span class="n">GtkTreeViewColumn</span><span class="w"> </span><span class="o">*</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">guint</span><span class="w"> </span><span class="n">colnum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPOINTER_TO_UINT</span><span class="p">(</span><span class="n">g_object_get_data</span><span class="p">(</span><span class="n">G_OBJECT</span><span class="p">(</span><span class="n">col</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;columnnum&quot;</span><span class="p">));</span>

<span class="w">  </span><span class="p">...</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">create_view</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_column_new</span><span class="p">();</span>
<span class="w">  </span><span class="n">g_object_set_data</span><span class="p">(</span><span class="n">G_OBJECT</span><span class="p">(</span><span class="n">col</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;columnnum&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GUINT_TO_POINTER</span><span class="p">(</span><span class="n">COL_FIRSTNAME</span><span class="p">));</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_column_new</span><span class="p">();</span>
<span class="w">  </span><span class="n">g_object_set_data</span><span class="p">(</span><span class="n">G_OBJECT</span><span class="p">(</span><span class="n">col</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;columnnum&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GUINT_TO_POINTER</span><span class="p">(</span><span class="n">COL_SURNAME</span><span class="p">));</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>

<p><span class="dquo">&#8220;</span>columnnum&#8221; is a random string in the above example - you can use whatever
string you want instead, or store multiple bits of data (with different
string identifiers of course). Of course you can also combine both
approaches, as they do slightly different things (the first tracks the
&#8216;physical&#8217; position of a column within the tree view, the second tracks the
&#8216;meaning&#8217; of a column to you, independent of its position within the&nbsp;view).</p>
<h3 id="column-expander-visibility">Column Expander Visibility<a class="md-anchor" href="treeview-tutorial.html#column-expander-visibility" title="Permanent link"></a></h3>
<h4 id="hiding-the-column-expander">Hiding the Column Expander<a class="md-anchor" href="treeview-tutorial.html#hiding-the-column-expander" title="Permanent link"></a></h4>
<p>Is it possible to hide the column expander completely? Yes and no. What
follows, is probably a dirty hack at best and there is no guarantee that it
will work with upcoming Gtk+ versions or even with all past versions
(although the latter is easy enough to test of&nbsp;course).</p>
<p>What you can do to hide the column expander is to create an empty tree view
column (containing empty strings, for example) and make this the first
column in the tree view. Then you can hide that column with
<code>gtk_tree_view_column_set_visible()</code>. You will notice that the expander
column will now automatically move to the formerly second, now first,
visible column in the tree view. However, if you call
<code>gtk_tree_view_set_expander_column()</code> right after the call to
<code>set_visible()</code>, then the expander will move back to the hidden column, and
no expander is visible any&nbsp;longer.</p>
<p>This means of course that you will have to take care of expanding and
collapsing rows yourself and use the appropriate tree view functions. While
it is at last thinkable that one could implement custom expanders using
custom cell rendereres or pixbuf cell renderers, this is probably a task
that will keep you busy for more than five minutes. Keep those head ache
tablets nearby if you attempt it&nbsp;anyway&#8230; </p>
<h4 id="forcing-column-expander-visibility">Forcing Column Expander Visibility<a class="md-anchor" href="treeview-tutorial.html#forcing-column-expander-visibility" title="Permanent link"></a></h4>
<p>There are situations where an expander should be visible even if the row in question does not have any children yet, for instance when part of a model should only be loaded on request when a node gets expanded (e.g. to show the contents of a directory). This is not possible. An expander is only shown if a node has&nbsp;children.</p>
<p>A work-around for this problem exists however: simply attach an empty child row and set the node to collapsed state. Then listen for the tree view&#8217;s &#8220;row-expanded&#8221; signal, and fill the contents of the already existing row with the first new row, then append new child&nbsp;rows.</p>
<h3 id="getting-the-cell-renderer-a-click-event-happened-on">Getting the Cell Renderer a Click Event Happened On<a class="md-anchor" href="treeview-tutorial.html#getting-the-cell-renderer-a-click-event-happened-on" title="Permanent link"></a></h3>
<p>It seems that in many cases when people want to know the cell renderer a click event happened on, they do not really need to know the cell renderer, but rather want to modify an individual cell in a particular column. For this you do not need to know the cell renderer. Use gtk_tree_view_get_path_at_pos to get a tree path from the x and y coordinates of the button event that is passed to you in a &#8220;button-press-event&#8221; signal callback (if you use the &#8220;row-activated&#8221; signal to catch double-clicks you get the tree path passed directly into the callback function). Then convert that tree path into an iter using gtk_tree_model_get_iter and modify the data in the cell you want to modify with gtk_list_store_set or&nbsp;gtk_tree_store_set.</p>
<p>If you really do need to know the cell renderer where a button press event happened, that is a bit more tricky. Here is a suggestion on how to approach this&nbsp;issue:</p>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="n">gboolean</span>
<span class="nf">tree_view_get_cell_from_pos</span><span class="w"> </span><span class="p">(</span><span class="n">GtkTreeView</span><span class="w"> </span><span class="o">*</span><span class="n">view</span><span class="p">,</span>
<span class="w">                             </span><span class="n">guint</span><span class="w"> </span><span class="n">x</span><span class="p">,</span>
<span class="w">                 </span><span class="n">guint</span><span class="w"> </span><span class="n">y</span><span class="p">,</span>
<span class="w">                 </span><span class="n">GtkCellRenderer</span><span class="w"> </span><span class="o">**</span><span class="n">cell</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkTreeViewColumn</span><span class="w"> </span><span class="o">*</span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">  </span><span class="n">GList</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">columns</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">cells</span><span class="p">;</span>
<span class="w">  </span><span class="n">guint</span><span class="w"> </span><span class="n">colx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/* (1) find column and column x relative to tree view coordinates */</span>
<span class="w">  </span><span class="n">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_get_columns</span><span class="p">(</span><span class="n">view</span><span class="p">);</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">columns</span><span class="p">;</span><span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">GtkTreeViewColumn</span><span class="w"> </span><span class="o">*</span><span class="n">checkcol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">colx</span><span class="w">  </span><span class="o">&amp;&amp;</span><span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">colx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">checkcol</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">))</span>
<span class="w">        </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">checkcol</span><span class="p">;</span>
<span class="w">      </span><span class="k">else</span>
<span class="w">        </span><span class="n">colx</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">checkcol</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="n">g_list_free</span><span class="p">(</span><span class="n">columns</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">col</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FALSE</span><span class="p">;</span><span class="w"> </span><span class="cm">/* not found */</span>

<span class="w">  </span><span class="cm">/* (2) find the cell renderer within the column */</span>
<span class="w">  </span><span class="n">cells</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_tree_view_column_get_cell_renderers</span><span class="p">(</span><span class="n">col</span><span class="p">);</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cells</span><span class="p">;</span><span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">GtkCellRenderer</span><span class="w"> </span><span class="o">*</span><span class="n">checkcell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>
<span class="w">      </span><span class="n">guint</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">      </span><span class="cm">/* Will this work for all packing modes? doesn&#39;t that</span>
<span class="cm">       *  return a random width depending on the last content</span>
<span class="cm">       * rendered? */</span>
<span class="w">      </span><span class="n">gtk_cell_renderer_get_size</span><span class="p">(</span><span class="n">checkcell</span><span class="p">,</span><span class="w"> </span><span class="n">GTK_WIDGET</span><span class="p">(</span><span class="n">view</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">colx</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">colx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">width</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">      </span><span class="o">*</span><span class="n">cell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">checkcell</span><span class="p">;</span>
<span class="w">      </span><span class="n">g_list_free</span><span class="p">(</span><span class="n">cells</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">TRUE</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">      </span><span class="n">colx</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">width</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="n">g_list_free</span><span class="p">(</span><span class="n">cells</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">FALSE</span><span class="p">;</span><span class="w"> </span><span class="cm">/* not found */</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="n">gboolean</span>
<span class="nf">onButtonPress</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">view</span><span class="p">,</span>
<span class="w">               </span><span class="n">GdkEventButton</span><span class="w"> </span><span class="o">*</span><span class="n">bevent</span><span class="p">,</span>
<span class="w">           </span><span class="n">gpointer</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkCellRenderer</span><span class="w"> </span><span class="o">*</span><span class="n">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tree_view_get_cell_from_pos</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">view</span><span class="p">),</span><span class="w"> </span><span class="n">bevent</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">bevent</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">renderer</span><span class="p">))</span>
<span class="w">    </span><span class="n">g_print</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Renderer found</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="n">g_print</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Renderer not found!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="writing-custom-models">Writing Custom Models<a class="md-anchor" href="treeview-tutorial.html#writing-custom-models" title="Permanent link"></a></h2>
<h3 id="when-is-a-custom-model-useful">When is a Custom Model Useful?<a class="md-anchor" href="treeview-tutorial.html#when-is-a-custom-model-useful" title="Permanent link"></a></h3>
<p>A custom tree model gives you complete control over your data and how it is
represented to the outside (e.g. to the tree view widget). It has the
advantage that you can store, access and modify your data exactly how you
need it, and you can optimise the way your data is stored and retrieved, as
you can write your own functions to access your data and need not rely
solely on the gtk_tree_model_get. A model tailored to your needs will
probably also be a lot faster than the generic list and tree stores that
come with gtk and that have been designed with flexibility in&nbsp;mind.</p>
<p>Another case where a custom model might come in handy is when you have all
your data already stored in an external tree-like structure (for example a
libxml2 <span class="caps">XML</span> tree) and only want to display that structure. Then you could
write a custom model that maps that structure to a tree model (which is
probably not quite as trivial as it sounds&nbsp;though).</p>
<p>Using a custom model you could also implement a filter model that only
displays certain rows according to some filter criterion instead of
displaying all rows (<span class="caps">GTK</span> has a filter model, <code>GtkTreeModelFilter</code>, that does
exactly that and much more, but you might want to implement this yourself&nbsp;anyway.)</p>
<p>However, all this comes at a cost: you are unlikely to write a useful custom
model in less than a thousand lines, unless you strip all newline
characters. Writing a custom model is not as difficult as it might sound
though, and it may well be worth the effort, not least because it will
result in much saner code if you have a lot of data to keep track&nbsp;of.</p>
<h3 id="what-does-writing-a-custom-model-involve">What Does Writing a Custom Model Involve?<a class="md-anchor" href="treeview-tutorial.html#what-does-writing-a-custom-model-involve" title="Permanent link"></a></h3>
<p>Basically, all you need to do is to write a new GObject that implements the
GtkTreeModel interface, GtkTreeModelIface. Intimate knowledge about the GLib
GObject system is not a requirement - you just need to copy some boilerplate
code and modify it a bit. The core of your custom tree model is your own
implementation of a couple of gtk_tree_model_foo functions that reveal the
structure of your data, ie. how many rows there are, how many children a row
has, how many columns there are and what type of data they contain.
Furthermore, you need to provide functions that convert a tree path to a
tree iter and a tree iter to a tree path. Additionally, you should provide
some functions to add and remove rows to your custom model, but those are
only ever used by yourself anyway, so they do not fall within the scope of
the tree model&nbsp;interface.</p>
<p>The functions you need to implement&nbsp;are:</p>
<ul>
<li><code>get_flags</code>: tells the outside that your model has certain special
   characterstics, like persistent&nbsp;iters.</li>
<li><code>get_n_columns</code>: how many data fields per row are visible to the
   outside that uses gtk_tree_model_get, e.g. cell renderer&nbsp;attributes</li>
<li><code>get_column_type</code>: what type of data is stored in a data field (model
   column) that is visible to the&nbsp;outside</li>
<li><code>get_iter</code>: take a tree path and fill an iter structure so that you
   know which row it refers&nbsp;to</li>
<li><code>get_path</code>: take an iter and convert it into a tree path, ie. the
   &#8216;physical&#8217; position within the&nbsp;model</li>
<li><code>get_value</code>: retrieve data from a&nbsp;row</li>
<li><code>iter_next</code>: take an iter structure and make it point to the next&nbsp;row</li>
<li><code>iter_children</code>: tell whether the row represented by a given iter has
   any children or&nbsp;not</li>
<li><code>iter_n_children</code>: tell how many children a row represented by a given
   iter&nbsp;has</li>
<li><code>iter_nth_child</code>: set a given iter structure to the n-th child of a
   given parent&nbsp;iter</li>
<li><code>iter_parent</code>: set a given iter structure to the parent of a given
   child&nbsp;iter </li>
</ul>
<p>It is up to you to decide which of your data you make &#8216;visible&#8217; to the
outside in form of model columns and which not. You can always implement
functions specific to your custom model that will return any data in any
form you desire. You only need to make data &#8216;visble&#8217; to the outside via the
GType and GValue system if you want the tree view components to access it
(e.g. when setting cell renderer&nbsp;attributes).</p>
<h3 id="example-a-simple-custom-list-model">Example: A Simple Custom List Model<a class="md-anchor" href="treeview-tutorial.html#example-a-simple-custom-list-model" title="Permanent link"></a></h3>
<p>What follows is the outline for a simple custom list model. You can find the
complete source code for this model below. The beginning of the code might
look a bit scary, but you can just skip most of the GObject and GType stuff
and proceed to the heart of the custom list, ie. the implementation of the
tree model&nbsp;functions.</p>
<p>Our list model is represented by a simple list of records, where each row
corresponds to a CustomRecord structure which keeps track of the data we are
interested in. For now, we only want to keep track of persons&#8217; names and
years of birth (usually this would not really justify a custom model, but
this is still just an example). It is trivial to extend the model to deal
with additional fields in the CustomRecord&nbsp;structure.</p>
<p>Within the model, more precisely: the CustomList structure, the list is
stored as a pointer array, which not only provides fast access to the n-th
record in the list, but also comes in handy later on when we add sorting.
Apart from that, any other kind of list-specific data would go in this
structure as well (the active sort column, for example, or hash tables to
speed up searching for a specific row,&nbsp;etc.).</p>
<p>Each row in our list is represented by a CustomRecord structure. You can
store whatever other data you need in that structure. How you make row data
available is up to you. Either you export it via the tree model interface
using the GValue system, so that you can use gtk_tree_model_get to retrieve
your data, or you provide custom model-specific functions to retrieve data,
for example custom_list_get_name, taking a tree iter or a tree path as
argument. Of course you can also do&nbsp;both.</p>
<p>Furthermore, you will need to provide your own functions to add rows, remove
rows, and set or modify row data, and you need to let the view and others
know whenever something changes in your model by emitting the appropriate
signals via the provided tree model&nbsp;functions.</p>
<p>Some thought should go into how exactly you fill the GtkTreeIter fields of
the tree iters used by your model. You have three pointer fields at your
disposal. These should be filled so that you can easily identify the row
given the iter, and should also facilitate access to the next row and the
parent row (if any). If your model advertises to have persistent iters, you
need to make sure that the content of your iters is perfectly valid even if
the user stores it somewhere for later use and the model gets changed or
reordered. The &#8216;stamp&#8217; field of a tree iter should be filled by a random
model-instance-specific integer that was assigned to the model when it was
created. This way you can catch iters that do not belong to your model. If
your model does not have persistent iters, then you should change the
model&#8217;s stamp whenever the model changes, so that you can catch invalid
iters that get passed to your functions (note: in the code below we do not
check the stamp of the iters in order to save a couple of lines of code to
print&nbsp;here).</p>
<p>In our specific example, we simply store a pointer to a row&#8217;s CustomRecord
structure in our model&#8217;s tree iters, which is valid as long as the row
exists. Additionally we store the position of a row within the list in the
CustomRecord as well, which is not only intuitive, but is also useful later
on when we resort the&nbsp;list.</p>
<p>If you want to store an integer value in an iter&#8217;s fields, you should use
GLib&#8217;s <code>GINT_TO_POINTER</code> and <code>GPOINTER_TO_INT</code> macros for&nbsp;that.</p>
<h2 id="writing-custom-cell-renderers">Writing Custom Cell Renderers<a class="md-anchor" href="treeview-tutorial.html#writing-custom-cell-renderers" title="Permanent link"></a></h2>
<p>The cell renderers that come with <span class="caps">GTK</span> should be sufficient for most
purposes, but there might be occasions where you want to display something
in a tree view that you cannot display with the provided cell renderers, or
where you want to derive from one of the provided cell renderers to extend
its&nbsp;functionality.</p>
<p>You can do this by writing a new object that derives from <code>GtkCellRenderer</code>
(or even one of the other cell renderers if you just want to extend an
existing&nbsp;one).</p>
<p>Three things you need to do in the course of&nbsp;that:</p>
<ul>
<li>Register some new properties that your renderer needs with the type
   system and write your own set_property and get_property functions to set
   and get your new renderer&#8217;s&nbsp;properties.</li>
<li>Write your own cell_renderer_get_size function and override the parent
   object&#8217;s function (usually the parent is of type GtkCellRenderer. Note
   that you should honour the standard properties for padding and cell
   alignment of the parent object&nbsp;here.</li>
<li>Write your own cell_renderer_render function and override the parent
   object&#8217;s function. This function does the actual&nbsp;rendering. </li>
</ul>
<p>The GObject type system stuff of writing a new cell renderer is similar to
what we have done above when writing a custom tree model, and is relatively
straight forward in this case. Copy and paste and modify according to your
own&nbsp;needs.</p>
<p>Good examples of cell renderer code to look at or even modify are
GtkCellRendererPixbuf and GtkCellRendererToggle in the Gtk+ source code
tree. Both cases are less than five hundred lines of code to look at and
thus should be fairly easy to&nbsp;digest.</p>
<h3 id="working-example-a-progress-bar-cell-renderer">Working Example: a Progress Bar Cell Renderer<a class="md-anchor" href="treeview-tutorial.html#working-example-a-progress-bar-cell-renderer" title="Permanent link"></a></h3>
<p>In the following we will write a custom cell renderer to render progress bars into a tree view (the code was &#8220;heavily inspired&#8221; by Sean Egan&#8217;s progress bar cell renderer implementation in <span class="caps">GAIM</span>; note this is merely for demonstrational purposes, <span class="caps">GTK</span> has had a progress bar cell renderer for quite a while now: see the GtkCellRendererProgress <span class="caps">API</span> documentation for more&nbsp;details).</p>
    </div>
  </section>
</section>


    
<div id="toc" class="toc">
  <nav aria-labelledby="toc-title">
    <p id="toc-title">Content</p>
    <ul class="toc-list">
      
        
        <li class="toc-list-item"><a href="treeview-tutorial.html#lists-and-trees-the-gtktreeview-widget"><span class="link-text">Lists and Trees: the GtkTreeView Widget</span></a></li>
        
        <li class="toc-list-item"><a href="treeview-tutorial.html#components-model-renderer-column-view"><span class="link-text">Components: Model, Renderer, Column, View</span></a></li>
        
        <li class="toc-list-item"><a href="treeview-tutorial.html#models-for-data-storage-gtkliststore-and-gtktreestore"><span class="link-text">Models for Data Storage: GtkListStore and GtkTreeStore</span></a></li>
        
        <li class="toc-list-item"><a href="treeview-tutorial.html#creating-a-tree-view"><span class="link-text">Creating a Tree View</span></a></li>
        
        <li class="toc-list-item"><a href="treeview-tutorial.html#mapping-data-to-the-screen-gtktreeviewcolumn-and-gtkcellrenderer"><span class="link-text">Mapping Data to the Screen: GtkTreeViewColumn and GtkCellRenderer</span></a></li>
        
        <li class="toc-list-item"><a href="treeview-tutorial.html#selections-double-clicks-and-context-menus"><span class="link-text">Selections, Double-Clicks and Context Menus</span></a></li>
        
        <li class="toc-list-item"><a href="treeview-tutorial.html#sorting"><span class="link-text">Sorting</span></a></li>
        
        <li class="toc-list-item"><a href="treeview-tutorial.html#editable-cells"><span class="link-text">Editable Cells</span></a></li>
        
        <li class="toc-list-item"><a href="treeview-tutorial.html#miscellaneous"><span class="link-text">Miscellaneous</span></a></li>
        
        <li class="toc-list-item"><a href="treeview-tutorial.html#writing-custom-models"><span class="link-text">Writing Custom Models</span></a></li>
        
        <li class="toc-list-item"><a href="treeview-tutorial.html#writing-custom-cell-renderers"><span class="link-text">Writing Custom Cell Renderers</span></a></li>
        
      
    </ul>
  </nav>
</div>


    <section id="search" class="content hidden"></section>

    <footer>
    
    </footer>
  </div>
</body>
</html>
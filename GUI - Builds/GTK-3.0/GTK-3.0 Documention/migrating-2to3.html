<!--
SPDX-FileCopyrightText: GTK Development Team

SPDX-License-Identifier: LGPL-2.1-or-later
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Gtk &ndash; 3.0: Migrating from GTK 2.x to GTK 3</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta charset="utf-8" />

  
  <meta property="og:type" content="website"/>

  
  <meta property="og:image:width" content="256"/>
  <meta property="og:image:height" content="256"/>
  <meta property="og:image:secure_url" content="gtk-logo.svg"/>
  <meta property="og:image:alt" content="Gtk-3.0"/>
  

  
  <meta property="og:title" content="Gtk: Migrating from GTK 2.x to GTK 3"/>
  <meta property="og:description" content="Reference for Gtk-3.0: Migrating from GTK 2.x to GTK 3"/>
  <meta name="twitter:title" content="Gtk: Migrating from GTK 2.x to GTK 3"/>
  <meta name="twitter:description" content="Reference for Gtk-3.0: Migrating from GTK 2.x to GTK 3"/>


  
  <meta name="twitter:card" content="summary"/>

  
  
  
  <link rel="search" type="application/opensearchdescription+xml" title="Gtk" href="opensearch.xml">
  
  

  <link rel="stylesheet" href="style.css" type="text/css" />

  

  
  <script src="urlmap.js"></script>
  
  
  <script src="fzy.js"></script>
  <script src="search.js"></script>
  
  <script src="main.js"></script>

  
</head>

<body>
  <div id="body-wrapper" tabindex="-1">

    <nav class="sidebar devhelp-hidden">
      
      <div class="section">
        <a href="index.html"><img src="gtk-logo.svg" class="logo"/></a>
      </div>
      
      
      <div class="search section">
        <form id="search-form" autocomplete="off">
          <input id="search-input" type="text" name="do-not-autocomplete" placeholder="Click, or press 's' to search" autocomplete="off"/>
        </form>
      </div>
      
      <div class="section namespace">
        <h3><a href="index.html">Gtk</a></h3>
        <p>API Version: 3.0</p>
        
        <p>Library Version: 3.24</p>
        
      </div>
      
      
      <div class="section generator">
        <p>Generated by <a href="https://gitlab.gnome.org/GNOME/gi-docgen">gi-docgen</a> 2024.2</p>
      </div>
    </nav>

    <button id="btn-to-top" class="hidden"><span class="up-arrow"></span></button>

    
<section id="main" class="content">
  
  <h4 id="title" style="display:flex;">
    Migrating from GTK 2.x to GTK 3
    <a href="migrating-2to3.html#title" class="anchor"></a>
    
  </h4>
  
  <section>
    <div class="docblock">
    <h1 id="migrating-from-gtk-2x-to-gtk-3">Migrating from GTK 2.x to GTK 3<a class="md-anchor" href="migrating-2to3.html#migrating-from-gtk-2x-to-gtk-3" title="Permanent link"></a></h1>
<p><span class="caps">GTK</span> 3 is a major new version of <span class="caps">GTK</span> that breaks both <span class="caps">API</span> and <span class="caps">ABI</span> compared to
<span class="caps">GTK</span> 2.x, which has remained <span class="caps">API</span>- and <span class="caps">ABI</span>-stable for a long time. Thankfully,
most of the changes are not hard to adapt to and there are a number of steps
that you can take to prepare your <span class="caps">GTK</span> 2.x application for the switch to
<span class="caps">GTK</span> 3. After that, there&#8217;s a small number of adjustments that you may have to
do when you actually switch your application to build against <span class="caps">GTK</span>&nbsp;3.</p>
<h2 id="preparations-in-gtk-2x">Preparations in GTK 2.x<a class="md-anchor" href="migrating-2to3.html#preparations-in-gtk-2x" title="Permanent link"></a></h2>
<p>The steps outlined in the following sections assume that your application is
working with <span class="caps">GTK</span> 2.24, which is the final stable release of <span class="caps">GTK</span> 2.x. It
includes all the necessary APIs and tools to help you port your application
to <span class="caps">GTK</span> 3. If you are still using an older version of <span class="caps">GTK</span> 2.x, you should
first get your application to build and work with&nbsp;2.24.</p>
<h3 id="do-not-include-individual-headers">Do not include individual headers<a class="md-anchor" href="migrating-2to3.html#do-not-include-individual-headers" title="Permanent link"></a></h3>
<p>With <span class="caps">GTK</span> 2.x it was common to include just the header files for a few
widgets that your application was using, which could lead to problems with
missing definitions, etc. <span class="caps">GTK</span> 3 tightens the rules about which header files
you are allowed to include directly. The allowed header files are&nbsp;are:</p>
<ul>
<li><code>gtk/gtk.h</code>, for <span class="caps">GTK</span></li>
<li><code>gtk/gtkx.h</code>, for the X-specfic widgets <code>GtkSocket</code> and <code>GtkPlug</code></li>
<li><code>gtk/gtkunixprint.h</code>, for low-level, <span class="caps">UNIX</span>-specific printing&nbsp;functions</li>
<li><code>gdk/gdk.h</code>, for <span class="caps">GDK</span></li>
<li><code>gdk/gdkx.h</code>, for <span class="caps">GDK</span> functions that are&nbsp;X11-specific</li>
<li><code>gdk/gdkwin32.h</code>, for <span class="caps">GDK</span> functions that are&nbsp;Windows-specific</li>
</ul>
<p>(these relative paths are assuming that you are using the include paths that
are specified in the <code>gtk+-2.0.pc</code> file, as returned by <code>pkg-config --cflags
gtk+-2.0.pc</code>.)</p>
<p>To check that your application only includes the allowed headers, you can
use defines to disable inclusion of individual headers, as&nbsp;follows:</p>
<div class="codehilite"><pre><span></span><code>make CFLAGS+=&quot;-DGTK_DISABLE_SINGLE_INCLUDES&quot;
</code></pre></div>

<h2 id="do-not-use-deprecated-symbols">Do not use deprecated symbols<a class="md-anchor" href="migrating-2to3.html#do-not-use-deprecated-symbols" title="Permanent link"></a></h2>
<p>Over the years, a number of functions, and in some cases, entire widgets
have been deprecated. These deprecations are clearly spelled out in the <span class="caps">API</span>
reference, with hints about the recommended replacements. The <span class="caps">API</span> reference
for <span class="caps">GTK</span> 2 also includes an index of all deprecated&nbsp;symbols.</p>
<p>To verify that your program does not use any deprecated symbols, you can use
defines to remove deprecated symbols from the header files, as&nbsp;follows:</p>
<div class="codehilite"><pre><span></span><code>make CFLAGS+=&quot;-DGDK_DISABLE_DEPRECATED -DGTK_DISABLE_DEPRECATED&quot;
</code></pre></div>

<p>Note that some parts of our <span class="caps">API</span>, such as enumeration values, are not well
covered by the deprecation warnings. In most cases, using them will require
you to also use deprecated functions, which will trigger warnings. But some
things, like the <code>GTK_DIALOG_NO_SEPARATOR</code> flag that has disappeared in <span class="caps">GTK</span>
3, may&nbsp;not.</p>
<h3 id="use-accessor-functions-instead-of-direct-access">Use accessor functions instead of direct access<a class="md-anchor" href="migrating-2to3.html#use-accessor-functions-instead-of-direct-access" title="Permanent link"></a></h3>
<p><span class="caps">GTK</span> 3 removes many implementation details and struct members from its public&nbsp;headers.</p>
<p>To ensure that your application does not have problems with this, you define
the preprocessor symbol <code>GSEAL_ENABLE</code> while building your application
against <span class="caps">GTK</span> 2.x. This will make the compiler catch all uses of direct access
to struct fields so that you can go through them one by one and replace them
with a call to an accessor function&nbsp;instead.</p>
<div class="codehilite"><pre><span></span><code>make CFLAGS+=&quot;-DGSEAL_ENABLE&quot;
</code></pre></div>

<p>While it may be painful to convert, this helps us keep <span class="caps">API</span> and <span class="caps">ABI</span>
compatibility when we change internal interfaces. As a quick example, when
adding <code>GSEAL_ENABLE</code>, if you see an error&nbsp;like:</p>
<div class="codehilite"><pre><span></span><code>error: &#39;GtkToggleButton&#39; has no member named &#39;active&#39;
</code></pre></div>

<p>this means that you are accessing the public structure of <code>GtkToggleButton</code>
directly, perhaps with some code&nbsp;like:</p>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">on_toggled</span><span class="w"> </span><span class="p">(</span><span class="n">GtkToggleButton</span><span class="w"> </span><span class="o">*</span><span class="n">button</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">button</span><span class="o">-&gt;</span><span class="n">active</span><span class="p">)</span>
<span class="w">    </span><span class="n">frob_active</span><span class="w"> </span><span class="p">();</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="n">frob_inactive</span><span class="w"> </span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<p>In most cases, this can easily be replaced with the correct accessor method.
The main rule is that if you have code like the above which accesses the
&#8220;active&#8221; field of a <code>GtkToggleButton</code>, then the accessor method becomes
<code>gtk_toggle_button_get_active()</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">on_toggled</span><span class="w"> </span><span class="p">(</span><span class="n">GtkToggleButton</span><span class="w"> </span><span class="o">*</span><span class="n">button</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_toggle_button_get_active</span><span class="w"> </span><span class="p">(</span><span class="n">button</span><span class="p">))</span>
<span class="w">    </span><span class="n">frob_active</span><span class="w"> </span><span class="p">();</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="n">frob_inactive</span><span class="w"> </span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<p>In the case of setting field members directly, there&#8217;s usually a
corresponding setter&nbsp;method.</p>
<h3 id="replace-gdk_keyname-with-gdk_key_keyname">Replace <code>GDK_&lt;keyname&gt;</code> with <code>GDK_KEY_&lt;keyname&gt;</code><a class="md-anchor" href="migrating-2to3.html#replace-gdk_keyname-with-gdk_key_keyname" title="Permanent link"></a></h3>
<p>Key constants have gained a <code>_KEY_</code> infix. For example, <code>GDK_a</code> is now
<code>GDK_KEY_a</code>. In <span class="caps">GTK</span> 2, the old names continue to be available. In <span class="caps">GTK</span> 3
however, the old names will require an explicit include of the
<code>gdkkeysyms-compat.h</code> header.</p>
<h3 id="use-gio-for-launching-applications">Use GIO for launching applications<a class="md-anchor" href="migrating-2to3.html#use-gio-for-launching-applications" title="Permanent link"></a></h3>
<p>The <code>gdk_spawn</code> family of functions has been deprecated in <span class="caps">GDK</span> 2.24 and
removed from <span class="caps">GDK</span> 3. Various replacements exist; the best replacement depends
on the&nbsp;circumstances:</p>
<ul>
<li>
<p>If you are opening a document or <span class="caps">URI</span> by launching a command like
  <code>firefox http://my-favourite-website.com</code> or <code>gnome-open ghelp:epiphany</code>,
  it is best to just use <a href="func.show_uri_on_window.html"><code>gtk_show_uri_on_window()</code></a>; as an added benefit,
  your application will henceforth respect the users preference for what
  application to use and correctly open links in sandboxed&nbsp;applications.</p>
</li>
<li>
<p>If you are launching a regular, installed application that has a desktop
  file, it is best to use GIOs GAppInfo with a suitable launch&nbsp;context:</p>
</li>
</ul>
<p><span class="dquo">&#8220;</span>`c
  GAppInfo <em>info;
  GAppLaunchContext </em>context;
  GError *error = <span class="caps">NULL</span>;</p>
<p>info = (GAppInfo<em>) g_desktop_app_info_new (&#8220;epiphany.desktop&#8221;);
  context = (GAppLaunchContext</em>) gdk_display_get_app_launch_context (display);
  g_app_info_launch (info, <span class="caps">NULL</span>, context,&nbsp;&amp;error);</p>
<p>if (error)
    {
      g_warning (&#8220;Failed to launch epiphany: %s&#8221;, error-&gt;message);
      g_error_free (error);&nbsp;}</p>
<p>g_object_unref (info);
  g_object_unref (context);&nbsp;&#8220;`</p>
<p>Remember that you have to include <code>gio/gdesktopappinfo.h</code> and use the
  <code>gio-unix-2.0</code> pkg-config file when using <a href="javascript:void(0)" data-namespace="Gio" data-link="ctor.DesktopAppInfo.new.html" class="external"><code>g_desktop_app_info_new()</code></a>.</p>
<ul>
<li>If you are launching a custom commandline, you can still use <a href="javascript:void(0)" data-namespace="Gio" data-link="method.AppInfo.launch.html" class="external"><code>g_app_info_launch()</code></a>
  with a <a href="javascript:void(0)" data-namespace="Gio" data-link="iface.AppInfo.html" class="external"><code>GAppInfo</code></a> that is constructed with <a href="javascript:void(0)" data-namespace="Gio" data-link="type_func.AppInfo.create_from_commandline.html" class="external"><code>g_app_info_create_from_commandline()</code></a>,
  or you can use the more lowlevel <code>g_spawn</code> family of functions (e.g.
  <a href="javascript:void(0)" data-namespace="GLib" data-link="func.spawn_command_line_async.html" class="external"><code>g_spawn_command_line_async()</code></a>, and pass <code>DISPLAY</code> in the environment.
  <a href="javascript:void(0)" data-namespace="Gdk" data-link="method.Screen.make_display_name.html" class="external"><code>gdk_screen_make_display_name()</code></a> can be used to find the right value for
  the <code>DISPLAY</code> environment&nbsp;variable.</li>
</ul>
<h3 id="use-cairo-for-drawing">Use cairo for drawing<a class="md-anchor" href="migrating-2to3.html#use-cairo-for-drawing" title="Permanent link"></a></h3>
<p>In <span class="caps">GTK</span> 3, the <span class="caps">GDK</span> drawing <span class="caps">API</span> (which closely mimics the X drawing <span class="caps">API</span>, which
is itself modeled after PostScript) has been removed. All drawing in <span class="caps">GTK</span> 3
is done via <a href="https://cairographics.org">Cairo</a>.</p>
<p>The <code>GdkGC</code> and <code>GdkImage</code> objects, as well as all the functions using them,
are gone. This includes the <code>gdk_draw</code> family of functions like
<code>gdk_draw_rectangle()</code> and <code>gdk_draw_drawable()</code>. As <code>GdkGC</code> is roughly
equivalent to <code>cairo_t</code> and <code>GdkImage</code> was used for drawing images to
<code>GdkWindows</code>, which Cairo supports automatically, a transition is usually&nbsp;straightforward.</p>
<p>The following examples show a few common drawing idioms used by applications
that have been ported to use cairo and how the code was&nbsp;replaced.</p>
<h4 id="drawing-pixbufs">Drawing pixbufs<a class="md-anchor" href="migrating-2to3.html#drawing-pixbufs" title="Permanent link"></a></h4>
<p>Drawing a pixbuf onto a drawable used to be done like&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">gdk_draw_pixbuf</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">,</span>
<span class="w">                 </span><span class="n">gtk_widget_get_style</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">black_gc</span><span class="p">,</span>
<span class="w">                 </span><span class="n">pixbuf</span><span class="p">,</span>
<span class="w">                 </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                 </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span>
<span class="w">                 </span><span class="n">gdk_pixbuf_get_width</span><span class="w"> </span><span class="p">(</span><span class="n">pixbuf</span><span class="p">),</span>
<span class="w">                 </span><span class="n">gdk_pixbuf_get_height</span><span class="w"> </span><span class="p">(</span><span class="n">pixbuf</span><span class="p">),</span>
<span class="w">                 </span><span class="n">GDK_RGB_DITHER_NORMAL</span><span class="p">,</span>
<span class="w">                 </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</code></pre></div>

<p>Doing the same thing with&nbsp;cairo:</p>
<div class="codehilite"><pre><span></span><code><span class="n">cairo_t</span><span class="w"> </span><span class="o">*</span><span class="n">cr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdk_cairo_create</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
<span class="n">gdk_cairo_set_source_pixbuf</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">,</span><span class="w"> </span><span class="n">pixbuf</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="n">cairo_paint</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>
<span class="n">cairo_destroy</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>
</code></pre></div>

<p>Note that very similar code can be used when porting code using <code>GdkPixmap</code>
to <code>cairo_surface_t</code> by calling <code>cairo_set_source_surface()</code> instead of
<code>gdk_cairo_set_source_pixbuf()</code>.</p>
<h4 id="tiled-pixmaps">Tiled pixmaps<a class="md-anchor" href="migrating-2to3.html#tiled-pixmaps" title="Permanent link"></a></h4>
<p>Tiled pixmaps are often used for drawing backgrounds. Old code looked
something like&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">GdkGCValues</span><span class="w"> </span><span class="n">gc_values</span><span class="p">;</span>
<span class="n">GdkGC</span><span class="w"> </span><span class="o">*</span><span class="n">gc</span><span class="p">;</span>

<span class="cm">/* setup */</span>
<span class="n">gc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_widget_get_style</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">black_gc</span><span class="p">;</span>
<span class="n">gdk_gc_set_tile</span><span class="w"> </span><span class="p">(</span><span class="n">gc</span><span class="p">,</span><span class="w"> </span><span class="n">pixmap</span><span class="p">);</span>
<span class="n">gdk_gc_set_fill</span><span class="w"> </span><span class="p">(</span><span class="n">gc</span><span class="p">,</span><span class="w"> </span><span class="n">GDK_TILED</span><span class="p">);</span>
<span class="n">gdk_gc_set_ts_origin</span><span class="w"> </span><span class="p">(</span><span class="n">gc</span><span class="p">,</span><span class="w"> </span><span class="n">x_origin</span><span class="p">,</span><span class="w"> </span><span class="n">y_origin</span><span class="p">);</span>

<span class="cm">/* use */</span>
<span class="n">gdk_draw_rectangle</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="n">gc</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">);</span>

<span class="cm">/* restore */</span>
<span class="n">gdk_gc_set_tile</span><span class="w"> </span><span class="p">(</span><span class="n">gc</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="n">gdk_gc_set_fill</span><span class="w"> </span><span class="p">(</span><span class="n">gc</span><span class="p">,</span><span class="w"> </span><span class="n">GDK_SOLID</span><span class="p">);</span>
<span class="n">gdk_gc_set_ts_origin</span><span class="w"> </span><span class="p">(</span><span class="n">gc</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</code></pre></div>

<p>The equivalent cairo code to draw a tiled surface looks like&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">cairo_t</span><span class="w"> </span><span class="o">*</span><span class="n">cr</span><span class="p">;</span>
<span class="n">cairo_surface_t</span><span class="w"> </span><span class="o">*</span><span class="n">surface</span><span class="p">;</span>

<span class="n">surface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<span class="n">cr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdk_cairo_create</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
<span class="n">cairo_set_source_surface</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">,</span><span class="w"> </span><span class="n">surface</span><span class="p">,</span><span class="w"> </span><span class="n">x_origin</span><span class="p">,</span><span class="w"> </span><span class="n">y_origin</span><span class="p">);</span>
<span class="n">cairo_pattern_set_extend</span><span class="w"> </span><span class="p">(</span><span class="n">cairo_get_source</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">),</span><span class="w"> </span><span class="n">CAIRO_EXTEND_REPEAT</span><span class="p">);</span>
<span class="n">cairo_rectangle</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">);</span>
<span class="n">cairo_fill</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>
<span class="n">cairo_destroy</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>
</code></pre></div>

<p>The <code>surface</code> here can be either an image surface or a X surface, and can
either be created on the spot or kept around for caching purposes. Another
alternative is to use pixbufs instead of surfaces with
<code>gdk_cairo_set_source_pixbuf()</code> instead of <code>cairo_set_source_surface()</code>.</p>
<h4 id="clipped-layouts">Clipped layouts<a class="md-anchor" href="migrating-2to3.html#clipped-layouts" title="Permanent link"></a></h4>
<p>Drawing layouts clipped is often used to avoid overdraw or to allow drawing
selections. Code would have looked like&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code>GdkGC *gc;

/* setup */
gc = gtk_widget_get_style (widget)-&gt;text_gc[state];
gdk_gc_set_clip_rectangle (gc, &amp;area);

/* use */
gdk_draw_layout (drawable, gc, x, y, layout);

/* restore */
gdk_gc_set_clip_rectangle (gc, NULL);
</code></pre></div>

<p>With Cairo, the same effect can be achieved&nbsp;using:</p>
<div class="codehilite"><pre><span></span><code><span class="n">GtkStyleContext</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="p">;</span>
<span class="n">GtkStateFlags</span><span class="w"> </span><span class="n">flags</span><span class="p">;</span>
<span class="n">GdkRGBA</span><span class="w"> </span><span class="n">rgba</span><span class="p">;</span>
<span class="n">cairo_t</span><span class="w"> </span><span class="o">*</span><span class="n">cr</span><span class="p">;</span>

<span class="n">cr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdk_cairo_create</span><span class="w"> </span><span class="p">(</span><span class="n">drawable</span><span class="p">);</span>

<span class="cm">/* clip */</span>
<span class="n">gdk_cairo_rectangle</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">area</span><span class="p">);</span>
<span class="n">cairo_clip</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>

<span class="cm">/* set the correct source color */</span>
<span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_widget_get_style_context</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">));</span>
<span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_widget_get_state_flags</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">);</span>
<span class="n">gtk_style_context_get_color</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rgba</span><span class="p">);</span>
<span class="n">gdk_cairo_set_source_rgba</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rgba</span><span class="p">);</span>

<span class="cm">/* draw the text */</span>
<span class="n">cairo_move_to</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="n">pango_cairo_show_layout</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="p">);</span>
<span class="n">cairo_destroy</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>
</code></pre></div>

<p>Clipping using <code>cairo_clip()</code> is of course not restricted to text rendering
and can be used everywhere where <span class="caps">GC</span> clips were used. And using
<code>gdk_cairo_set_source_color()</code> with style colors should be used in all the
places where a style’s <span class="caps">GC</span> was used to achieve a particular&nbsp;color.</p>
<h4 id="what-should-you-be-aware-of">What should you be aware of?<a class="md-anchor" href="migrating-2to3.html#what-should-you-be-aware-of" title="Permanent link"></a></h4>
<p><strong>No more stippling.</strong> Stippling is the usage of a bi-level mask, called a
<code>GdkBitmap</code>. It was often used to achieve a checkerboard effect. You can use
<code>cairo_mask()</code> to achieve this effect. To get a checkerbox mask, you can use
code like&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="n">cairo_pattern_t</span><span class="w"> </span><span class="o">*</span>
<span class="nf">gtk_color_button_get_checkered</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="cm">/* need to respect pixman&#39;s stride being a multiple of 4 */</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="mh">0xFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span>
<span class="w">    </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="n">cairo_surface_t</span><span class="w"> </span><span class="o">*</span><span class="n">surface</span><span class="p">;</span>
<span class="w">  </span><span class="n">cairo_pattern_t</span><span class="w"> </span><span class="o">*</span><span class="n">pattern</span><span class="p">;</span>

<span class="w">  </span><span class="n">surface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cairo_image_surface_create_for_data</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
<span class="w">                                                 </span><span class="n">CAIRO_FORMAT_A8</span><span class="p">,</span>
<span class="w">                                                 </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">                                                 </span><span class="mi">4</span><span class="p">);</span>
<span class="w">  </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cairo_pattern_create_for_surface</span><span class="w"> </span><span class="p">(</span><span class="n">surface</span><span class="p">);</span>
<span class="w">  </span><span class="n">cairo_surface_destroy</span><span class="w"> </span><span class="p">(</span><span class="n">surface</span><span class="p">);</span>
<span class="w">  </span><span class="n">cairo_pattern_set_extend</span><span class="w"> </span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">CAIRO_EXTEND_REPEAT</span><span class="p">);</span>
<span class="w">  </span><span class="n">cairo_pattern_set_filter</span><span class="w"> </span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">CAIRO_FILTER_NEAREST</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">pattern</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>Note that stippling looks very outdated in UIs, and is rarely used in modern
applications. All properties that made use of stippling have been removed
from <span class="caps">GTK</span> 3. Most prominently, stippling is absent from text rendering, in
particular <code>GtkTextTag</code>.</p>
<p><strong>Using the target also as source or mask.</strong> The <code>gdk_draw_drawable()</code>
function allowed using the same drawable as source and target. This was
often used to achieve a scrolling effect. Cairo does not allow this yet. You
can however use <code>cairo_push_group()</code> to get a different intermediate target
that you can copy to. So you can replace this&nbsp;code:</p>
<div class="codehilite"><pre><span></span><code><span class="n">gdk_draw_drawable</span><span class="w"> </span><span class="p">(</span><span class="n">pixmap</span><span class="p">,</span>
<span class="w">                   </span><span class="n">gc</span><span class="p">,</span>
<span class="w">                   </span><span class="n">pixmap</span><span class="p">,</span>
<span class="w">                   </span><span class="n">area</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dx</span><span class="p">,</span><span class="w"> </span><span class="n">area</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dy</span><span class="p">,</span>
<span class="w">                   </span><span class="n">area</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">area</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
<span class="w">                   </span><span class="n">area</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">area</span><span class="p">.</span><span class="n">height</span><span class="p">);</span>
</code></pre></div>

<p>By using this&nbsp;code:</p>
<div class="codehilite"><pre><span></span><code><span class="n">cairo_t</span><span class="w"> </span><span class="o">*</span><span class="n">cr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cairo_create</span><span class="w"> </span><span class="p">(</span><span class="n">surface</span><span class="p">);</span>

<span class="cm">/* clipping restricts the intermediate surface&#39;s size, so it&#39;s a good idea</span>
<span class="cm"> * to use it. */</span>
<span class="n">gdk_cairo_rectangle</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">area</span><span class="p">);</span>
<span class="n">cairo_clip</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>

<span class="cm">/* Now push a group to change the target */</span>
<span class="n">cairo_push_group</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>
<span class="n">cairo_set_source_surface</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">,</span><span class="w"> </span><span class="n">surface</span><span class="p">,</span><span class="w"> </span><span class="n">dx</span><span class="p">,</span><span class="w"> </span><span class="n">dy</span><span class="p">);</span>
<span class="n">cairo_paint</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>

<span class="cm">/* Now copy the intermediate target back */</span>
<span class="n">cairo_pop_group_to_source</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>
<span class="n">cairo_paint</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>
<span class="n">cairo_destroy</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>
</code></pre></div>

<p>The surface here can be either an image surface or a X surface, and can
either be created on the spot or kept around for caching purposes. Another
alternative is to use pixbufs instead of surfaces with
<code>gdk_cairo_set_source_pixbuf()</code> instead of <code>cairo_set_source_surface()</code>. The
Cairo developers plan to add self-copies in the future to allow exactly this
effect, so you might want to keep up on Cairo development to be able to
change your&nbsp;code.</p>
<p><strong>Using <code>pango_cairo_show_layout()</code> instead of
gdk_draw_layout_with_colors().</strong> <span class="caps">GDK</span> provided a way to ignore the color
attributes of text and use a hardcoded text color with the
<code>gdk_draw_layout_with_colors()</code> function. This is often used to draw text
shadows or selections. Pango’s Cairo support does not yet provide this
functionality. If you use Pango layouts that change colors, the easiest way
to achieve a similar effect is using <code>pango_cairo_layout_path()</code> and
<code>cairo_fill()</code> instead of <code>gdk_draw_layout_with_colors()</code>. Note that this
results in a slightly uglier-looking text, as subpixel anti-aliasing is not&nbsp;supported.</p>
<h2 id="changes-that-need-to-be-done-at-the-time-of-the-switch">Changes that need to be done at the time of the switch<a class="md-anchor" href="migrating-2to3.html#changes-that-need-to-be-done-at-the-time-of-the-switch" title="Permanent link"></a></h2>
<p>This section outlines porting tasks that you need to tackle when you get to
the point that you actually build your application against <span class="caps">GTK</span> 3. Making it
possible to prepare for these in <span class="caps">GTK</span> 2.24 would have been either impossible
or&nbsp;impractical.</p>
<h3 id="replace-size_request-by-get_preferred_widthheight">Replace size_request by get_preferred_width/height<a class="md-anchor" href="migrating-2to3.html#replace-size_request-by-get_preferred_widthheight" title="Permanent link"></a></h3>
<p>The request-phase of the traditional <span class="caps">GTK</span> geometry management has been
replaced by a more flexible height-for-width system, which is described in
detail in the <span class="caps">API</span> documentation (see the section called “Height-for-width
Geometry Management” in the <a href="class.Widget.html"><code>GtkWidget</code></a> description). As a
consequence, the <code>::size-request</code> signal and virtual function have been
removed from the GtkWidget class. The replacement for <code>size_request()</code> can
take several levels of&nbsp;sophistication:</p>
<ul>
<li>As a minimal replacement to keep current functionality, you can simply
  implement the <a href="vfunc.Widget.get_preferred_width.html"><code>Gtk.WidgetClass.get_preferred_width</code></a> and
  <a href="vfunc.Widget.get_preferred_height.html"><code>Gtk.WidgetClass.get_preferred_height</code></a> virtual functions by calling
  your existing <code>size_request()</code> function. So you go&nbsp;from:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">my_widget_class_init</span><span class="w"> </span><span class="p">(</span><span class="n">MyWidgetClass</span><span class="w"> </span><span class="o">*</span><span class="n">class</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkWidgetClass</span><span class="w"> </span><span class="o">*</span><span class="n">widget_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GTK_WIDGET_CLASS</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* ... */</span>

<span class="w">  </span><span class="n">widget_class</span><span class="o">-&gt;</span><span class="n">size_request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my_widget_size_request</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/* ... */</span>
<span class="p">}</span>
</code></pre></div>

<p>to something that looks more like&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">my_widget_get_preferred_width</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">widget</span><span class="p">,</span>
<span class="w">                               </span><span class="n">gint</span><span class="w">      </span><span class="o">*</span><span class="n">minimal_width</span><span class="p">,</span>
<span class="w">                               </span><span class="n">gint</span><span class="w">      </span><span class="o">*</span><span class="n">natural_width</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkRequisition</span><span class="w"> </span><span class="n">requisition</span><span class="p">;</span>

<span class="w">  </span><span class="n">my_widget_size_request</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requisition</span><span class="p">);</span>

<span class="w">  </span><span class="o">*</span><span class="n">minimal_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">natural_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requisition</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">my_widget_get_preferred_height</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">widget</span><span class="p">,</span>
<span class="w">                                </span><span class="n">gint</span><span class="w">      </span><span class="o">*</span><span class="n">minimal_height</span><span class="p">,</span>
<span class="w">                                </span><span class="n">gint</span><span class="w">      </span><span class="o">*</span><span class="n">natural_height</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkRequisition</span><span class="w"> </span><span class="n">requisition</span><span class="p">;</span>

<span class="w">  </span><span class="n">my_widget_size_request</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">requisition</span><span class="p">);</span>

<span class="w">  </span><span class="o">*</span><span class="n">minimal_height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">natural_height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requisition</span><span class="p">.</span><span class="n">height</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* ... */</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">my_widget_class_init</span><span class="w"> </span><span class="p">(</span><span class="n">MyWidgetClass</span><span class="w"> </span><span class="o">*</span><span class="n">class</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkWidgetClass</span><span class="w"> </span><span class="o">*</span><span class="n">widget_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GTK_WIDGET_CLASS</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* ... */</span>

<span class="w">  </span><span class="n">widget_class</span><span class="o">-&gt;</span><span class="n">get_preferred_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my_widget_get_preferred_width</span><span class="p">;</span>
<span class="w">  </span><span class="n">widget_class</span><span class="o">-&gt;</span><span class="n">get_preferred_height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my_widget_get_preferred_height</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/* ... */</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Sometimes you can make things a little more streamlined by replacing your
  existing <code>size_request()</code> implementation by one that takes an orientation&nbsp;parameter:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">my_widget_get_preferred_size</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w">      </span><span class="o">*</span><span class="n">widget</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GtkOrientation</span><span class="w">  </span><span class="n">orientation</span><span class="p">,</span>
<span class="w">                               </span><span class="n">gint</span><span class="w">          </span><span class="o">*</span><span class="n">minimal_size</span><span class="p">,</span>
<span class="w">                               </span><span class="n">gint</span><span class="w">          </span><span class="o">*</span><span class="n">natural_size</span><span class="p">)</span>
<span class="p">{</span>

<span class="w">  </span><span class="cm">/* do things that are common for both orientations ... */</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">orientation</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GTK_ORIENTATION_HORIZONTAL</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="cm">/* do stuff that only applies to width... */</span>

<span class="w">      </span><span class="o">*</span><span class="n">minimal_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">natural_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">   </span><span class="p">{</span>
<span class="w">      </span><span class="cm">/* do stuff that only applies to height... */</span>

<span class="w">      </span><span class="o">*</span><span class="n">minimal_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">natural_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">my_widget_get_preferred_width</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">widget</span><span class="p">,</span>
<span class="w">                               </span><span class="n">gint</span><span class="w">      </span><span class="o">*</span><span class="n">minimal_width</span><span class="p">,</span>
<span class="w">                               </span><span class="n">gint</span><span class="w">      </span><span class="o">*</span><span class="n">natural_width</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">my_widget_get_preferred_size</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">,</span>
<span class="w">                                </span><span class="n">GTK_ORIENTATION_HORIZONTAL</span><span class="p">,</span>
<span class="w">                                </span><span class="n">minimal_width</span><span class="p">,</span>
<span class="w">                                </span><span class="n">natural_width</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">my_widget_get_preferred_height</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">widget</span><span class="p">,</span>
<span class="w">                                </span><span class="n">gint</span><span class="w">      </span><span class="o">*</span><span class="n">minimal_height</span><span class="p">,</span>
<span class="w">                                </span><span class="n">gint</span><span class="w">      </span><span class="o">*</span><span class="n">natural_height</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">my_widget_get_preferred_size</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">,</span>
<span class="w">                                </span><span class="n">GTK_ORIENTATION_VERTICAL</span><span class="p">,</span>
<span class="w">                                </span><span class="n">minimal_height</span><span class="p">,</span>
<span class="w">                                </span><span class="n">natural_height</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>If your widget can cope with a small size, but would appreciate getting
  some more space (a common example would be that it contains ellipsizable
  labels), you can do that by making your
  <a href="vfunc.Widget.get_preferred_width.html"><code>Gtk.WidgetClass.get_preferred_width</code></a> / <a href="vfunc.Widget.get_preferred_height.html"><code>Gtk.WidgetClass.get_preferred_height</code></a>
  functions return a smaller value for minimal than for natural. For minimal,
  you probably want to return the same value that your <code>size_request()</code>
  function returned before (since <code>size_request()</code> was defined as returning
  the minimal size a widget can work with). A simple way to obtain good values
  for natural, in the case of containers, is to use <a href="method.Widget.get_preferred_width.html"><code>gtk_widget_get_preferred_width()</code></a>
  and <a href="method.Widget.get_preferred_height.html"><code>gtk_widget_get_preferred_height()</code></a> on the children of the
  container, as in the following&nbsp;example:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">gtk_fixed_get_preferred_height</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">widget</span><span class="p">,</span>
<span class="w">                                </span><span class="n">gint</span><span class="w">      </span><span class="o">*</span><span class="n">minimum</span><span class="p">,</span>
<span class="w">                                </span><span class="n">gint</span><span class="w">      </span><span class="o">*</span><span class="n">natural</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkFixed</span><span class="w"> </span><span class="o">*</span><span class="n">fixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GTK_FIXED</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">);</span>
<span class="w">  </span><span class="n">GtkFixedPrivate</span><span class="w"> </span><span class="o">*</span><span class="n">priv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fixed</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkFixedChild</span><span class="w"> </span><span class="o">*</span><span class="n">child</span><span class="p">;</span>
<span class="w">  </span><span class="n">GList</span><span class="w"> </span><span class="o">*</span><span class="n">children</span><span class="p">;</span>
<span class="w">  </span><span class="n">gint</span><span class="w"> </span><span class="n">child_min</span><span class="p">,</span><span class="w"> </span><span class="n">child_nat</span><span class="p">;</span>

<span class="w">  </span><span class="o">*</span><span class="n">minimum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="o">*</span><span class="n">natural</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">children</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">;</span><span class="w"> </span><span class="n">children</span><span class="p">;</span><span class="w"> </span><span class="n">children</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">children</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">children</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">gtk_widget_get_visible</span><span class="w"> </span><span class="p">(</span><span class="n">child</span><span class="o">-&gt;</span><span class="n">widget</span><span class="p">))</span>
<span class="w">        </span><span class="k">continue</span><span class="p">;</span>

<span class="w">      </span><span class="n">gtk_widget_get_preferred_height</span><span class="w"> </span><span class="p">(</span><span class="n">child</span><span class="o">-&gt;</span><span class="n">widget</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">child_min</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">child_nat</span><span class="p">);</span>

<span class="w">      </span><span class="o">*</span><span class="n">minimum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MAX</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">minimum</span><span class="p">,</span><span class="w"> </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">child_min</span><span class="p">);</span>
<span class="w">      </span><span class="o">*</span><span class="n">natural</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MAX</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">natural</span><span class="p">,</span><span class="w"> </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">child_nat</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>
<p>Note that the <a href="vfunc.Widget.get_preferred_width.html"><code>Gtk.WidgetClass.get_preferred_width</code></a> /
  <a href="vfunc.Widget.get_preferred_height.html"><code>Gtk.WidgetClass.get_preferred_height</code></a> functions only allow you to deal
  with one dimension at a time. If your <code>size_request()</code> handler is doing
  things that involve both width and height at the same time (e.g. limiting
  the aspect ratio), you will have to implement
  <a href="vfunc.Widget.get_preferred_height_for_width.html"><code>Gtk.WidgetClass.get_preferred_height_for_width</code></a> and
  <a href="vfunc.Widget.get_preferred_width_for_height.html"><code>Gtk.WidgetClass.get_preferred_width_for_height</code></a>.</p>
</li>
<li>
<p>To make full use of the new capabilities of the height-for-width geometry
  management, you need to additionally implement the
  <a href="vfunc.Widget.get_preferred_height_for_width.html"><code>Gtk.WidgetClass.get_preferred_height_for_width</code></a> and
  <a href="vfunc.Widget.get_preferred_width_for_height.html"><code>Gtk.WidgetClass.get_preferred_width_for_height</code></a>. For details on these
  functions, see the section called “Height-for-width Geometry Management”
  in the <a href="class.Widget.html"><code>GtkWidget</code></a>&nbsp;documentation.</p>
</li>
</ul>
<h3 id="replace-gdkregion-with-cairo_region_t">Replace <code>GdkRegion</code> with <code>cairo_region_t</code><a class="md-anchor" href="migrating-2to3.html#replace-gdkregion-with-cairo_region_t" title="Permanent link"></a></h3>
<p>Starting with version 1.10, cairo provides a region <span class="caps">API</span> that is equivalent
to the <span class="caps">GDK</span> region <span class="caps">API</span> (which was itself copied from the X server).
Therefore, the region <span class="caps">API</span> has been removed in <span class="caps">GTK</span>&nbsp;3.</p>
<p>Porting your application to the cairo region <span class="caps">API</span> should be a straight
find-and-replace task. Please refer to the following&nbsp;table:</p>
<table>
<thead>
<tr>
<th><span class="caps">GDK</span></th>
<th>Cairo</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>GdkRegion</code></td>
<td><code>cairo_region_t</code></td>
</tr>
<tr>
<td><code>GdkRectangle</code></td>
<td><code>cairo_rectangle_int_t</code></td>
</tr>
<tr>
<td><code>gdk_rectangle_intersect()</code></td>
<td>this function is still available</td>
</tr>
<tr>
<td><code>gdk_rectangle_union()</code></td>
<td>this function is still available</td>
</tr>
<tr>
<td><code>gdk_region_new()</code></td>
<td><code>cairo_region_create()</code></td>
</tr>
<tr>
<td><code>gdk_region_copy()</code></td>
<td><code>cairo_region_copy()</code></td>
</tr>
<tr>
<td><code>gdk_region_destroy()</code></td>
<td><code>cairo_region_destroy()</code></td>
</tr>
<tr>
<td><code>gdk_region_rectangle()</code></td>
<td><code>cairo_region_create_rectangle()</code></td>
</tr>
<tr>
<td><code>gdk_region_get_clipbox()</code></td>
<td><code>cairo_region_get_extents()</code></td>
</tr>
<tr>
<td><code>gdk_region_get_rectangles()</code></td>
<td><code>cairo_region_num_rectangles()</code> and <code>cairo_region_get_rectangle()</code></td>
</tr>
<tr>
<td><code>gdk_region_empty()</code></td>
<td><code>cairo_region_is_empty()</code></td>
</tr>
<tr>
<td><code>gdk_region_equal()</code></td>
<td><code>cairo_region_equal()</code></td>
</tr>
<tr>
<td><code>gdk_region_point_in()</code></td>
<td><code>cairo_region_contains_point()</code></td>
</tr>
<tr>
<td><code>gdk_region_rect_in()</code></td>
<td><code>cairo_region_contains_rectangle()</code></td>
</tr>
<tr>
<td><code>gdk_region_offset()</code></td>
<td><code>cairo_region_translate()</code></td>
</tr>
<tr>
<td><code>gdk_region_union_with_rect()</code></td>
<td><code>cairo_region_union_rectangle()</code></td>
</tr>
<tr>
<td><code>gdk_region_intersect()</code></td>
<td><code>cairo_region_intersect()</code></td>
</tr>
<tr>
<td><code>gdk_region_union()</code></td>
<td><code>cairo_region_union()</code></td>
</tr>
<tr>
<td><code>gdk_region_subtract()</code></td>
<td><code>cairo_region_subtract()</code></td>
</tr>
<tr>
<td><code>gdk_region_xor()</code></td>
<td><code>cairo_region_xor()</code></td>
</tr>
<tr>
<td><code>gdk_region_shrink()</code></td>
<td>no replacement</td>
</tr>
<tr>
<td><code>gdk_region_polygon()</code></td>
<td>no replacement, use Cairo paths instead</td>
</tr>
</tbody>
</table>
<h3 id="replace-gdkpixmap-by-cairo-surfaces">Replace GdkPixmap by cairo surfaces<a class="md-anchor" href="migrating-2to3.html#replace-gdkpixmap-by-cairo-surfaces" title="Permanent link"></a></h3>
<p>The GdkPixmap object and related functions have been removed. In the
Cairo-centric world of <span class="caps">GTK</span> 3, Cairo surfaces take over the role of&nbsp;pixmaps.</p>
<p>One place where pixmaps were commonly used is to create custom&nbsp;cursors:</p>
<div class="codehilite"><pre><span></span><code><span class="n">GdkCursor</span><span class="w"> </span><span class="o">*</span><span class="n">cursor</span><span class="p">;</span>
<span class="n">GdkPixmap</span><span class="w"> </span><span class="o">*</span><span class="n">pixmap</span><span class="p">;</span>
<span class="n">cairo_t</span><span class="w"> </span><span class="o">*</span><span class="n">cr</span><span class="p">;</span>
<span class="n">GdkColor</span><span class="w"> </span><span class="n">fg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>

<span class="n">pixmap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdk_pixmap_new</span><span class="w"> </span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="n">cr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdk_cairo_create</span><span class="w"> </span><span class="p">(</span><span class="n">pixmap</span><span class="p">);</span>
<span class="n">cairo_rectangle</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="n">cairo_fill</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>
<span class="n">cairo_destroy</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>

<span class="n">cursor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdk_cursor_new_from_pixmap</span><span class="w"> </span><span class="p">(</span><span class="n">pixmap</span><span class="p">,</span><span class="w"> </span><span class="n">pixmap</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fg</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fg</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="n">g_object_unref</span><span class="w"> </span><span class="p">(</span><span class="n">pixmap</span><span class="p">);</span>
</code></pre></div>

<p>The same can be achieved without pixmaps, by drawing onto an image&nbsp;surface:</p>
<div class="codehilite"><pre><span></span><code>GdkCursor *cursor;
cairo_surface_t *s;
cairo_t *cr;
GdkPixbuf *pixbuf;

s = cairo_image_surface_create (CAIRO_FORMAT_A1, 3, 3);
cr = cairo_create (s);
cairo_arc (cr, 1.5, 1.5, 1.5, 0, 2 * M_PI);
cairo_fill (cr);
cairo_destroy (cr);

pixbuf = gdk_pixbuf_get_from_surface (s,
                                      0, 0,
                                      3, 3);

cairo_surface_destroy (s);

cursor = gdk_cursor_new_from_pixbuf (display, pixbuf, 0, 0);

g_object_unref (pixbuf);
</code></pre></div>

<h3 id="replace-gdkcolormap-with-gdkvisual">Replace <code>GdkColormap</code> with <code>GdkVisual</code><a class="md-anchor" href="migrating-2to3.html#replace-gdkcolormap-with-gdkvisual" title="Permanent link"></a></h3>
<p>For drawing with Cairo, it is not necessary to allocate colors, and a
<a href="javascript:void(0)" data-namespace="Gdk" data-link="class.Visual.html" class="external"><code>GdkVisual</code></a> provides enough information for Cairo to handle colors
in &#8216;native&#8217; surfaces. Therefore, <code>GdkColormap</code> and related functions have
been removed in <span class="caps">GTK</span> 3, and visuals are used instead. The colormap-handling
functions of <code>GtkWidget</code> (<code>gtk_widget_set_colormap()</code>, etc) have been
removed and <a href="method.Widget.set_visual.html"><code>gtk_widget_set_visual()</code></a> has been&nbsp;added.</p>
<h4 id="translucent-windows">Translucent windows<a class="md-anchor" href="migrating-2to3.html#translucent-windows" title="Permanent link"></a></h4>
<p>You might have a screen-changed handler like the following to set up a
translucent window with an&nbsp;alpha-channel:</p>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">on_alpha_screen_changed</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">widget</span><span class="p">,</span>
<span class="w">                         </span><span class="n">GdkScreen</span><span class="w"> </span><span class="o">*</span><span class="n">old_screen</span><span class="p">,</span>
<span class="w">                         </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">label</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GdkScreen</span><span class="w"> </span><span class="o">*</span><span class="n">screen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_widget_get_screen</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">);</span>
<span class="w">  </span><span class="n">GdkColormap</span><span class="w"> </span><span class="o">*</span><span class="n">colormap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdk_screen_get_rgba_colormap</span><span class="w"> </span><span class="p">(</span><span class="n">screen</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">colormap</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="n">colormap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdk_screen_get_default_colormap</span><span class="w"> </span><span class="p">(</span><span class="n">screen</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_widget_set_colormap</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">,</span><span class="w"> </span><span class="n">colormap</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>With visuals instead of colormaps, this will look as&nbsp;follows:</p>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">on_alpha_screen_changed</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWindow</span><span class="w"> </span><span class="o">*</span><span class="n">window</span><span class="p">,</span>
<span class="w">                         </span><span class="n">GdkScreen</span><span class="w"> </span><span class="o">*</span><span class="n">old_screen</span><span class="p">,</span>
<span class="w">                         </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">label</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GdkScreen</span><span class="w"> </span><span class="o">*</span><span class="n">screen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_widget_get_screen</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WIDGET</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">));</span>
<span class="w">  </span><span class="n">GdkVisual</span><span class="w"> </span><span class="o">*</span><span class="n">visual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdk_screen_get_rgba_visual</span><span class="w"> </span><span class="p">(</span><span class="n">screen</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">visual</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="n">visual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdk_screen_get_system_visual</span><span class="w"> </span><span class="p">(</span><span class="n">screen</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_widget_set_visual</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="n">visual</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="gdkdrawable-is-gone"><code>GdkDrawable</code> is gone<a class="md-anchor" href="migrating-2to3.html#gdkdrawable-is-gone" title="Permanent link"></a></h3>
<p><code>GdkDrawable</code> has been removed in <span class="caps">GTK</span> 3, together with <code>GdkPixmap</code> and
<code>GdkImage</code>. The only remaining drawable class is <a href="javascript:void(0)" data-namespace="Gdk" data-link="class.Window.html" class="external"><code>GdkWindow</code></a>. For
dealing with image data, you should use a <code>cairo_surface_t</code> or a
<a href="javascript:void(0)" data-namespace="GdkPixbuf" data-link="class.Pixbuf.html" class="external"><code>GdkPixbuf</code></a>.</p>
<p><code>GdkDrawable</code> functions that are useful with windows have been replaced by
corresponding <code>GdkWindow</code> functions:</p>
<table>
<thead>
<tr>
<th><span class="caps">GDK</span> 2.x</th>
<th><span class="caps">GDK</span> 3</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>gdk_drawable_get_visual()</code></td>
<td><code>gdk_window_get_visual()</code></td>
</tr>
<tr>
<td><code>gdk_drawable_get_size()</code></td>
<td><code>gdk_window_get_width()</code> and <code>gdk_window_get_height()</code></td>
</tr>
<tr>
<td><code>gdk_pixbuf_get_from_drawable()</code></td>
<td><code>gdk_pixbuf_get_from_window()</code></td>
</tr>
<tr>
<td><code>gdk_drawable_get_clip_region()</code></td>
<td><code>gdk_window_get_clip_region()</code></td>
</tr>
<tr>
<td><code>gdk_drawable_get_visible_region()</code></td>
<td><code>gdk_window_get_visible_region()</code></td>
</tr>
</tbody>
</table>
<h3 id="event-filtering">Event filtering<a class="md-anchor" href="migrating-2to3.html#event-filtering" title="Permanent link"></a></h3>
<p>If your application uses the low-level event filtering facilities in <span class="caps">GDK</span>,
there are some changes you need to be aware&nbsp;of.</p>
<p>The special-purpose <code>GdkEventClient</code> events and the
<code>gdk_add_client_message_filter()</code> and
<code>gdk_display_add_client_message_filter()</code> functions have been removed.
Receiving X11 ClientMessage events is still possible, using the general
<a href="javascript:void(0)" data-namespace="Gdk" data-link="method.Window.add_filter.html" class="external"><code>gdk_window_add_filter()</code></a> <span class="caps">API</span>. A client message filter&nbsp;like:</p>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="n">GdkFilterReturn</span>
<span class="nf">message_filter</span><span class="w"> </span><span class="p">(</span><span class="n">GdkXEvent</span><span class="w"> </span><span class="o">*</span><span class="n">xevent</span><span class="p">,</span><span class="w"> </span><span class="n">GdkEvent</span><span class="w"> </span><span class="o">*</span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="n">gpointer</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">XClientMessageEvent</span><span class="w"> </span><span class="o">*</span><span class="n">evt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">XClientMessageEvent</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">xevent</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/* do something with evt ... */</span>
<span class="p">}</span>

<span class="cm">/* ... */</span>

<span class="n">message_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdk_atom_intern</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;MANAGER&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FALSE</span><span class="p">);</span>
<span class="n">gdk_display_add_client_message_filter</span><span class="w"> </span><span class="p">(</span><span class="n">display</span><span class="p">,</span><span class="w"> </span><span class="n">message_type</span><span class="p">,</span><span class="w"> </span><span class="n">message_filter</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
</code></pre></div>

<p>then looks like&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="n">GdkFilterReturn</span>
<span class="nf">event_filter</span><span class="w"> </span><span class="p">(</span><span class="n">GdkXEvent</span><span class="w"> </span><span class="o">*</span><span class="n">xevent</span><span class="p">,</span><span class="w"> </span><span class="n">GdkEvent</span><span class="w"> </span><span class="o">*</span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="n">gpointer</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">XClientMessageEvent</span><span class="w"> </span><span class="o">*</span><span class="n">evt</span><span class="p">;</span>
<span class="w">  </span><span class="n">GdkAtom</span><span class="w"> </span><span class="n">message_type</span><span class="p">;</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(((</span><span class="n">XEvent</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">xevent</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ClientMessage</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">GDK_FILTER_CONTINUE</span><span class="p">;</span>

<span class="w">  </span><span class="n">evt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">XClientMessageEvent</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">xevent</span><span class="p">;</span>
<span class="w">  </span><span class="n">message_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XInternAtom</span><span class="w"> </span><span class="p">(</span><span class="n">evt</span><span class="o">-&gt;</span><span class="n">display</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MANAGER&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FALSE</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">evt</span><span class="o">-&gt;</span><span class="n">message_type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">message_type</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">GDK_FILTER_CONTINUE</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/* do something with evt ... */</span>
<span class="p">}</span>

<span class="cm">/* ... */</span>

<span class="n">gdk_window_add_filter</span><span class="w"> </span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">message_filter</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
</code></pre></div>

<p>One advantage of using an event filter is that you can actually remove the
filter when you don&#8217;t need it anymore, using
<a href="javascript:void(0)" data-namespace="Gdk" data-link="method.Window.remove_filter.html" class="external"><code>gdk_window_remove_filter()</code></a>.</p>
<p>The other difference to be aware of when working with event filters in <span class="caps">GTK</span> 3
is that <span class="caps">GDK</span> now uses the XInput 2 extension by default when available. That
means that your application does not receive core X11 key or button events.
Instead, all input events are delivered as <code>XIDeviceEvent</code>s. As a short-term
workaround for this, you can force your application to not use <span class="caps">XI2</span>, with
<a href="javascript:void(0)" data-namespace="Gdk" data-link="func.disable_multidevice.html" class="external"><code>gdk_disable_multidevice()</code></a>. In the long term, you probably want to rewrite
your event filter to deal with <code>XIDeviceEvent</code>s.</p>
<h3 id="backend-specific-code">Backend-specific code<a class="md-anchor" href="migrating-2to3.html#backend-specific-code" title="Permanent link"></a></h3>
<p>In <span class="caps">GTK</span> 2.x, <span class="caps">GDK</span> could only be compiled for one backend at a time, and the
<code>GDK_WINDOWING_X11</code> or <code>GDK_WINDOWING_WIN32</code> macros could be used to find
out which one you are dealing&nbsp;with:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#ifdef GDK_WINDOWING_X11</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">timestamp</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">GDK_CURRENT_TIME</span><span class="p">)</span>
<span class="w">        </span><span class="n">gdk_x11_window_set_user_time</span><span class="w"> </span><span class="p">(</span><span class="n">gdk_window</span><span class="p">,</span><span class="w"> </span><span class="n">timestamp</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef GDK_WINDOWING_WIN32</span>
<span class="w">        </span><span class="cm">/* ... win32 specific code ... */</span>
<span class="cp">#endif</span>
</code></pre></div>

<p>In <span class="caps">GTK</span> 3, <span class="caps">GDK</span> can be built with multiple backends, and currently used
backend has to be determined at runtime, typically using type-check macros
on a <a href="javascript:void(0)" data-namespace="Gdk" data-link="class.Display.html" class="external"><code>GdkDisplay</code></a> or <a href="javascript:void(0)" data-namespace="Gdk" data-link="class.Window.html" class="external"><code>GdkWindow</code></a>. You still need to use
the <code>GDK_WINDOWING_*</code> macros to only compile code referring to supported&nbsp;backends:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#ifdef GDK_WINDOWING_X11</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GDK_IS_X11_DISPLAY</span><span class="w"> </span><span class="p">(</span><span class="n">display</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">timestamp</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">GDK_CURRENT_TIME</span><span class="p">)</span>
<span class="w">            </span><span class="n">gdk_x11_window_set_user_time</span><span class="w"> </span><span class="p">(</span><span class="n">gdk_window</span><span class="p">,</span><span class="w"> </span><span class="n">timestamp</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="k">else</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef GDK_WINDOWING_WIN32</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GDK_IS_WIN32_DISPLAY</span><span class="w"> </span><span class="p">(</span><span class="n">display</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="cm">/* ... win32 specific code ... */</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="k">else</span>
<span class="cp">#endif</span>
<span class="w">       </span><span class="p">{</span>
<span class="w">         </span><span class="n">g_warning</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Unsupported GDK backend&quot;</span><span class="p">);</span>
<span class="w">       </span><span class="p">}</span>
</code></pre></div>

<p>If you used the <code>pkg-config</code> variable target to conditionally build part of your project depending on the <span class="caps">GDK</span> backend, for instance like&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code>AM_CONDITIONAL(BUILD_X11, test `$PKG_CONFIG --variable=target gtk+-2.0` = &quot;x11&quot;)
</code></pre></div>

<p>then you should now use the M4 macro provided by <span class="caps">GTK</span>&nbsp;itself:</p>
<div class="codehilite"><pre><span></span><code>GTK_CHECK_BACKEND([x11], [3.0.2], [have_x11=yes], [have_x11=no])
AM_CONDITIONAL(BUILD_x11, [test &quot;x$have_x11&quot; = &quot;xyes&quot;])
</code></pre></div>

<h3 id="gtkplug-and-gtksocket"><code>GtkPlug</code> and <code>GtkSocket</code><a class="md-anchor" href="migrating-2to3.html#gtkplug-and-gtksocket" title="Permanent link"></a></h3>
<p>The <code>GtkPlug</code> and <code>GtkSocket</code> widgets are now X11-specific, and you have to
include the <code>&lt;gtk/gtkx.h&gt;</code> header to use them. The previous section about
proper handling of backend-specific code applies, if you care about other&nbsp;backends.</p>
<h3 id="the-gtkwidgetdraw-signal">The <code>GtkWidget::draw</code> signal<a class="md-anchor" href="migrating-2to3.html#the-gtkwidgetdraw-signal" title="Permanent link"></a></h3>
<p>The <code>GtkWidget</code> “expose-event” signal has been replaced by a new
<a href="signal.Widget.draw.html"><code>GtkWidget::draw</code></a> signal, which takes a <code>cairo_t</code> instead of an
expose event. The Cairo context is being set up so that the origin at (0, 0)
coincides with the upper left corner of the widget, and is properly&nbsp;clipped.</p>
<p>In other words, the Cairo context of the draw signal is set up in &#8216;widget
coordinates&#8217;, which is different from traditional expose event handlers,
which always assume &#8216;window&nbsp;coordinates&#8217;.</p>
<p>The widget is expected to draw itself with its allocated size, which is
available via the new <a href="method.Widget.get_allocated_width.html"><code>gtk_widget_get_allocated_width()</code></a> and
<a href="method.Widget.get_allocated_height.html"><code>gtk_widget_get_allocated_height()</code></a> functions. It is not necessary to check
for <code>gtk_widget_is_drawable()</code>, since <span class="caps">GTK</span> already does this check before
emitting the “draw”&nbsp;signal.</p>
<p>There are some special considerations for widgets with multiple windows.
Expose events are window-specific, and widgets with multiple windows could
expect to get an expose event for each window that needs to be redrawn.
Therefore, multi-window expose event handlers typically look like&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">window</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">widget</span><span class="o">-&gt;</span><span class="n">window1</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">     </span><span class="cm">/* ... draw window1 ... */</span>
<span class="w">  </span><span class="p">}</span>
<span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">window</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">widget</span><span class="o">-&gt;</span><span class="n">window2</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">     </span><span class="cm">/* ... draw window2 ... */</span>
<span class="w">  </span><span class="p">}</span>
</code></pre></div>

<p>In contrast, the “draw” signal handler may have to draw multiple windows in
one call. <span class="caps">GTK</span> has a convenience function <a href="func.cairo_should_draw_window.html"><code>gtk_cairo_should_draw_window()</code></a>
that can be used to find out if a window needs to be drawn. With that, the
example above would look like this (note that the &#8216;else&#8217; is&nbsp;gone):</p>
<div class="codehilite"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_cairo_should_draw_window</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">,</span><span class="w"> </span><span class="n">widget</span><span class="o">-&gt;</span><span class="n">window1</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">     </span><span class="cm">/* ... draw window1 ... */</span>
<span class="w">  </span><span class="p">}</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_cairo_should_draw_window</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">,</span><span class="w"> </span><span class="n">widget</span><span class="o">-&gt;</span><span class="n">window2</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">     </span><span class="cm">/* ... draw window2 ... */</span>
<span class="w">  </span><span class="p">}</span>
</code></pre></div>

<p>Another convenience function that can help when implementing <code>::draw</code> for
multi-window widgets is <a href="func.cairo_transform_to_window.html"><code>gtk_cairo_transform_to_window()</code></a>, which
transforms a cairo context from widget-relative coordinates to
window-relative coordinates. You may want to use <code>cairo_save()</code> and
<code>cairo_restore()</code> when modifying the cairo context in your draw&nbsp;function.</p>
<p>All <code>GtkStyle</code> drawing functions (<code>gtk_paint_box()</code>, etc) have been changed
to take a <code>cairo_t</code> instead of a window and a clip area. <code>::draw</code>
implementations will usually just use the Cairo context that has been passed
in for&nbsp;this.</p>
<h4 id="a-simple-draw-function">A simple <code>::draw</code> function<a class="md-anchor" href="migrating-2to3.html#a-simple-draw-function" title="Permanent link"></a></h4>
<div class="codehilite"><pre><span></span><code><span class="n">gboolean</span>
<span class="nf">gtk_arrow_draw</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">widget</span><span class="p">,</span>
<span class="w">                </span><span class="n">cairo_t</span><span class="w">   </span><span class="o">*</span><span class="n">cr</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkStyleContext</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="p">;</span>
<span class="w">  </span><span class="n">gint</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">  </span><span class="n">gint</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">;</span>
<span class="w">  </span><span class="n">gint</span><span class="w"> </span><span class="n">extent</span><span class="p">;</span>

<span class="w">  </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_widget_get_style_context</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">);</span>

<span class="w">  </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_widget_get_allocated_width</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">);</span>
<span class="w">  </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_widget_get_allocated_height</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">);</span>

<span class="w">  </span><span class="n">extent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MIN</span><span class="w"> </span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">PAD</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">PAD</span><span class="p">);</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PAD</span><span class="p">;</span>
<span class="w">  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PAD</span><span class="p">;</span>

<span class="w">  </span><span class="n">gtk_render_arrow</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">rc</span><span class="p">,</span><span class="w"> </span><span class="n">G_PI</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">extent</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="gtkprogressbar-orientation">GtkProgressBar orientation<a class="md-anchor" href="migrating-2to3.html#gtkprogressbar-orientation" title="Permanent link"></a></h3>
<p>In <span class="caps">GTK</span> 2.x, <code>GtkProgressBar</code> and <code>GtkCellRendererProgress</code> were using the <code>GtkProgressBarOrientation</code> enumeration to specify their orientation and direction. In <span class="caps">GTK</span> 3, both the widget and the cell renderer implement <a href="iface.Orientable.html"><code>GtkOrientable</code></a>, and have an additional &#8216;inverted&#8217; property to determine their direction. Therefore, a call to <code>gtk_progress_bar_set_orientation()</code> needs to be replaced by a pair of calls to <a href="method.Orientable.set_orientation.html"><code>gtk_orientable_set_orientation()</code></a> and <a href="method.ProgressBar.set_inverted.html"><code>gtk_progress_bar_set_inverted()</code></a>. The following values&nbsp;correspond:</p>
<table class="table" border="1">
<colgroup>
<col class="1">
<col class="2">
<col class="3">
</colgroup>
<thead>
<tr>
<th><span class="caps">GTK</span> 2.x</th>
<th colspan="2"><span class="caps">GTK</span> 3</th>
</tr>
<tr>
<th>`GtkProgressBarOrientation`</th>
<th>`GtkOrientation`</th>
<th>inverted</th>
</tr>
</thead>
<tbody>
<tr>
<td>`GTK_PROGRESS_LEFT_TO_RIGHT`</td>
<td>`GTK_ORIENTATION_HORIZONTAL`</td>
<td>`<span class="caps">FALSE</span>`</td>
</tr>
<tr>
<td>`GTK_PROGRESS_RIGHT_TO_LEFT`</td>
<td>`GTK_ORIENTATION_HORIZONTAL`</td>
<td>`<span class="caps">TRUE</span>`</td>
</tr>
<tr>
<td>`GTK_PROGRESS_TOP_TO_BOTTOM`</td>
<td>`GTK_ORIENTATION_VERTICAL`</td>
<td>`<span class="caps">FALSE</span>`</td>
</tr>
<tr>
<td>`GTK_PROGRESS_BOTTOM_TO_TOP`</td>
<td>`GTK_ORIENTATION_VERTICAL`</td>
<td>`<span class="caps">TRUE</span>`</td>
</tr>
</tbody>
</table>

<h3 id="check-your-expand-and-fill-flags">Check your expand and fill flags<a class="md-anchor" href="migrating-2to3.html#check-your-expand-and-fill-flags" title="Permanent link"></a></h3>
<p>The behaviour of expanding widgets has changed slightly in <span class="caps">GTK</span> 3, compared
to <span class="caps">GTK</span> 2.x. It is now &#8216;inherited&#8217;, i.e. a container that has an expanding
child is considered expanding itself. This is often the desired behaviour.
In places where you don&#8217;t want this to happen, setting the container
explicity as not expanding will stop the expand flag of the child from being
inherited. See <a href="method.Widget.set_hexpand.html"><code>gtk_widget_set_hexpand()</code></a> and
<a href="method.Widget.set_vexpand.html"><code>gtk_widget_set_vexpand()</code></a>.</p>
<p>If you experience sizing problems with widgets in ported code, carefully
check the <code>GtkBox</code> <span class="dquo">&#8220;</span>expand&#8221; and &#8220;fill&#8221; child properties of your&nbsp;boxes.</p>
<h3 id="scrolling-changes">Scrolling changes<a class="md-anchor" href="migrating-2to3.html#scrolling-changes" title="Permanent link"></a></h3>
<p>The default values for the “hscrollbar-policy” and “vscrollbar-policy”
properties have been changed from &#8216;never&#8217; to &#8216;automatic&#8217;. If your
application was relying on the default value, you will have to set it&nbsp;explicitly.</p>
<p>The <code>::set-scroll-adjustments</code> signal on <code>GtkWidget</code> has been replaced by
the <a href="iface.Scrollable.html"><code>GtkScrollable</code></a> interface which must be implemented by a widget
that wants to be placed in a <a href="class.ScrolledWindow.html"><code>GtkScrolledWindow</code></a>. Instead of
emitting <code>::set-scroll-adjustments</code>, the scrolled window simply sets the
<a href="property.Scrollable.hadjustment.html"><code>GtkScrollable:hadjustment</code></a> and
<a href="property.Scrollable.vadjustment.html"><code>GtkScrollable:vadjustment</code></a>&nbsp;properties.</p>
<h3 id="gtkobject-is-gone"><code>GtkObject</code> is gone<a class="md-anchor" href="migrating-2to3.html#gtkobject-is-gone" title="Permanent link"></a></h3>
<p><code>GtkObject</code> has been removed in <span class="caps">GTK</span> 3. Its remaining functionality, the
<code>::destroy</code> signal, has been moved to <code>GtkWidget</code>. If you have non-widget
classes that are directly derived from <code>GtkObject</code>, you have to make them
derive from <a href="javascript:void(0)" data-namespace="GObject" data-link="class.InitiallyUnowned.html" class="external"><code>GInitiallyUnowned</code></a>; or, if you don&#8217;t need the
floating functionality, <code>GObject</code>. If you have widgets that override the
destroy class handler, you have to adjust your <code>class_init</code> function, since
destroy is now a member of <code>GtkWidgetClass</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">your_widget_class_init</span><span class="w"> </span><span class="p">(</span><span class="n">YourWidgetClass</span><span class="w"> </span><span class="o">*</span><span class="n">klass</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkObjectClass</span><span class="w"> </span><span class="o">*</span><span class="n">object_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GTK_OBJECT_CLASS</span><span class="w"> </span><span class="p">(</span><span class="n">klass</span><span class="p">);</span>

<span class="w">  </span><span class="n">object_class</span><span class="o">-&gt;</span><span class="n">destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">your_widget_destroy</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/* ... */</span>
<span class="p">}</span>
</code></pre></div>

<p>becomes</p>
<div class="codehilite"><pre><span></span><code>static void
your_widget_class_init (YourWidgetClass *klass)
{
  GtkWidgetClass *widget_class = GTK_WIDGET_CLASS (class);

  widget_class-&gt;destroy = your_widget_destroy;

  /* ... */
}
</code></pre></div>

<p>In the unlikely case that you have a non-widget class that is derived from
<code>GtkObject</code> and makes use of the &#8220;destroy&#8221; functionality, you have to
implement <code>::destroy</code> yourself.</p>
<p>If your program used functions like <code>gtk_object_get()</code> or
<code>gtk_object_set()</code>, these can be replaced directly with <code>g_object_get()</code> or
<code>g_object_set()</code>. In fact, most every <code>gtk_object_*</code> function can be
replaced with the corresponding <code>g_object_*</code> function, even in <span class="caps">GTK</span> 2 code.
The one exception to this rule is <code>gtk_object_destroy()</code>, which can be
replaced with <code>gtk_widget_destroy()</code>, again in both <span class="caps">GTK</span> 2 and <span class="caps">GTK</span>&nbsp;3.</p>
<h3 id="gtkentrycompletion-signal-parameters">GtkEntryCompletion signal parameters<a class="md-anchor" href="migrating-2to3.html#gtkentrycompletion-signal-parameters" title="Permanent link"></a></h3>
<p>The “match-selected” and “cursor-on-match” signals were erroneously given
the internal filter model instead of the users model. This oversight has
been fixed in <span class="caps">GTK</span> 3; if you have handlers for these signals, they will
likely need slight&nbsp;adjustments.</p>
<h3 id="resize-grips">Resize grips<a class="md-anchor" href="migrating-2to3.html#resize-grips" title="Permanent link"></a></h3>
<p>The resize grip functionality has been moved from <a href="class.Statusbar.html"><code>GtkStatusbar</code></a> to
<a href="class.Window.html"><code>GtkWindow</code></a>. Any window can now have resize grips, regardless
whether it has a statusbar or not. The functions
<code>gtk_statusbar_set_has_resize_grip()</code> and
<code>gtk_statusbar_get_has_resize_grip()</code> have disappeared, and instead there
are now <a href="method.Window.set_has_resize_grip.html"><code>gtk_window_set_has_resize_grip()</code></a> and
<a href="method.Window.get_has_resize_grip.html"><code>gtk_window_get_has_resize_grip()</code></a>.</p>
<p>In more recent versions of <span class="caps">GTK</span> 3, the resize grip functionality has been
removed entirely, in favor of invisible resize borders around the window.
When updating to newer versions of <span class="caps">GTK</span> 3, you should simply remove all code
dealing with resize&nbsp;grips.</p>
<h3 id="prevent-mixed-linkage">Prevent mixed linkage<a class="md-anchor" href="migrating-2to3.html#prevent-mixed-linkage" title="Permanent link"></a></h3>
<p>Linking against <span class="caps">GTK</span> 2.x and <span class="caps">GTK</span> 3 in the same process is problematic and can
lead to hard-to-diagnose crashes. The <code>gtk_init()</code> function in both <span class="caps">GTK</span> 2.24
and in <span class="caps">GTK</span> 3 tries to detect this situation and abort with a diagnostic
message, but this check is not 100% reliable (e.g. if the problematic
linking happens only in loadable&nbsp;modules).</p>
<p>Direct linking of your application against both versions of <span class="caps">GTK</span> is easy to
avoid; the problem gets harder when your application is using libraries that
are themselves linked against some version of <span class="caps">GTK</span>. In that case, you have to
verify that you are using a version of the library that is linked against
<span class="caps">GTK</span>&nbsp;3.</p>
<p>If you are using packages provided by a distributor, it is likely that
parallel installable versions of the library exist for <span class="caps">GTK</span> 2.x and <span class="caps">GTK</span> 3,
e.g for vte, check for vte3; for webkitgtk look for webkitgtk3, and so&nbsp;on.</p>
<h3 id="install-gtk-modules-in-the-right-place">Install GTK modules in the right place<a class="md-anchor" href="migrating-2to3.html#install-gtk-modules-in-the-right-place" title="Permanent link"></a></h3>
<p>Some software packages install loadable <span class="caps">GTK</span> modules such as theme engines,
gdk-pixbuf loaders or input methods. Since <span class="caps">GTK</span> 3 is parallel-installable
with <span class="caps">GTK</span> 2.x, the two <span class="caps">GTK</span> versions have separate locations for their
loadable modules. The location for <span class="caps">GTK</span> 2.x is <code>libdir/gtk-2.0</code> (and its
subdirectories), for <span class="caps">GTK</span> 3 the location is <code>libdir/gtk-3.0</code> (and its&nbsp;subdirectories).</p>
<p>For some kinds of modules, namely input methods and pixbuf loaders, <span class="caps">GTK</span>
keeps a cache file with extra information about the modules. For <span class="caps">GTK</span> 2.x,
these cache files are located in <code>sysconfdir/gtk-2.0</code>. For <span class="caps">GTK</span> 3, they have
been moved to <code>libdir/gtk-3.0/3.0.0/</code>. The commands that create these cache
files have been renamed with a <code>-3</code> suffix to make them&nbsp;parallel-installable.</p>
<p>Note that <span class="caps">GTK</span> modules often link against libgtk, libgdk-pixbuf, etc. If that
is the case for your module, you have to be careful to link the <span class="caps">GTK</span> 2.x
version of your module against the 2.x version of the libraries, and the <span class="caps">GTK</span>
3 version against hte 3.x versions. Loading a module linked against libgtk
2.x into an application using <span class="caps">GTK</span> 3 will lead to unhappiness and must be&nbsp;avoided.</p>
    </div>
  </section>
</section>


    
<div id="toc" class="toc">
  <nav aria-labelledby="toc-title">
    <p id="toc-title">Content</p>
    <ul class="toc-list">
      
        
        <li class="toc-list-item"><a href="migrating-2to3.html#preparations-in-gtk-2x"><span class="link-text">Preparations in GTK 2.x</span></a></li>
        
        <li class="toc-list-item"><a href="migrating-2to3.html#do-not-use-deprecated-symbols"><span class="link-text">Do not use deprecated symbols</span></a></li>
        
        <li class="toc-list-item"><a href="migrating-2to3.html#changes-that-need-to-be-done-at-the-time-of-the-switch"><span class="link-text">Changes that need to be done at the time of the switch</span></a></li>
        
      
    </ul>
  </nav>
</div>


    <section id="search" class="content hidden"></section>

    <footer>
    
    </footer>
  </div>
</body>
</html>
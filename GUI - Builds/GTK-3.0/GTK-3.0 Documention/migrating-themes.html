<!--
SPDX-FileCopyrightText: GTK Development Team

SPDX-License-Identifier: LGPL-2.1-or-later
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Gtk &ndash; 3.0: Migrating Themes from GTK 2.x to GTK 3</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta charset="utf-8" />

  
  <meta property="og:type" content="website"/>

  
  <meta property="og:image:width" content="256"/>
  <meta property="og:image:height" content="256"/>
  <meta property="og:image:secure_url" content="gtk-logo.svg"/>
  <meta property="og:image:alt" content="Gtk-3.0"/>
  

  
  <meta property="og:title" content="Gtk: Migrating Themes from GTK 2.x to GTK 3"/>
  <meta property="og:description" content="Reference for Gtk-3.0: Migrating Themes from GTK 2.x to GTK 3"/>
  <meta name="twitter:title" content="Gtk: Migrating Themes from GTK 2.x to GTK 3"/>
  <meta name="twitter:description" content="Reference for Gtk-3.0: Migrating Themes from GTK 2.x to GTK 3"/>


  
  <meta name="twitter:card" content="summary"/>

  
  
  
  <link rel="search" type="application/opensearchdescription+xml" title="Gtk" href="opensearch.xml">
  
  

  <link rel="stylesheet" href="style.css" type="text/css" />

  

  
  <script src="urlmap.js"></script>
  
  
  <script src="fzy.js"></script>
  <script src="search.js"></script>
  
  <script src="main.js"></script>

  
</head>

<body>
  <div id="body-wrapper" tabindex="-1">

    <nav class="sidebar devhelp-hidden">
      
      <div class="section">
        <a href="index.html"><img src="gtk-logo.svg" class="logo"/></a>
      </div>
      
      
      <div class="search section">
        <form id="search-form" autocomplete="off">
          <input id="search-input" type="text" name="do-not-autocomplete" placeholder="Click, or press 's' to search" autocomplete="off"/>
        </form>
      </div>
      
      <div class="section namespace">
        <h3><a href="index.html">Gtk</a></h3>
        <p>API Version: 3.0</p>
        
        <p>Library Version: 3.24</p>
        
      </div>
      
      
      <div class="section generator">
        <p>Generated by <a href="https://gitlab.gnome.org/GNOME/gi-docgen">gi-docgen</a> 2024.2</p>
      </div>
    </nav>

    <button id="btn-to-top" class="hidden"><span class="up-arrow"></span></button>

    
<section id="main" class="content">
  
  <h4 id="title" style="display:flex;">
    Migrating Themes from GTK 2.x to GTK 3
    <a href="migrating-themes.html#title" class="anchor"></a>
    
  </h4>
  
  <section>
    <div class="docblock">
    <h1 id="migrating-themes-from-gtk-2x-to-gtk-3">Migrating Themes from GTK 2.x to GTK 3<a class="md-anchor" href="migrating-themes.html#migrating-themes-from-gtk-2x-to-gtk-3" title="Permanent link"></a></h1>
<h2 id="theming-changes">Theming changes<a class="md-anchor" href="migrating-themes.html#theming-changes" title="Permanent link"></a></h2>
<p>In <span class="caps">GTK</span> 3, <a href="class.StyleContext.html"><code>GtkStyleContext</code></a> was added to replace <code>GtkStyle</code> and the
theming infrastructure available in 2.x. <code>GtkStyleContext</code> is an object
similar in spirit to <code>GtkStyle</code>, as it contains theming information,
although in a more complete and tokenized fashion. There are two aspects to
switching to <code>GtkStyleContext</code>: porting themes and theme engines, and
porting applications, libraries and&nbsp;widgets.</p>
<h3 id="migrating-themes">Migrating themes<a class="md-anchor" href="migrating-themes.html#migrating-themes" title="Permanent link"></a></h3>
<p>From <span class="caps">GTK</span> 3.0 on, theme engines must implement <code>GtkThemingEngine</code> and be
installed in <code>$libdir/gtk+-3.0/$GTK_VERSION/theming-engines</code>, and the files
containing style information must be written in the <span class="caps">CSS</span>-like format that is
understood by GtkCssProvider. For a theme named &#8220;Clearlooks&#8221;, the <span class="caps">CSS</span> file
parsed by default is <code>$datadir/themes/Clearlooks/gtk-3.0/gtk.css</code>, with
possible variants such as the dark theme being named <code>gtk-dark.css</code> in the
same directory. Starting from <span class="caps">GTK</span> 3.14, the theming engine modules are
deprecated in favor of pure <span class="caps">CSS</span> themes, and <span class="caps">GTK</span> will not load&nbsp;them.</p>
<p>If your theme <span class="caps">RC</span> file was providing values for <a href="class.Settings.html"><code>GtkSettings</code></a>, you
can install a <code>settings.ini</code> keyfile along with the <code>gtk.css</code> to provide
theme-specific defaults for&nbsp;settings.</p>
<p>Key themes have been converted to <span class="caps">CSS</span> syntax too. See the
<a href="class.CssProvider.html"><code>GtkCssProvider</code></a> documentation information about the syntax. <span class="caps">GTK</span>
looks for key themes in the file
$<code>datadir/themes/theme/gtk-3.0/gtk-keys.css</code>, where theme is the current key
theme&nbsp;name.</p>
<h3 id="migrating-theme-engines">Migrating theme engines<a class="md-anchor" href="migrating-themes.html#migrating-theme-engines" title="Permanent link"></a></h3>
<p>Migrating a <code>GtkStyle</code> based engine to a <code>GtkThemingEngine</code> based one should
be straightforward for most of the virtual functions. Besides a cleanup in
the available paint methods and a simplification in the passed arguments (in
favor of GtkStyleContext containing all the information), the available
render methods resemble those of <code>GtkStyle</code> quite evidently. Notable
differences&nbsp;include:</p>
<ul>
<li>All variations of <code>gtk_paint_box()</code>, <code>gtk_paint_flat_box()</code>,
  <code>gtk_paint_shadow()</code>, <code>gtk_paint_box_gap()</code> and <code>gtk_paint_shadow_gap()</code>
  are replaced by <code>gtk_render_background()</code>, <code>gtk_render_frame()</code> and
  <code>gtk_render_frame_gap()</code>. The first function renders frameless backgrounds
  and the last two render frames in various&nbsp;forms.</li>
<li><code>gtk_paint_resize_grip()</code> has been subsumed by <code>gtk_render_handle()</code> with
  a <code>GTK_STYLE_CLASS_GRIP</code> class set in the style&nbsp;context.</li>
<li><code>gtk_paint_spinner()</code> disappears in favor of <code>gtk_render_activity()</code> with
  a <code>GTK_STYLE_CLASS_SPINNER</code> class set in the style&nbsp;context.</li>
</ul>
<p>The list of available render methods&nbsp;is:</p>
<ul>
<li><code>gtk_render_background()</code>: Renders a widget/area&nbsp;background.</li>
<li><code>gtk_render_frame()</code>: Renders a frame border around the given rectangle.
  Usually the detail of the border depends on the theme information, plus
  the current widget&nbsp;state.</li>
<li><code>gtk_render_frame_gap()</code>: Renders a frame border with a gap on one&nbsp;side.</li>
<li><code>gtk_render_layout()</code>: Renders a&nbsp;PangoLayout.</li>
<li><code>gtk_render_handle()</code>: Renders all kind of handles and resize grips,
  depending on the style&nbsp;class.</li>
<li><code>gtk_render_check()</code>: Render&nbsp;checkboxes.</li>
<li><code>gtk_render_option()</code>: Render&nbsp;radiobuttons.</li>
<li><code>gtk_render_arrow()</code>: Renders an arrow pointing to a&nbsp;direction.</li>
<li><code>gtk_render_expander()</code>: Renders an expander indicator, such as in
  <code>GtkExpander</code>.</li>
<li><code>gtk_render_focus()</code>: Renders the indication that a widget has the
  keyboard&nbsp;focus.</li>
<li><code>gtk_render_line()</code>: Renders a line from one coordinate to&nbsp;another.</li>
<li><code>gtk_render_slider()</code>: Renders a slider, such as in <code>GtkScale</code>.</li>
<li><code>gtk_render_extension()</code>: Renders an extension that protrudes from a <span class="caps">UI</span>
  element, such as a notebook&nbsp;tab.</li>
<li><code>gtk_render_activity()</code>: Renders an area displaying activity, be it a
  progressbar or a&nbsp;spinner.</li>
<li><code>gtk_render_icon_pixbuf()</code>: Renders an icon into a <code>GdkPixbuf</code>.</li>
</ul>
<p>One of the main differences to <code>GtkStyle</code>-based engines is that the rendered
widget is totally isolated from the theme engine, all style information is
meant to be retrieved from the <code>GtkThemingEngine</code> <span class="caps">API</span>, or from the
<code>GtkWidgetPath</code> obtained from <code>gtk_theming_engine_get_path()</code>, which fully
represents the rendered widget&#8217;s hierarchy from a styling point of&nbsp;view.</p>
<p>The detail string available in <code>GtkStyle</code>-based engines has been replaced by
widget regions and style classes. Regions are a way for complex widgets to
associate different styles with different areas, such as even and odd rows
in a treeview. Style classes allow sharing of style information between
widgets, regardless of their type. Regions and style classes can be used in
style sheets to associate styles, and them engines can also access them.
There are several predefined classes and regions such as
<code>GTK_STYLE_CLASS_BUTTON</code> or <code>GTK_STYLE_REGION_TAB</code> in <code>gtkstylecontext.h</code>,
although custom widgets may define their own, which themes may attempt to&nbsp;handle.</p>
<h3 id="extending-the-css-parser">Extending the CSS parser<a class="md-anchor" href="migrating-themes.html#extending-the-css-parser" title="Permanent link"></a></h3>
<p>In <code>GtkStyle</code>-based engines, <code>GtkRCStyle</code> provided ways to extend the gtkrc
parser with engine-specific extensions. This has been replaced by
<code>gtk_theming_engine_register_property()</code>, which lets a theme engine register
new properties with an arbitrary type. While there is built-in support for
most basic types, it is possible to use a custom parser for the&nbsp;property.</p>
<p>The installed properties depend on the “name” property, so they should be
added in the <code>constructed()</code> vfunc. For example, if an engine with the name
&#8220;Clearlooks&#8221; installs a &#8220;focus-color&#8221; property with the type
<a href="javascript:void(0)" data-namespace="Gdk" data-link="struct.RGBA.html" class="external"><code>GdkRGBA</code></a>, the property <code>-Clearlooks-focus-color</code> will be
registered and accepted in <span class="caps">CSS</span> like&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">GtkEntry</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nv">-Clearlooks-focus-color</span><span class="p">:</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Widget style properties also follow a similar syntax, with the widget type
name used as a prefix. For example, the GtkWidget <code>focus-line-width</code> style
property can be modified in <span class="caps">CSS</span> as <code>-GtkWidget-focus-line-width</code>.</p>
<h3 id="using-the-css-file-format">Using the CSS file format<a class="md-anchor" href="migrating-themes.html#using-the-css-file-format" title="Permanent link"></a></h3>
<p>The syntax of <span class="caps">RC</span> and <span class="caps">CSS</span> files formats is obviously different. The <span class="caps">CSS</span>-like
syntax will hopefully be much more familiar to many people, lowering the
barrier for custom&nbsp;theming.</p>
<p>Instead of going through the syntax differences one-by-one, we will present
a more or less comprehensive example and discuss how it can be translated
into <span class="caps">CSS</span>:</p>
<div class="codehilite"><pre><span></span><code>style &quot;default&quot; {
        xthickness = 1
        ythickness = 1

        GtkButton::child-displacement-x = 1
        GtkButton::child-displacement-y = 1
        GtkCheckButton::indicator-size = 14

        bg[NORMAL]        = @bg_color
        bg[PRELIGHT]      = shade (1.02, @bg_color)
        bg[SELECTED]      = @selected_bg_color
        bg[INSENSITIVE]   = @bg_color
        bg[ACTIVE]        = shade (0.9, @bg_color)

        fg[NORMAL]        = @fg_color
        fg[PRELIGHT]      = @fg_color
        fg[SELECTED]      = @selected_fg_color
        fg[INSENSITIVE]   = darker (@bg_color)
        fg[ACTIVE]        = @fg_color

        text[NORMAL]      = @text_color
        text[PRELIGHT]    = @text_color
        text[SELECTED]    = @selected_fg_color
        text[INSENSITIVE] = darker (@bg_color)
        text[ACTIVE]      = @selected_fg_color

        base[NORMAL]      = @base_color
        base[PRELIGHT]    = shade (0.95, @bg_color)
        base[SELECTED]    = @selected_bg_color
        base[INSENSITIVE] = @bg_color
        base[ACTIVE]      = shade (0.9, @selected_bg_color)

        engine &quot;clearlooks&quot; {
                colorize_scrollbar = TRUE
                style = CLASSIC
        }
}

style &quot;tooltips&quot; {
        xthickness = 4
        ythickness = 4

        bg[NORMAL]        = @tooltip_bg_color
        fg[NORMAL]        = @tooltip_fg_color
}

style &quot;button&quot; {
        xthickness = 3
        ythickness = 3

        bg[NORMAL]        = shade (1.04, @bg_color)
        bg[PRELIGHT]      = shade (1.06, @bg_color)
        bg[ACTIVE]        = shade (0.85, @bg_color)
}

style &quot;entry&quot; {
        xthickness = 3
        ythickness = 3

        bg[SELECTED] = mix (0.4, @selected_bg_color, @base_color)
        fg[SELECTED] = @text_color

        engine &quot;clearlooks&quot; {
                focus_color = shade (0.65, @selected_bg_color)
        }
}

style &quot;other&quot; {
        bg[NORMAL] = #fff;
}

class &quot;GtkWidget&quot; style &quot;default&quot;
class &quot;GtkEntry&quot; style &quot;entry&quot;
widget_class &quot;*&lt;GtkButton&gt;&quot; style &quot;button&quot;
widget &quot;gtk-tooltip*&quot; style &quot;tooltips&quot;
widget_class &quot;window-name.*.GtkButton&quot; style &quot;other&quot;
</code></pre></div>

<p>would roughly translate to this <span class="caps">CSS</span>:</p>
<div class="codehilite"><pre><span></span><code><span class="o">*</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="nv">-GtkButton-child-displacement-x</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="nv">-GtkButton-child-displacement-y</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="nv">-GtkCheckButton-indicator-size</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="p">;</span>

<span class="w">  </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="o">@</span><span class="n">bg_color</span><span class="p">;</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="o">@</span><span class="n">fg_color</span><span class="p">;</span>

<span class="w">  </span><span class="nv">-Clearlooks-colorize-scrollbar</span><span class="p">:</span><span class="w"> </span><span class="n">true</span><span class="p">;</span>
<span class="w">  </span><span class="nv">-Clearlooks-style</span><span class="p">:</span><span class="w"> </span><span class="n">classic</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">*</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="n">shade</span><span class="w"> </span><span class="p">(</span><span class="o">@</span><span class="n">bg_color</span><span class="p">,</span><span class="w"> </span><span class="mf">1.02</span><span class="p">);</span>
<span class="p">}</span>

<span class="o">*</span><span class="p">:</span><span class="nd">selected</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="o">@</span><span class="n">selected_bg_color</span><span class="p">;</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="o">@</span><span class="n">selected_fg_color</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">*</span><span class="p">:</span><span class="nd">insensitive</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="n">shade</span><span class="w"> </span><span class="p">(</span><span class="o">@</span><span class="n">bg_color</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7</span><span class="p">);</span>
<span class="p">}</span>

<span class="o">*</span><span class="p">:</span><span class="nd">active</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="n">shade</span><span class="w"> </span><span class="p">(</span><span class="o">@</span><span class="n">bg_color</span><span class="p">,</span><span class="w"> </span><span class="mf">0.9</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">tooltip</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>

<span class="w">  </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="o">@</span><span class="n">tooltip_bg_color</span><span class="p">;</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="o">@</span><span class="n">tooltip_fg_color</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">button</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">  </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="n">shade</span><span class="w"> </span><span class="p">(</span><span class="o">@</span><span class="n">bg_color</span><span class="p">,</span><span class="w"> </span><span class="mf">1.04</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">button</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="n">shade</span><span class="w"> </span><span class="p">(</span><span class="o">@</span><span class="n">bg_color</span><span class="p">,</span><span class="w"> </span><span class="mf">1.06</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">button</span><span class="p">:</span><span class="nd">active</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="n">shade</span><span class="w"> </span><span class="p">(</span><span class="o">@</span><span class="n">bg_color</span><span class="p">,</span><span class="w"> </span><span class="mf">0.85</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">entry</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>

<span class="w">  </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="o">@</span><span class="n">base_color</span><span class="p">;</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="o">@</span><span class="n">text_color</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">entry</span><span class="p">:</span><span class="nd">selected</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="kc">mix</span><span class="w"> </span><span class="p">(</span><span class="o">@</span><span class="n">selected_bg_color</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">base_color</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4</span><span class="p">);</span>
<span class="w">  </span><span class="nv">-Clearlooks-focus-color</span><span class="p">:</span><span class="w"> </span><span class="n">shade</span><span class="w"> </span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">selected_bg_color</span><span class="p">)</span>
<span class="p">}</span>

<span class="c">/* The latter selector is an specification of the first,</span>
<span class="c">   since any widget may use the same classes or names */</span>
<span class="p">#</span><span class="nn">window-name</span><span class="w"> </span><span class="p">.</span><span class="nc">button</span><span class="o">,</span>
<span class="nt">GtkWindow</span><span class="p">#</span><span class="nn">window-name</span><span class="w"> </span><span class="nt">GtkButton</span><span class="p">.</span><span class="nc">button</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#fff</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>One notable difference is the reduction from fg/bg/text/base colors to only
foreground/background, in exchange the widget is able to render its various
elements with different <span class="caps">CSS</span> classes, which can be themed&nbsp;independently.</p>
<p>In the same vein, the light, dark and mid color variants that were available
in <code>GtkStyle</code> should be replaced by a combination of symbolic colors and
custom <span class="caps">CSS</span>, where necessary. <code>text_aa</code> should really not be used anywhere,
anyway, and the white and black colors that were available in <code>GtkStyle</code> can
just be replaced by literal <a href="javascript:void(0)" data-namespace="Gdk" data-link="struct.RGBA.html" class="external"><code>GdkRGBA</code></a>&nbsp;values.</p>
<p>Access to colors has also changed a bit. With <code>GtkStyle</code>, the common way to
access colors&nbsp;is:</p>
<div class="codehilite"><pre><span></span><code><span class="n">GdkColor</span><span class="w"> </span><span class="o">*</span><span class="n">color1</span><span class="p">;</span>
<span class="n">GdkColor</span><span class="w"> </span><span class="n">color2</span><span class="p">;</span>

<span class="n">color1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">style</span><span class="o">-&gt;</span><span class="n">bg</span><span class="p">[</span><span class="n">GTK_STATE_PRELIGHT</span><span class="p">];</span>
<span class="n">gtk_style_lookup_color</span><span class="w"> </span><span class="p">(</span><span class="n">style</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;focus_color&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">color2</span><span class="p">);</span>
</code></pre></div>

<p>With <code>GtkStyleContext</code>, you generally use <code>GdkRGBA</code> instead of <code>GdkColor</code>
and the code looks like&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">GdkRGBA</span><span class="w"> </span><span class="o">*</span><span class="n">color1</span><span class="p">;</span>
<span class="n">GdkRGBA</span><span class="w">  </span><span class="n">color2</span><span class="p">;</span>

<span class="n">gtk_style_context_get</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">GTK_STATE_FLAG_PRELIGHT</span><span class="p">,</span>
<span class="w">                       </span><span class="s">&quot;background-color&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">color1</span><span class="p">,</span>
<span class="w">                       </span><span class="nb">NULL</span><span class="p">);</span>
<span class="n">gtk_style_context_lookup_color</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;focus_color&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">color2</span><span class="p">);</span>

<span class="cm">/* ... */</span>

<span class="n">gdk_rgba_free</span><span class="w"> </span><span class="p">(</span><span class="n">color1</span><span class="p">);</span>
</code></pre></div>

<p>Note that the memory handling here is different: <code>gtk_style_context_get()</code>
expects the address of a <code>GdkRGBA*</code> and returns a newly allocated struct;
<code>gtk_style_context_lookup_color()</code> expects the address of an existing
struct, and fills&nbsp;it.</p>
<p>It is worth mentioning that the new file format does not support stock icon
mappings as the <span class="caps">RC</span> format&nbsp;did.</p>
<h2 id="a-checklist-for-widgets">A checklist for widgets<a class="md-anchor" href="migrating-themes.html#a-checklist-for-widgets" title="Permanent link"></a></h2>
<p>When porting your widgets to use <code>GtkStyleContext</code>, this checklist might be&nbsp;useful.</p>
<ul>
<li>Replace “style-set” handlers with <a href="signal.Widget.style-updated.html"><code>GtkWidget::style-updated</code></a>&nbsp;handlers.</li>
<li>Try to identify the role of what you&#8217;re rendering with any number of
  classes. This will replace the detail string. There is a predefined set of
  <span class="caps">CSS</span> classes which you can reuse where appropriate. Doing so will give you
  theming &#8216;for free&#8217;, whereas custom classes will require extra work in the
  theme. Note that complex widgets are likely to need different styles when
  rendering different parts, and style classes are one way to achieve this.
  This could result in code like the following (simplified)&nbsp;examples:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">gtk_button_init</span><span class="w"> </span><span class="p">(</span><span class="n">GtkButton</span><span class="w"> </span><span class="o">*</span><span class="n">button</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkStyleContext</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/* ... */</span>

<span class="w">  </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_widget_get_style_context</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WIDGET</span><span class="w"> </span><span class="p">(</span><span class="n">button</span><span class="p">));</span>

<span class="w">  </span><span class="cm">/* Set the &quot;button&quot; class */</span>
<span class="w">  </span><span class="n">gtk_style_context_add_class</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">GTK_STYLE_CLASS_BUTTON</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* ... */</span>
<span class="p">}</span>
</code></pre></div>

<p>Or</p>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="n">gboolean</span>
<span class="nf">gtk_spin_button_draw</span><span class="w"> </span><span class="p">(</span><span class="n">GtkSpinButton</span><span class="w"> </span><span class="o">*</span><span class="n">spin</span><span class="p">,</span>
<span class="w">                      </span><span class="n">cairo_t</span><span class="w">       </span><span class="o">*</span><span class="n">cr</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkStyleContext</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/* ... */</span>

<span class="w">  </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_widget_get_style_context</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WIDGET</span><span class="w"> </span><span class="p">(</span><span class="n">spin</span><span class="p">));</span>

<span class="w">  </span><span class="n">gtk_style_context_save</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_style_context_add_class</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">GTK_STYLE_CLASS_ENTRY</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Call to entry draw impl with &quot;entry&quot; class */</span>
<span class="w">  </span><span class="n">parent_class</span><span class="o">-&gt;</span><span class="n">draw</span><span class="w"> </span><span class="p">(</span><span class="n">spin</span><span class="p">,</span><span class="w"> </span><span class="n">cr</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_style_context_restore</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_style_context_save</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Render up/down buttons with the &quot;button&quot; class */</span>
<span class="w">  </span><span class="n">gtk_style_context_add_class</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">GTK_STYLE_CLASS_BUTTON</span><span class="p">);</span>
<span class="w">  </span><span class="n">draw_up_button</span><span class="w"> </span><span class="p">(</span><span class="n">spin</span><span class="p">,</span><span class="w"> </span><span class="n">cr</span><span class="p">);</span>
<span class="w">  </span><span class="n">draw_down_button</span><span class="w"> </span><span class="p">(</span><span class="n">spin</span><span class="p">,</span><span class="w"> </span><span class="n">cr</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_style_context_restore</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* ... */</span>
<span class="p">}</span>
</code></pre></div>

<p>Note that GtkStyleContext only provides fg/bg colors, so text/base is done
  through distinctive theming of the different classes. For example, an
  entry would usually be black on white while a button would usually be
  black on light&nbsp;grey.</p>
<ul>
<li>Replace all <code>gtk_paint_*()</code> calls with corresponding <code>gtk_render_*()</code>
  calls.</li>
<li>The most distinctive changes are the use of <a href="flags.StateFlags.html"><code>GtkStateFlags</code></a> to
  represent the widget state and the lack of <code>GtkShadowType</code>. Note that
  widget state is now passed implicitly via the context, so to render in a
  certain state, you have to temporarily set the state on the context, as in
  the following&nbsp;example:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">gtk_style_context_save</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
<span class="n">gtk_style_context_set_state</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">GTK_STATE_FLAG_ACTIVE</span><span class="p">);</span>
<span class="n">gtk_render_check</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">cr</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">);</span>
<span class="n">gtk_style_context_restore</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
</code></pre></div>

<ul>
<li>For <code>gtk_render_check()</code> and <code>gtk_render_option()</code>, the <code>shadow_type
  parameter</code> is replaced by the <code>GTK_STATE_FLAG_ACTIVE</code> and
  <code>GTK_STATE_FLAG_INCONSISTENT</code> state flags. For things such as
  pressed/unpressed button states, <code>GTK_STATE_FLAG_ACTIVE</code> is used, and the
  <span class="caps">CSS</span> may style normal/active states differently to render outset/inset
  borders,&nbsp;respectively.</li>
<li>The various <code>gtk_widget_modify_*()</code> functions to override colors or fonts
  for individual widgets have been replaced by similar
  <code>gtk_widget_override_*()</code> functions.</li>
<li>It is no longer necessary to call <code>gtk_widget_style_attach()</code>,
  <code>gtk_style_attach()</code>, <code>gtk_style_detach()</code> or <code>gtk_widget_ensure_style()</code>.</li>
<li>Replace all uses of xthickness/ythickness. <code>GtkStyleContext</code> uses the <span class="caps">CSS</span>
  box model, and there are border-width/padding/margin properties to replace
  the different applications of X and Y&nbsp;thickness.</li>
</ul>
<p>Note that all of this is merely a guideline. Widgets may choose to follow it
or&nbsp;not.</p>
<h2 id="parsing-of-custom-resources">Parsing of custom resources<a class="md-anchor" href="migrating-themes.html#parsing-of-custom-resources" title="Permanent link"></a></h2>
<p>As a consequence of the <span class="caps">RC</span> format going away, <code>calling gtk_rc_parse()</code> or
<code>gtk_rc_parse_string()</code> won&#8217;t have any effect on a widgets appearance. The way
to replace these calls is using a custom <code>GtkStyleProvider</code>, either for an
individual widget through <a href="method.StyleContext.add_provider.html"><code>gtk_style_context_add_provider()</code></a> or for all
widgets on a screen through <a href="type_func.StyleContext.add_provider_for_screen.html"><code>gtk_style_context_add_provider_for_screen()</code></a>.
Typically, the provider will be a <a href="class.CssProvider.html"><code>GtkCssProvider</code></a>, which parses <span class="caps">CSS</span>
information from a file or from a&nbsp;string.</p>
<div class="codehilite"><pre><span></span><code><span class="n">GtkStyleContext</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="p">;</span>
<span class="n">GtkCssProvider</span><span class="w"> </span><span class="o">*</span><span class="n">provider</span><span class="p">;</span>

<span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_widget_get_style_context</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">);</span>
<span class="n">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_css_provider_new</span><span class="w"> </span><span class="p">();</span>
<span class="n">gtk_css_provider_load_from_data</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_CSS_PROVIDER</span><span class="w"> </span><span class="p">(</span><span class="n">provider</span><span class="p">),</span>
<span class="w">                                 </span><span class="s">&quot;.frame1 {</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="w">                                 </span><span class="s">&quot;   border-image: url(&#39;gradient1.png&#39;) 10 10 10 10 stretch;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="w">                                 </span><span class="s">&quot;}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="n">gtk_style_context_add_provider</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="p">,</span>
<span class="w">                                </span><span class="n">GTK_STYLE_PROVIDER</span><span class="w"> </span><span class="p">(</span><span class="n">provider</span><span class="p">),</span>
<span class="w">                                </span><span class="n">GTK_STYLE_PROVIDER_PRIORITY_APPLICATION</span><span class="p">);</span>
<span class="n">g_object_unref</span><span class="w"> </span><span class="p">(</span><span class="n">provider</span><span class="p">);</span>
</code></pre></div>

<p>Notice that you can also get style information from custom resources by
implementing the <code>GtkStyleProvider</code> interface yourself. This is an advanced
feature that should be rarely&nbsp;used. </p>
<h2 id="bonus-points">Bonus points<a class="md-anchor" href="migrating-themes.html#bonus-points" title="Permanent link"></a></h2>
<p>There are some features in <code>GtkStyleContext</code> that were not available in
<code>GtkStyle</code>, or were made available over time for certain widgets through
extending the detail string in obscure ways. There is a lot more information
available when rendering <span class="caps">UI</span> elements, and it is accessible in more uniform,
less hacky ways. By going through this list you&#8217;ll ensure your widget is a
good citizen in a fully themable user&nbsp;interface.</p>
<ul>
<li>If your widget renders a series of similar elements, such as tabs in a
  <code>GtkNotebook</code> or rows/column in a <code>GtkTreeView</code>, consider adding regions
  through <code>gtk_style_context_add_region()</code>. These regions can be referenced in
  <span class="caps">CSS</span> and the <code>:nth-child</code> pseudo-class may be used to match the elements
  depending on the flags&nbsp;passed.</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nt">GtkNotebook</span><span class="w"> </span><span class="nt">tab</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#f3329d</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">GtkTreeView</span><span class="w"> </span><span class="nt">row</span><span class="p">::</span><span class="nd">nth-child</span><span class="w"> </span><span class="o">(</span><span class="nt">even</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#dddddd</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>If your container renders child widgets within different regions, make it
  implement <a href="vfunc.Container.get_path_for_child.html"><code>Gtk.ContainerClass.get_path_for_child</code></a>. This function lets
  containers assign a special <a href="struct.WidgetPath.html"><code>GtkWidgetPath</code></a> to child widgets
  depending on their role/region. This is necessary to extend the concept
  above throughout the widget hierarchy. For example, a GtkNotebook modifies
  the tab labels&#8217; <code>GtkWidgetPath</code> so the &#8220;tab&#8221; region is added. This makes it
  possible to theme tab labels&nbsp;through:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nt">GtkNotebook</span><span class="w"> </span><span class="nt">tab</span><span class="w"> </span><span class="nt">GtkLabel</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">font</span><span class="p">:</span><span class="w"> </span><span class="n">Sans</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>If you intend several visual elements to look interconnected, make sure
  you specify rendered elements&#8217; connection areas with
  <code>gtk_style_context_set_junction_sides()</code>. It is of course up to the theme
  to make use of this information or&nbsp;not.</li>
<li><code>GtkStyleContext</code> supports implicit animations on state changes for the
  most simple case out-of-the-box: widgets with a single animatable area,
  whose state is changed with <code>gtk_widget_set_state_flags()</code> or
  <code>gtk_widget_unset_state_flags()</code>. These functions trigger animated
  transitions for the affected state flags. Examples of widgets for which
  this kind of animation may be sufficient are <code>GtkButton</code> or <code>GtkEntry</code>.</li>
<li>If your widget consists of more than a simple area, and these areas may be
  rendered with different states, make sure to mark the rendered areas with
  <code>gtk_style_context_push_animatable_region()</code> and
  <code>gtk_style_context_pop_animatable_region()</code>.</li>
<li><code>gtk_style_context_notify_state_change()</code> may be used to trigger a
  transition for a given state. The region <span class="caps">ID</span> will determine the animatable
  region that is affected by this&nbsp;transition.</li>
</ul>
    </div>
  </section>
</section>


    
<div id="toc" class="toc">
  <nav aria-labelledby="toc-title">
    <p id="toc-title">Content</p>
    <ul class="toc-list">
      
        
        <li class="toc-list-item"><a href="migrating-themes.html#theming-changes"><span class="link-text">Theming changes</span></a></li>
        
        <li class="toc-list-item"><a href="migrating-themes.html#a-checklist-for-widgets"><span class="link-text">A checklist for widgets</span></a></li>
        
        <li class="toc-list-item"><a href="migrating-themes.html#parsing-of-custom-resources"><span class="link-text">Parsing of custom resources</span></a></li>
        
        <li class="toc-list-item"><a href="migrating-themes.html#bonus-points"><span class="link-text">Bonus points</span></a></li>
        
      
    </ul>
  </nav>
</div>


    <section id="search" class="content hidden"></section>

    <footer>
    
    </footer>
  </div>
</body>
</html>
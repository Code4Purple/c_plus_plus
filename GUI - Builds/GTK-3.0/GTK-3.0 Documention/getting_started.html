<!--
SPDX-FileCopyrightText: GTK Development Team

SPDX-License-Identifier: LGPL-2.1-or-later
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Gtk &ndash; 3.0: Getting Started with GTK</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta charset="utf-8" />

  
  <meta property="og:type" content="website"/>

  
  <meta property="og:image:width" content="256"/>
  <meta property="og:image:height" content="256"/>
  <meta property="og:image:secure_url" content="gtk-logo.svg"/>
  <meta property="og:image:alt" content="Gtk-3.0"/>
  

  
  <meta property="og:title" content="Gtk: Getting Started with GTK"/>
  <meta property="og:description" content="Reference for Gtk-3.0: Getting Started with GTK"/>
  <meta name="twitter:title" content="Gtk: Getting Started with GTK"/>
  <meta name="twitter:description" content="Reference for Gtk-3.0: Getting Started with GTK"/>


  
  <meta name="twitter:card" content="summary"/>

  
  
  
  <link rel="search" type="application/opensearchdescription+xml" title="Gtk" href="opensearch.xml">
  
  

  <link rel="stylesheet" href="style.css" type="text/css" />

  

  
  <script src="urlmap.js"></script>
  
  
  <script src="fzy.js"></script>
  <script src="search.js"></script>
  
  <script src="main.js"></script>

  
</head>

<body>
  <div id="body-wrapper" tabindex="-1">

    <nav class="sidebar devhelp-hidden">
      
      <div class="section">
        <a href="index.html"><img src="gtk-logo.svg" class="logo"/></a>
      </div>
      
      
      <div class="search section">
        <form id="search-form" autocomplete="off">
          <input id="search-input" type="text" name="do-not-autocomplete" placeholder="Click, or press 's' to search" autocomplete="off"/>
        </form>
      </div>
      
      <div class="section namespace">
        <h3><a href="index.html">Gtk</a></h3>
        <p>API Version: 3.0</p>
        
        <p>Library Version: 3.24</p>
        
      </div>
      
      
      <div class="section generator">
        <p>Generated by <a href="https://gitlab.gnome.org/GNOME/gi-docgen">gi-docgen</a> 2024.2</p>
      </div>
    </nav>

    <button id="btn-to-top" class="hidden"><span class="up-arrow"></span></button>

    
<section id="main" class="content">
  
  <h4 id="title" style="display:flex;">
    Getting Started with GTK
    <a href="getting_started.html#title" class="anchor"></a>
    
  </h4>
  
  <section>
    <div class="docblock">
    <p><span class="caps">GTK</span> is a widget toolkit. Each user interface created by <span class="caps">GTK</span> consists of
widgets. This is implemented in C using GObject, an object-oriented
framework for C. Widgets are organized in a hierachy. The window widget is
the main container. The user interface is then built by adding buttons,
drop-down menus, input fields, and other widgets to the window. If you are
creating complex user interfaces it is recommended to use GtkBuilder and its
<span class="caps">GTK</span>-specific markup description language, instead of assembling the
interface manually. You can also use a visual user interface editor, like&nbsp;Glade.</p>
<p><span class="caps">GTK</span> is event-driven. The toolkit listens for events such as a click on a
button, and passes the event to your&nbsp;application.</p>
<p>This chapter contains some tutorial information to get you started with <span class="caps">GTK</span>
programming. It assumes that you have <span class="caps">GTK</span>, its dependencies and a C compiler
installed and ready to use. If you need to build <span class="caps">GTK</span> itself first, refer to
the Compiling the <span class="caps">GTK</span> libraries section in this&nbsp;reference.</p>
<h2 id="basics">Basics<a class="md-anchor" href="getting_started.html#basics" title="Permanent link"></a></h2>
<p>To begin our introduction to <span class="caps">GTK</span>, we&#8217;ll start with a simple signal-based Gtk
application. This program will create an empty 200Ã—200 pixel&nbsp;window.</p>
<p>Save the following code as a file named <code>example-0.c</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtk/gtk.h&gt;</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">activate</span><span class="w"> </span><span class="p">(</span><span class="n">GtkApplication</span><span class="o">*</span><span class="w"> </span><span class="n">app</span><span class="p">,</span>
<span class="w">          </span><span class="n">gpointer</span><span class="w">        </span><span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">window</span><span class="p">;</span>

<span class="w">  </span><span class="n">window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_application_window_new</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_window_set_title</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WINDOW</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Window&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_window_set_default_size</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WINDOW</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">),</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_widget_show_all</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w">    </span><span class="n">argc</span><span class="p">,</span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkApplication</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>

<span class="w">  </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_application_new</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;org.gtk.example&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_APPLICATION_FLAGS_NONE</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;activate&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="w"> </span><span class="p">(</span><span class="n">activate</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g_application_run</span><span class="w"> </span><span class="p">(</span><span class="n">G_APPLICATION</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">),</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_object_unref</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>You can compile the program above with <span class="caps">GCC</span>&nbsp;using:</p>
<div class="codehilite"><pre><span></span><code>gcc `pkg-config --cflags gtk+-3.0` -o example-0 example-0.c `pkg-config --libs gtk+-3.0`
</code></pre></div>

<p><img alt="" src="window-default.png" /></p>
<p>For more information on how to compile a <span class="caps">GTK</span> application, please refer to
the <a href="compiling.html">Compiling <span class="caps">GTK</span> Applications</a>&nbsp;section.</p>
<p>All <span class="caps">GTK</span> applications must include the <code>gtk/gtk.h</code> header, which declares
functions, types and macros required by <span class="caps">GTK</span> applications. Even if <span class="caps">GTK</span>
installs multiple header files, only the top level <code>gtk/gtk.h</code> header can be
directly included by third party code. The compiler will abort with an error
if any other header is directly&nbsp;included.</p>
<p>In a <span class="caps">GTK</span> application, the purpose of the <code>main()</code> function is to create a
<a href="class.Application.html"><code>GtkApplication</code></a> object and run it. In this example a
<code>GtkApplication</code> pointer named <code>app</code> is called and then initialized using
<a href="ctor.Application.new.html"><code>gtk_application_new()</code></a>.</p>
<p>When creating a <code>GtkApplication</code> you need to pick an application identifier
(a name) and input to <code>gtk_application_new()</code> as parameter. For this example
<code>org.gtk.example</code> is used but for choosing an identifier for your
application see <a href="https://developer.gnome.org/documentation/tutorials/application-id.html">the corresponding tutorial on the <span class="caps">GNOME</span> developer
documentation website</a>.
Lastly <code>gtk_application_new()</code> takes a <a href="javascript:void(0)" data-namespace="Gio" data-link="flags.ApplicationFlags.html" class="external"><code>GApplicationFlags</code></a> as input
for your application, if your application would have special&nbsp;needs.</p>
<p>Next the <a href="javascript:void(0)" data-namespace="Gio" data-link="signal.Application.activate.html" class="external"><code>GApplication::activate</code></a> signal is connected to the
<code>activate()</code> function defined above the <code>main()</code> function. The <code>activate</code>
signal will be sent when your application is launched with
<a href="javascript:void(0)" data-namespace="Gio" data-link="method.Application.run.html" class="external"><code>g_application_run()</code></a> on the line below. The <code>g_application_run()</code>
function also takes as arguments the pointers to the command line arguments
counter and string array; this allows <span class="caps">GTK</span> to parse specific command line
arguments that control the behavior of <span class="caps">GTK</span>&nbsp;itself.</p>
<p>Within <code>g_application_run()</code>, the <code>activate</code> signal is emitted and we then
proceed into the <code>activate()</code> function of the application. Inside the
<code>activate()</code> function we want to construct our <span class="caps">GTK</span> window, so that a window
is shown when the application is launched. The call to
<a href="ctor.ApplicationWindow.new.html"><code>gtk_application_window_new()</code></a> will create a new <a href="class.Window.html"><code>GtkWindow</code></a> and
store it inside the <code>window</code> pointer. The window will have a frame, a title
bar, and window controls depending on the&nbsp;platform.</p>
<p>A window title is set using <a href="method.Window.set_title.html"><code>gtk_window_set_title()</code></a>. This function
takes a <code>GtkWindow</code> pointer and a string as input. As our window pointer is
a <code>GtkWidget</code> pointer, we need to cast it to <code>GtkWindow</code>. But instead of
casting <code>window</code> via the typical C cast <code>(GtkWindow *)</code>, window can be cast
using the macro <code>GTK_WINDOW()</code>. <code>GTK_WINDOW()</code> will check if the pointer is
an instance of the <code>GtkWindow</code> class, before casting, and emit a warning if
the check fails. More information about this convention can be found in <a href="https://docs.gtk.org/gobject/concepts.html#conventions">the
GObject documentation</a>.</p>
<p>Finally the window size is set using <a href="method.Window.set_default_size.html"><code>gtk_window_set_default_size()</code></a>
and the window is then shown by <span class="caps">GTK</span> via <a href="method.Widget.show_all.html"><code>gtk_widget_show_all()</code></a>.</p>
<p>When you exit the window, by for example pressing the X, the
<code>g_application_run()</code> function returns with a number which is saved inside
an integer named <code>status</code>. Afterwards, the <code>GtkApplication</code> object is freed
from memory with <a href="javascript:void(0)" data-namespace="GObject" data-link="method.Object.unref.html" class="external"><code>g_object_unref()</code></a>. Finally the status integer
is returned and the <span class="caps">GTK</span> application&nbsp;exits.</p>
<p>While the program is running, <span class="caps">GTK</span> is receiving events. These are typically
input events caused by the user interacting with your program, but also
things like messages from the window manager or other applications. <span class="caps">GTK</span>
processes these and as a result, signals may be emitted on your widgets.
Connecting handlers for these signals is how you normally make your program
do something in response to user&nbsp;input.</p>
<p>The following example is slightly more complex, and tries to showcase some
of the capabilities of <span class="caps">GTK</span>.</p>
<p>In the long tradition of programming languages and libraries, it is called
<em>Hello, World</em>.</p>
<p>Save the following code as a file named <code>example-1.c</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtk/gtk.h&gt;</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">print_hello</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">widget</span><span class="p">,</span>
<span class="w">             </span><span class="n">gpointer</span><span class="w">   </span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">g_print</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Hello World</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">activate</span><span class="w"> </span><span class="p">(</span><span class="n">GtkApplication</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">,</span>
<span class="w">          </span><span class="n">gpointer</span><span class="w">        </span><span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">window</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">button</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">button_box</span><span class="p">;</span>

<span class="w">  </span><span class="n">window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_application_window_new</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_window_set_title</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WINDOW</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Window&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_window_set_default_size</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WINDOW</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">),</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">);</span>

<span class="w">  </span><span class="n">button_box</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_button_box_new</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_ORIENTATION_HORIZONTAL</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_container_add</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_CONTAINER</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">),</span><span class="w"> </span><span class="n">button_box</span><span class="p">);</span>

<span class="w">  </span><span class="n">button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_button_new_with_label</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Hello World&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="w"> </span><span class="p">(</span><span class="n">button</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;clicked&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="w"> </span><span class="p">(</span><span class="n">print_hello</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect_swapped</span><span class="w"> </span><span class="p">(</span><span class="n">button</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;clicked&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_widget_destroy</span><span class="p">),</span><span class="w"> </span><span class="n">window</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_container_add</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_CONTAINER</span><span class="w"> </span><span class="p">(</span><span class="n">button_box</span><span class="p">),</span><span class="w"> </span><span class="n">button</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_widget_show_all</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w">    </span><span class="n">argc</span><span class="p">,</span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkApplication</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>

<span class="w">  </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_application_new</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;org.gtk.example&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_APPLICATION_FLAGS_NONE</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;activate&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="w"> </span><span class="p">(</span><span class="n">activate</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g_application_run</span><span class="w"> </span><span class="p">(</span><span class="n">G_APPLICATION</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">),</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_object_unref</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>You can compile the program above with <span class="caps">GCC</span>&nbsp;using:</p>
<div class="codehilite"><pre><span></span><code>gcc `pkg-config --cflags gtk+-3.0` -o example-1 example-1.c `pkg-config --libs gtk+-3.0`
</code></pre></div>

<p><img alt="" src="hello-world.png" /></p>
<p>As seen above, <code>example-1.c</code> builds further upon <code>example-0.c</code> by adding a
button to our window, with the label &#8220;Hello World&#8221;. Two new <code>GtkWidget</code>
pointers are declared to accomplish this, <code>button</code> and <code>button_box</code>. The
<code>button_box</code> variable is created to store a <a href="class.ButtonBox.html"><code>GtkButtonBox</code></a> which is
<span class="caps">GTK</span>&#8217;s way of controlling the size and layout of buttons. The <code>GtkButtonBox</code>
is created and assigned to <a href="ctor.ButtonBox.new.html"><code>gtk_button_box_new()</code></a> which takes a
<a href="enum.Orientation.html"><code>GtkOrientation</code></a> enumeration as parameter. The buttons which this box
will contain can either be stored horizontally or vertically but this does
not matter in this particular case as we are dealing with only one button.
After initializing <code>button_box</code> with horizontal orientation, the code adds
the <code>button_box</code> widget to the window widget using
<a href="method.Container.add.html"><code>gtk_container_add()</code></a>.</p>
<p>Next the <code>button</code> variable is initialized in similar manner.
<a href="ctor.Button.new_with_label.html"><code>gtk_button_new_with_label()</code></a> is called which returns a
<a href="class.Button.html"><code>GtkButton</code></a> to be stored inside <code>button</code>. Afterwards <code>button</code> is
added to our <code>button_box</code>. Using <a href="javascript:void(0)" data-namespace="GObject" data-link="func.signal_connect.html" class="external"><code>g_signal_connect()</code></a> the button
is connected to a function in our app called <code>print_hello()</code>, so that when
the button is clicked, <span class="caps">GTK</span> will call this function. As the <code>print_hello()</code>
function does not use any data as input, <code>NULL</code> is passed to it.
<code>print_hello()</code> calls <code>g_print()</code> with the string &#8220;Hello World&#8221; which will
print Hello World in a terminal if the <span class="caps">GTK</span> application was started from&nbsp;one.</p>
<p>After connecting <code>print_hello()</code>, another signal is connected to the
<code>clicked</code> signal of the button using
<a href="javascript:void(0)" data-namespace="GObject" data-link="func.signal_connect_swapped.html" class="external"><code>g_signal_connect_swapped()</code></a>. This functions is similar to
<code>g_signal_connect()</code> with the difference lying in how the callback function
is treated. <code>g_signal_connect_swapped()</code> allows you to specify what the
callback function should take as parameter by letting you pass it as data.
In this case the function being called back is <code>gtk_widget_destroy()</code> and
the window pointer is passed to it. This has the effect that when the button
is clicked, the whole <span class="caps">GTK</span> window is destroyed. In contrast, if a normal
<code>g_signal_connect()</code> were used to connect the <code>clicked</code> signal with
<code>gtk_widget_destroy()</code>, then the button itself would have been destroyed,
not the&nbsp;window.</p>
<p>The rest of the code in <code>example-1.c</code> is identical to <code>example-0.c</code>.</p>
<p>The next section will elaborate further on how to add several widgets to
your <span class="caps">GTK</span>&nbsp;application.</p>
<h2 id="packing">Packing<a class="md-anchor" href="getting_started.html#packing" title="Permanent link"></a></h2>
<p>When creating an application, you&#8217;ll want to put more than one widget inside
a window. When you want to put more than one widget into a window, it
becomes important to control how each widget is positioned and sized. This
is where packing comes&nbsp;in.</p>
<p><span class="caps">GTK</span> comes with a large variety of layout containers whose purpose it is to
control the layout of the child widgets that are added to&nbsp;them.</p>
<p>The following example shows how the <a href="class.Grid.html"><code>GtkGrid</code></a> container lets you
arrange several&nbsp;buttons. </p>
<p>Save the following code as a file named <code>example-2.c</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtk/gtk.h&gt;</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">print_hello</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">widget</span><span class="p">,</span>
<span class="w">             </span><span class="n">gpointer</span><span class="w">   </span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">g_print</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Hello World</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">activate</span><span class="w"> </span><span class="p">(</span><span class="n">GtkApplication</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">,</span>
<span class="w">          </span><span class="n">gpointer</span><span class="w">        </span><span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">window</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">grid</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">button</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/* create a new window, and set its title */</span>
<span class="w">  </span><span class="n">window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_application_window_new</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_window_set_title</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WINDOW</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Window&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_container_set_border_width</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_CONTAINER</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">),</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Here we construct the container that is going pack our buttons */</span>
<span class="w">  </span><span class="n">grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_grid_new</span><span class="w"> </span><span class="p">();</span>

<span class="w">  </span><span class="cm">/* Pack the container in the window */</span>
<span class="w">  </span><span class="n">gtk_container_add</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_CONTAINER</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">),</span><span class="w"> </span><span class="n">grid</span><span class="p">);</span>

<span class="w">  </span><span class="n">button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_button_new_with_label</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Button 1&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="w"> </span><span class="p">(</span><span class="n">button</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;clicked&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="w"> </span><span class="p">(</span><span class="n">print_hello</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Place the first button in the grid cell (0, 0), and make it fill</span>
<span class="cm">   * just 1 cell horizontally and vertically (ie no spanning)</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="n">gtk_grid_attach</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_GRID</span><span class="w"> </span><span class="p">(</span><span class="n">grid</span><span class="p">),</span><span class="w"> </span><span class="n">button</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">  </span><span class="n">button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_button_new_with_label</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Button 2&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="w"> </span><span class="p">(</span><span class="n">button</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;clicked&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="w"> </span><span class="p">(</span><span class="n">print_hello</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Place the second button in the grid cell (1, 0), and make it fill</span>
<span class="cm">   * just 1 cell horizontally and vertically (ie no spanning)</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="n">gtk_grid_attach</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_GRID</span><span class="w"> </span><span class="p">(</span><span class="n">grid</span><span class="p">),</span><span class="w"> </span><span class="n">button</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">  </span><span class="n">button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_button_new_with_label</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Quit&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect_swapped</span><span class="w"> </span><span class="p">(</span><span class="n">button</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;clicked&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_widget_destroy</span><span class="p">),</span><span class="w"> </span><span class="n">window</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Place the Quit button in the grid cell (0, 1), and make it</span>
<span class="cm">   * span 2 columns.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="n">gtk_grid_attach</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_GRID</span><span class="w"> </span><span class="p">(</span><span class="n">grid</span><span class="p">),</span><span class="w"> </span><span class="n">button</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Now that we are done packing our widgets, we show them all</span>
<span class="cm">   * in one go, by calling gtk_widget_show_all() on the window.</span>
<span class="cm">   * This call recursively calls gtk_widget_show() on all widgets</span>
<span class="cm">   * that are contained in the window, directly or indirectly.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="n">gtk_widget_show_all</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">);</span>

<span class="p">}</span>

<span class="kt">int</span>
<span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w">    </span><span class="n">argc</span><span class="p">,</span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkApplication</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>

<span class="w">  </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_application_new</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;org.gtk.example&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_APPLICATION_FLAGS_NONE</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;activate&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="w"> </span><span class="p">(</span><span class="n">activate</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g_application_run</span><span class="w"> </span><span class="p">(</span><span class="n">G_APPLICATION</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">),</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_object_unref</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>You can compile the program above with <span class="caps">GCC</span>&nbsp;using:</p>
<div class="codehilite"><pre><span></span><code>gcc `pkg-config --cflags gtk+-3.0` -o example-2 example-2.c `pkg-config --libs gtk+-3.0`
</code></pre></div>

<p><img alt="" src="grid-packing.png" /></p>
<h2 id="building-user-interfaces">Building user interfaces<a class="md-anchor" href="getting_started.html#building-user-interfaces" title="Permanent link"></a></h2>
<p>When constructing a more complicated user interface, with dozens or hundreds
of widgets, doing all the setup work in C code is cumbersome, and making
changes becomes next to&nbsp;impossible.</p>
<p>Thankfully, <span class="caps">GTK</span> supports the separation of user interface layout from your
business logic, by using <span class="caps">UI</span> descriptions in an <span class="caps">XML</span> format that can be parsed
by the <a href="class.Builder.html"><code>GtkBuilder</code></a>&nbsp;class.</p>
<p>Save the following <span class="caps">XML</span> as a file named <code>builder.ui</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;interface&gt;</span>
<span class="w">  </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;window&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkWindow&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>Grid<span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;border-width&quot;</span><span class="nt">&gt;</span>10<span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;child&gt;</span>
<span class="w">      </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;grid&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkGrid&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">        </span><span class="nt">&lt;child&gt;</span>
<span class="w">          </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;button1&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkButton&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;label&quot;</span><span class="nt">&gt;</span>Button<span class="w"> </span>1<span class="nt">&lt;/property&gt;</span>
<span class="w">          </span><span class="nt">&lt;/object&gt;</span>
<span class="w">          </span><span class="nt">&lt;packing&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;left-attach&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;top-attach&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
<span class="w">          </span><span class="nt">&lt;/packing&gt;</span>
<span class="w">        </span><span class="nt">&lt;/child&gt;</span>
<span class="w">        </span><span class="nt">&lt;child&gt;</span>
<span class="w">          </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;button2&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkButton&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;label&quot;</span><span class="nt">&gt;</span>Button<span class="w"> </span>2<span class="nt">&lt;/property&gt;</span>
<span class="w">          </span><span class="nt">&lt;/object&gt;</span>
<span class="w">          </span><span class="nt">&lt;packing&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;left-attach&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;top-attach&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
<span class="w">          </span><span class="nt">&lt;/packing&gt;</span>
<span class="w">        </span><span class="nt">&lt;/child&gt;</span>
<span class="w">        </span><span class="nt">&lt;child&gt;</span>
<span class="w">          </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;quit&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkButton&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;label&quot;</span><span class="nt">&gt;</span>Quit<span class="nt">&lt;/property&gt;</span>
<span class="w">          </span><span class="nt">&lt;/object&gt;</span>
<span class="w">          </span><span class="nt">&lt;packing&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;left-attach&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;top-attach&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;width&quot;</span><span class="nt">&gt;</span>2<span class="nt">&lt;/property&gt;</span>
<span class="w">          </span><span class="nt">&lt;/packing&gt;</span>
<span class="w">        </span><span class="nt">&lt;/child&gt;</span>
<span class="w">      </span><span class="nt">&lt;/object&gt;</span>
<span class="w">      </span><span class="nt">&lt;packing&gt;</span>
<span class="w">      </span><span class="nt">&lt;/packing&gt;</span>
<span class="w">    </span><span class="nt">&lt;/child&gt;</span>
<span class="w">  </span><span class="nt">&lt;/object&gt;</span>
<span class="nt">&lt;/interface&gt;</span>
</code></pre></div>

<p>Save the following code as a file named <code>example-3.c</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtk/gtk.h&gt;</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">print_hello</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">widget</span><span class="p">,</span>
<span class="w">             </span><span class="n">gpointer</span><span class="w">   </span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">g_print</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Hello World</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w">   </span><span class="n">argc</span><span class="p">,</span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkBuilder</span><span class="w"> </span><span class="o">*</span><span class="n">builder</span><span class="p">;</span>
<span class="w">  </span><span class="n">GObject</span><span class="w"> </span><span class="o">*</span><span class="n">window</span><span class="p">;</span>
<span class="w">  </span><span class="n">GObject</span><span class="w"> </span><span class="o">*</span><span class="n">button</span><span class="p">;</span>
<span class="w">  </span><span class="n">GError</span><span class="w"> </span><span class="o">*</span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>

<span class="w">  </span><span class="n">gtk_init</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">argv</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Construct a GtkBuilder instance and load our UI description */</span>
<span class="w">  </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_builder_new</span><span class="w"> </span><span class="p">();</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_builder_add_from_file</span><span class="w"> </span><span class="p">(</span><span class="n">builder</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;builder.ui&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">g_printerr</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Error loading file: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="o">-&gt;</span><span class="n">message</span><span class="p">);</span>
<span class="w">      </span><span class="n">g_clear_error</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/* Connect signal handlers to the constructed widgets. */</span>
<span class="w">  </span><span class="n">window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_builder_get_object</span><span class="w"> </span><span class="p">(</span><span class="n">builder</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;window&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;destroy&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_main_quit</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="n">button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_builder_get_object</span><span class="w"> </span><span class="p">(</span><span class="n">builder</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;button1&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="w"> </span><span class="p">(</span><span class="n">button</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;clicked&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="w"> </span><span class="p">(</span><span class="n">print_hello</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="n">button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_builder_get_object</span><span class="w"> </span><span class="p">(</span><span class="n">builder</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;button2&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="w"> </span><span class="p">(</span><span class="n">button</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;clicked&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="w"> </span><span class="p">(</span><span class="n">print_hello</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="n">button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_builder_get_object</span><span class="w"> </span><span class="p">(</span><span class="n">builder</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;quit&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="w"> </span><span class="p">(</span><span class="n">button</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;clicked&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_main_quit</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_main</span><span class="w"> </span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>You can compile the program above with <span class="caps">GCC</span>&nbsp;using:</p>
<div class="codehilite"><pre><span></span><code>gcc `pkg-config --cflags gtk+-3.0` -o example-3 example-3.c `pkg-config --libs gtk+-3.0`
</code></pre></div>

<p><img alt="" src="builder.png" /></p>
<p>Note that <code>GtkBuilder</code> can also be used to construct objects that are not
widgets, such as tree models, adjustments, etc. That is the reason the
method we use here is called <a href="method.Builder.get_object.html"><code>gtk_builder_get_object()</code></a> and returns a
<code>GObject</code> instead of a <code>GtkWidget</code>.</p>
<p><code>GtkBuilder</code> will load the file from the current directory; for installed
applications, you can pass a full path to
<a href="method.Builder.add_from_file.html"><code>gtk_builder_add_from_file()</code></a> to make the execution of your program
independent of the current directory. A common location to install <span class="caps">UI</span>
descriptions and similar data is <code>/usr/share/appname</code>, but it will require
installing the file separately from your&nbsp;binary.</p>
<p>It is also possible to embed the <span class="caps">UI</span> description in the source code as a
string and use <a href="method.Builder.add_from_string.html"><code>gtk_builder_add_from_string()</code></a> to load it; keeping
the <span class="caps">UI</span> description in a separate file has several advantages: it is then
possible to make minor adjustments to the <span class="caps">UI</span> without recompiling your
program, and, more importantly, graphical <span class="caps">UI</span> editors such as Glade can load
the file and allow you to create and modify your <span class="caps">UI</span> by&nbsp;point-and-click.</p>
<p>It is possible to have the <span class="caps">UI</span> description as a separate file during
development, and then embed it in the compiled executable at build time by
using <a href="javascript:void(0)" data-namespace="Gio" data-link="struct.Resource.html" class="external"><code>GResource</code></a>.</p>
<h2 id="building-applications">Building applications<a class="md-anchor" href="getting_started.html#building-applications" title="Permanent link"></a></h2>
<p>A <span class="caps">GTK</span> application consists of a number of&nbsp;files:</p>
<p>A binary:
  The main executable of your application; it typically is installed in the
  binaries directory, e.g. <code>/usr/bin</code>.</p>
<p>A desktop file:
  The desktop file provides important information about the application to the
  desktop shell, such as its name, icon, D-Bus name, command line to launch it,
  etc. It is typically installed in <code>/usr/share/applications</code>.</p>
<p>An icon:
  The icon gets installed in the &#8220;hicolor&#8221; icon theme directory, e.g.
  <code>/usr/share/icons/hicolor/48x48/apps</code>, where it will be found regardless of
  the current icon&nbsp;theme.</p>
<p>A settings schema:
  If the application uses <a href="javascript:void(0)" data-namespace="Gio" data-link="class.Settings.html" class="external"><code>GSettings</code></a>, it will install its schema in
  <code>/usr/share/glib-2.0/schemas</code> and run <code>glib-compile-schemas</code> to ensure
  that the schema can be&nbsp;used.</p>
<p>Other resources:
  Other files, such as <code>GtkBuilder</code> <span class="caps">UI</span> definition files, are best loaded from
  resources stored in the application binary itself. This eliminates the need
  for most of the files that would traditionally be installed in an
  application-specific location in <code>/usr/share</code>.</p>
<p><span class="caps">GTK</span> includes application support that is built on top of <code>GApplication</code>. In
this tutorial we&#8217;ll build a simple application by starting from scratch,
adding more and more pieces over time. Along the way, we&#8217;ll learn about
<a href="class.Application.html"><code>GtkApplication</code></a>, templates, resources, application menus, settings,
<a href="class.HeaderBar.html"><code>GtkHeaderBar</code></a>, <a href="class.Stack.html"><code>GtkStack</code></a>, <a href="class.SearchBar.html"><code>GtkSearchBar</code></a>,
<a href="class.ListBox.html"><code>GtkListBox</code></a>, and&nbsp;more.</p>
<p>The full, buildable sources for these examples can be found in the
<code>examples</code> directory of the <span class="caps">GTK</span> source distribution, or online in the <span class="caps">GTK</span>
Git repository. You can build each example separately by using make with the
<code>Makefile.example</code> file. For more information, see the <code>README</code> included in
the <code>examples</code> directory.</p>
<h3 id="a-trivial-application">A trivial application<a class="md-anchor" href="getting_started.html#a-trivial-application" title="Permanent link"></a></h3>
<p>When using <code>GtkApplication</code>, the <code>main()</code> function can be very simple. We
just call <code>g_application_run()</code> and give it an instance of our application&nbsp;class.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtk/gtk.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;exampleapp.h&quot;</span>

<span class="kt">int</span>
<span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">g_application_run</span><span class="w"> </span><span class="p">(</span><span class="n">G_APPLICATION</span><span class="w"> </span><span class="p">(</span><span class="n">example_app_new</span><span class="w"> </span><span class="p">()),</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>All the application logic is in the application class, which is a subclass
of <code>GtkApplication</code>. Our example does not yet have any interesting
functionality. All it does is open a window when it is activated without
arguments, and open the files it is given, if it is started with&nbsp;arguments.</p>
<p>To handle these two cases, we override the <code>activate()</code> virtual function,
which gets called when the application is launched without commandline
arguments; and the <code>open()</code> virtual function, which gets called when the
application is launched with command line&nbsp;arguments.</p>
<p>To learn more about <code>GApplication</code> entry points, consult the <span class="caps">GIO</span>&nbsp;documentation.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtk/gtk.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;exampleapp.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;exampleappwin.h&quot;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">_ExampleApp</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkApplication</span><span class="w"> </span><span class="n">parent</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">G_DEFINE_TYPE</span><span class="p">(</span><span class="n">ExampleApp</span><span class="p">,</span><span class="w"> </span><span class="n">example_app</span><span class="p">,</span><span class="w"> </span><span class="n">GTK_TYPE_APPLICATION</span><span class="p">);</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">example_app_init</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleApp</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">example_app_activate</span><span class="w"> </span><span class="p">(</span><span class="n">GApplication</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">ExampleAppWindow</span><span class="w"> </span><span class="o">*</span><span class="n">win</span><span class="p">;</span>

<span class="w">  </span><span class="n">win</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">example_app_window_new</span><span class="w"> </span><span class="p">(</span><span class="n">EXAMPLE_APP</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">));</span>
<span class="w">  </span><span class="n">gtk_window_present</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WINDOW</span><span class="w"> </span><span class="p">(</span><span class="n">win</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">example_app_open</span><span class="w"> </span><span class="p">(</span><span class="n">GApplication</span><span class="w">  </span><span class="o">*</span><span class="n">app</span><span class="p">,</span>
<span class="w">                  </span><span class="n">GFile</span><span class="w">        </span><span class="o">**</span><span class="n">files</span><span class="p">,</span>
<span class="w">                  </span><span class="n">gint</span><span class="w">           </span><span class="n">n_files</span><span class="p">,</span>
<span class="w">                  </span><span class="k">const</span><span class="w"> </span><span class="n">gchar</span><span class="w">   </span><span class="o">*</span><span class="n">hint</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GList</span><span class="w"> </span><span class="o">*</span><span class="n">windows</span><span class="p">;</span>
<span class="w">  </span><span class="n">ExampleAppWindow</span><span class="w"> </span><span class="o">*</span><span class="n">win</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>

<span class="w">  </span><span class="n">windows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_application_get_windows</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_APPLICATION</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">));</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">windows</span><span class="p">)</span>
<span class="w">    </span><span class="n">win</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EXAMPLE_APP_WINDOW</span><span class="w"> </span><span class="p">(</span><span class="n">windows</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="n">win</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">example_app_window_new</span><span class="w"> </span><span class="p">(</span><span class="n">EXAMPLE_APP</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">));</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_files</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="n">example_app_window_open</span><span class="w"> </span><span class="p">(</span><span class="n">win</span><span class="p">,</span><span class="w"> </span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

<span class="w">  </span><span class="n">gtk_window_present</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WINDOW</span><span class="w"> </span><span class="p">(</span><span class="n">win</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">example_app_class_init</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleAppClass</span><span class="w"> </span><span class="o">*</span><span class="n">class</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">G_APPLICATION_CLASS</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">activate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">example_app_activate</span><span class="p">;</span>
<span class="w">  </span><span class="n">G_APPLICATION_CLASS</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">example_app_open</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ExampleApp</span><span class="w"> </span><span class="o">*</span>
<span class="nf">example_app_new</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">g_object_new</span><span class="w"> </span><span class="p">(</span><span class="n">EXAMPLE_APP_TYPE</span><span class="p">,</span>
<span class="w">                       </span><span class="s">&quot;application-id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;org.gtk.exampleapp&quot;</span><span class="p">,</span>
<span class="w">                       </span><span class="s">&quot;flags&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_APPLICATION_HANDLES_OPEN</span><span class="p">,</span>
<span class="w">                       </span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Another important class that is part of the application support in <span class="caps">GTK</span> is
<code>GtkApplicationWindow</code>. It is typically subclassed as well. Our subclass
does not do anything yet, so we will just get an empty&nbsp;window.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtk/gtk.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;exampleapp.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;exampleappwin.h&quot;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">_ExampleAppWindow</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkApplicationWindow</span><span class="w"> </span><span class="n">parent</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">G_DEFINE_TYPE</span><span class="p">(</span><span class="n">ExampleAppWindow</span><span class="p">,</span><span class="w"> </span><span class="n">example_app_window</span><span class="p">,</span><span class="w"> </span><span class="n">GTK_TYPE_APPLICATION_WINDOW</span><span class="p">);</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">example_app_window_init</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleAppWindow</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">example_app_window_class_init</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleAppWindowClass</span><span class="w"> </span><span class="o">*</span><span class="n">class</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="n">ExampleAppWindow</span><span class="w"> </span><span class="o">*</span>
<span class="nf">example_app_window_new</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleApp</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">g_object_new</span><span class="w"> </span><span class="p">(</span><span class="n">EXAMPLE_APP_WINDOW_TYPE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">example_app_window_open</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleAppWindow</span><span class="w"> </span><span class="o">*</span><span class="n">win</span><span class="p">,</span>
<span class="w">                         </span><span class="n">GFile</span><span class="w">            </span><span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

<p>As part of the initial setup of our application, we also create an icon and
a desktop&nbsp;file:</p>
<p><img alt="" src="exampleapp.png" /></p>
<div class="codehilite"><pre><span></span><code>[Desktop Entry]
Type=Application
Name=Example
Icon=exampleapp
StartupNotify=true
Exec=@bindir@/exampleapp
</code></pre></div>

<p>Note that <code>`bindir</code>@` needs to be replaced with the actual path to the binary
before this desktop file can be&nbsp;used.</p>
<p>Here is what we&#8217;ve achieved so&nbsp;far:</p>
<p><img alt="" src="getting-started-app1.png" /></p>
<p>This does not look very impressive yet, but our application is already
presenting itself on the session bus, it has single-instance semantics, and
it accepts files as commandline&nbsp;arguments.</p>
<h3 id="populating-the-window">Populating the window<a class="md-anchor" href="getting_started.html#populating-the-window" title="Permanent link"></a></h3>
<p>In this step, we use a GtkBuilder template to associate a GtkBuilder ui file
with our application window&nbsp;class.</p>
<p>Our simple ui file puts a GtkHeaderBar on top of a GtkStack widget. The
header bar contains a GtkStackSwitcher, which is a standalone widget to show
a row of &#8216;tabs&#8217; for the pages of a&nbsp;GtkStack.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;interface&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- interface-requires gtk+ 3.8 --&gt;</span>
<span class="w">  </span><span class="nt">&lt;template</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;ExampleAppWindow&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;GtkApplicationWindow&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;title&quot;</span><span class="w"> </span><span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>Example<span class="w"> </span>Application<span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;default-width&quot;</span><span class="nt">&gt;</span>600<span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;default-height&quot;</span><span class="nt">&gt;</span>400<span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;child&gt;</span>
<span class="w">      </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkBox&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;content_box&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;orientation&quot;</span><span class="nt">&gt;</span>vertical<span class="nt">&lt;/property&gt;</span>
<span class="w">        </span><span class="nt">&lt;child&gt;</span>
<span class="w">          </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkHeaderBar&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;header&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;child</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkStackSwitcher&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;tabs&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;stack&quot;</span><span class="nt">&gt;</span>stack<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">          </span><span class="nt">&lt;/object&gt;</span>
<span class="w">        </span><span class="nt">&lt;/child&gt;</span>
<span class="w">        </span><span class="nt">&lt;child&gt;</span>
<span class="w">          </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkStack&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;stack&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">          </span><span class="nt">&lt;/object&gt;</span>
<span class="w">        </span><span class="nt">&lt;/child&gt;</span>
<span class="w">      </span><span class="nt">&lt;/object&gt;</span>
<span class="w">    </span><span class="nt">&lt;/child&gt;</span>
<span class="w">  </span><span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/interface&gt;</span>
</code></pre></div>

<p>To make use of this file in our application, we revisit our
<code>GtkApplicationWindow</code> subclass, and call
<code>gtk_widget_class_set_template_from_resource()</code> from the class init function
to set the ui file as template for this class. We also add a call to
<code>gtk_widget_init_template()</code> in the instance init function to instantiate the
template for each instance of our&nbsp;class.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ...</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">example_app_window_init</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleAppWindow</span><span class="w"> </span><span class="o">*</span><span class="n">win</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">gtk_widget_init_template</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WIDGET</span><span class="w"> </span><span class="p">(</span><span class="n">win</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">example_app_window_class_init</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleAppWindowClass</span><span class="w"> </span><span class="o">*</span><span class="n">class</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">gtk_widget_class_set_template_from_resource</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WIDGET_CLASS</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="p">),</span>
<span class="w">                                               </span><span class="s">&quot;/org/gtk/exampleapp/window.ui&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ...</span>
</code></pre></div>

<p>(<a href="https://gitlab.gnome.org/GNOME/gtk/blob/gtk-3-22/examples/application2/exampleappwin.c">Full source</a>)</p>
<p>You may have noticed that we used the <code>_from_resource()</code> variant of the
function that sets a template. Now we need to use GLib&#8217;s resource
functionality to include the ui file in the binary. This is commonly done by
listing all resources in a <code>.gresource.xml</code> file, such as&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;gresources&gt;</span>
<span class="w">  </span><span class="nt">&lt;gresource</span><span class="w"> </span><span class="na">prefix=</span><span class="s">&quot;/org/gtk/exampleapp&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;file</span><span class="w"> </span><span class="na">preprocess=</span><span class="s">&quot;xml-stripblanks&quot;</span><span class="nt">&gt;</span>window.ui<span class="nt">&lt;/file&gt;</span>
<span class="w">  </span><span class="nt">&lt;/gresource&gt;</span>
<span class="nt">&lt;/gresources&gt;</span>
</code></pre></div>

<p>This file has to be converted into a C source file that will be compiled and
linked into the application together with the other source files. To do so,
we use the <code>glib-compile-resources</code> utility:</p>
<div class="codehilite"><pre><span></span><code>glib-compile-resources exampleapp.gresource.xml --target=resources.c --generate-source
</code></pre></div>

<p>Our application now looks like&nbsp;this:</p>
<p><img alt="" src="getting-started-app2.png" /></p>
<h3 id="opening-files">Opening files<a class="md-anchor" href="getting_started.html#opening-files" title="Permanent link"></a></h3>
<p>In this step, we make our application show the content of all the files that
it is given on the&nbsp;commandline.</p>
<p>To this end, we add a private struct to our application window subclass and
keep a reference to the <code>GtkStack</code> there. The
<code>gtk_widget_class_bind_template_child_private()</code> function arranges things so
that after instantiating the template, the stack member of the private
struct will point to the widget of the same name from the&nbsp;template.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ...</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">_ExampleAppWindowPrivate</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">stack</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">G_DEFINE_TYPE_WITH_PRIVATE</span><span class="p">(</span><span class="n">ExampleAppWindow</span><span class="p">,</span><span class="w"> </span><span class="n">example_app_window</span><span class="p">,</span><span class="w"> </span><span class="n">GTK_TYPE_APPLICATION_WINDOW</span><span class="p">)</span>

<span class="p">...</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="n">example_app_window_class_init</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleAppWindowClass</span><span class="w"> </span><span class="o">*</span><span class="n">class</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">gtk_widget_class_set_template_from_resource</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WIDGET_CLASS</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="p">),</span>
<span class="w">                                               </span><span class="s">&quot;/org/gtk/exampleapp/window.ui&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_widget_class_bind_template_child_private</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WIDGET_CLASS</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="p">),</span>
<span class="w">                                                </span><span class="n">ExampleAppWindow</span><span class="p">,</span>
<span class="w">                        </span><span class="n">stack</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ...</span>
</code></pre></div>

<p>(<a href="https://gitlab.gnome.org/GNOME/gtk/blob/gtk-3-22/examples/application3/exampleappwin.c">Full source</a>)</p>
<p>Now we revisit the <code>example_app_window_open()</code> function that is called for
each commandline argument, and construct a <code>GtkTextView</code> that we then add as a
page to the&nbsp;stack:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ...</span>

<span class="kt">void</span>
<span class="nf">example_app_window_open</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleAppWindow</span><span class="w"> </span><span class="o">*</span><span class="n">win</span><span class="p">,</span>
<span class="w">                         </span><span class="n">GFile</span><span class="w">            </span><span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">ExampleAppWindowPrivate</span><span class="w"> </span><span class="o">*</span><span class="n">priv</span><span class="p">;</span>
<span class="w">  </span><span class="n">gchar</span><span class="w"> </span><span class="o">*</span><span class="n">basename</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">scrolled</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">view</span><span class="p">;</span>
<span class="w">  </span><span class="n">gchar</span><span class="w"> </span><span class="o">*</span><span class="n">contents</span><span class="p">;</span>
<span class="w">  </span><span class="n">gsize</span><span class="w"> </span><span class="n">length</span><span class="p">;</span>

<span class="w">  </span><span class="n">priv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">example_app_window_get_instance_private</span><span class="w"> </span><span class="p">(</span><span class="n">win</span><span class="p">);</span>
<span class="w">  </span><span class="n">basename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g_file_get_basename</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="p">);</span>

<span class="w">  </span><span class="n">scrolled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_scrolled_window_new</span><span class="w"> </span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_widget_show</span><span class="w"> </span><span class="p">(</span><span class="n">scrolled</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_widget_set_hexpand</span><span class="w"> </span><span class="p">(</span><span class="n">scrolled</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_widget_set_vexpand</span><span class="w"> </span><span class="p">(</span><span class="n">scrolled</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">);</span>
<span class="w">  </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_text_view_new</span><span class="w"> </span><span class="p">();</span>
<span class="w">  </span><span class="n">gtk_text_view_set_editable</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_TEXT_VIEW</span><span class="w"> </span><span class="p">(</span><span class="n">view</span><span class="p">),</span><span class="w"> </span><span class="n">FALSE</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_text_view_set_cursor_visible</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_TEXT_VIEW</span><span class="w"> </span><span class="p">(</span><span class="n">view</span><span class="p">),</span><span class="w"> </span><span class="n">FALSE</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_widget_show</span><span class="w"> </span><span class="p">(</span><span class="n">view</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_container_add</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_CONTAINER</span><span class="w"> </span><span class="p">(</span><span class="n">scrolled</span><span class="p">),</span><span class="w"> </span><span class="n">view</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_stack_add_titled</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_STACK</span><span class="w"> </span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">stack</span><span class="p">),</span><span class="w"> </span><span class="n">scrolled</span><span class="p">,</span><span class="w"> </span><span class="n">basename</span><span class="p">,</span><span class="w"> </span><span class="n">basename</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">g_file_load_contents</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">contents</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">GtkTextBuffer</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">;</span>

<span class="w">      </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_text_view_get_buffer</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_TEXT_VIEW</span><span class="w"> </span><span class="p">(</span><span class="n">view</span><span class="p">));</span>
<span class="w">      </span><span class="n">gtk_text_buffer_set_text</span><span class="w"> </span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">contents</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">);</span>
<span class="w">      </span><span class="n">g_free</span><span class="w"> </span><span class="p">(</span><span class="n">contents</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="n">g_free</span><span class="w"> </span><span class="p">(</span><span class="n">basename</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ...</span>
</code></pre></div>

<p>(<a href="https://gitlab.gnome.org/GNOME/gtk/blob/gtk-3-22/examples/application3/exampleappwin.c">Full source</a>)</p>
<p>Note that we did not have to touch the stack switcher at all. It gets all
its information from the stack that it belongs to. Here, we are passing the
label to show for each file as the last argument to the
<code>gtk_stack_add_titled()</code> function.</p>
<p>Our application is beginning to take&nbsp;shape:</p>
<p><img alt="" src="getting-started-app3.png" /></p>
<h3 id="an-application-menu">An application menu<a class="md-anchor" href="getting_started.html#an-application-menu" title="Permanent link"></a></h3>
<p>An application menu is shown by <span class="caps">GNOME</span> shell at the top of the screen. It is
meant to collect infrequently used actions that affect the whole&nbsp;application.</p>
<p>Just like the window template, we specify our application menu in a ui file,
and add it as a resource to our&nbsp;binary.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;interface&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- interface-requires gtk+ 3.0 --&gt;</span>
<span class="w">  </span><span class="nt">&lt;menu</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;appmenu&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;section&gt;</span>
<span class="w">      </span><span class="nt">&lt;item&gt;</span>
<span class="w">        </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;label&quot;</span><span class="w"> </span><span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>_Preferences<span class="nt">&lt;/attribute&gt;</span>
<span class="w">        </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>app.preferences<span class="nt">&lt;/attribute&gt;</span>
<span class="w">      </span><span class="nt">&lt;/item&gt;</span>
<span class="w">    </span><span class="nt">&lt;/section&gt;</span>
<span class="w">    </span><span class="nt">&lt;section&gt;</span>
<span class="w">      </span><span class="nt">&lt;item&gt;</span>
<span class="w">        </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;label&quot;</span><span class="w"> </span><span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>_Quit<span class="nt">&lt;/attribute&gt;</span>
<span class="w">        </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>app.quit<span class="nt">&lt;/attribute&gt;</span>
<span class="w">      </span><span class="nt">&lt;/item&gt;</span>
<span class="w">    </span><span class="nt">&lt;/section&gt;</span>
<span class="w">  </span><span class="nt">&lt;/menu&gt;</span>
<span class="nt">&lt;/interface&gt;</span>
</code></pre></div>

<p>To associate the app menu with the application, we have to call
<code>gtk_application_set_app_menu()</code>. Since app menus work by activating <code>GAction</code>s,
we also have to add a suitable set of actions to our&nbsp;application.</p>
<p>Both of these tasks are best done in the <code>startup()</code> virtual function, which
is guaranteed to be called once for each primary application&nbsp;instance:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ...</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">preferences_activated</span><span class="w"> </span><span class="p">(</span><span class="n">GSimpleAction</span><span class="w"> </span><span class="o">*</span><span class="n">action</span><span class="p">,</span>
<span class="w">                       </span><span class="n">GVariant</span><span class="w">      </span><span class="o">*</span><span class="n">parameter</span><span class="p">,</span>
<span class="w">                       </span><span class="n">gpointer</span><span class="w">       </span><span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">quit_activated</span><span class="w"> </span><span class="p">(</span><span class="n">GSimpleAction</span><span class="w"> </span><span class="o">*</span><span class="n">action</span><span class="p">,</span>
<span class="w">                </span><span class="n">GVariant</span><span class="w">      </span><span class="o">*</span><span class="n">parameter</span><span class="p">,</span>
<span class="w">                </span><span class="n">gpointer</span><span class="w">       </span><span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">g_application_quit</span><span class="w"> </span><span class="p">(</span><span class="n">G_APPLICATION</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="n">GActionEntry</span><span class="w"> </span><span class="n">app_entries</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span>
<span class="p">{</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;preferences&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">preferences_activated</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;quit&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">quit_activated</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">example_app_startup</span><span class="w"> </span><span class="p">(</span><span class="n">GApplication</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkBuilder</span><span class="w"> </span><span class="o">*</span><span class="n">builder</span><span class="p">;</span>
<span class="w">  </span><span class="n">GMenuModel</span><span class="w"> </span><span class="o">*</span><span class="n">app_menu</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">gchar</span><span class="w"> </span><span class="o">*</span><span class="n">quit_accels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;&lt;Ctrl&gt;Q&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="p">};</span>

<span class="w">  </span><span class="n">G_APPLICATION_CLASS</span><span class="w"> </span><span class="p">(</span><span class="n">example_app_parent_class</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">startup</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">);</span>

<span class="w">  </span><span class="n">g_action_map_add_action_entries</span><span class="w"> </span><span class="p">(</span><span class="n">G_ACTION_MAP</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">),</span>
<span class="w">                                   </span><span class="n">app_entries</span><span class="p">,</span><span class="w"> </span><span class="n">G_N_ELEMENTS</span><span class="w"> </span><span class="p">(</span><span class="n">app_entries</span><span class="p">),</span>
<span class="w">                                   </span><span class="n">app</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_application_set_accels_for_action</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_APPLICATION</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">),</span>
<span class="w">                                         </span><span class="s">&quot;app.quit&quot;</span><span class="p">,</span>
<span class="w">                                         </span><span class="n">quit_accels</span><span class="p">);</span>

<span class="w">  </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_builder_new_from_resource</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;/org/gtk/exampleapp/app-menu.ui&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">app_menu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G_MENU_MODEL</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_builder_get_object</span><span class="w"> </span><span class="p">(</span><span class="n">builder</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;appmenu&quot;</span><span class="p">));</span>
<span class="w">  </span><span class="n">gtk_application_set_app_menu</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_APPLICATION</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">),</span><span class="w"> </span><span class="n">app_menu</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_object_unref</span><span class="w"> </span><span class="p">(</span><span class="n">builder</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">example_app_class_init</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleAppClass</span><span class="w"> </span><span class="o">*</span><span class="n">class</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">G_APPLICATION_CLASS</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">startup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">example_app_startup</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ...</span>
</code></pre></div>

<p>(<a href="https://gitlab.gnome.org/GNOME/gtk/blob/gtk-3-22/examples/application4/exampleapp.c">Full source</a>)</p>
<p>Our preferences menu item does not do anything yet, but the <em>Quit</em> menu item
is fully functional. Note that it can also be activated by the usual
<kbd>Ctrl</kbd>+<kbd>Q</kbd> shortcut. The shortcut was added with
<code>gtk_application_set_accels_for_action()</code>.</p>
<p>The application menu looks like&nbsp;this:</p>
<p><img alt="" src="getting-started-app4.png" /></p>
<h3 id="a-preference-dialog">A preference dialog<a class="md-anchor" href="getting_started.html#a-preference-dialog" title="Permanent link"></a></h3>
<p>A typical application will have a some preferences that should be remembered
from one run to the next. Even for our simple example application, we may
want to change the font that is used for the&nbsp;content.</p>
<p>We are going to use GSettings to store our preferences. GSettings requires a
schema that describes our&nbsp;settings:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;schemalist&gt;</span>
<span class="w">  </span><span class="nt">&lt;schema</span><span class="w"> </span><span class="na">path=</span><span class="s">&quot;/org/gtk/exampleapp/&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;org.gtk.exampleapp&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;key</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;font&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;s&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;default&gt;</span>&#39;Monospace<span class="w"> </span>12&#39;<span class="nt">&lt;/default&gt;</span>
<span class="w">      </span><span class="nt">&lt;summary&gt;</span>Font<span class="nt">&lt;/summary&gt;</span>
<span class="w">      </span><span class="nt">&lt;description&gt;</span>The<span class="w"> </span>font<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>used<span class="w"> </span>for<span class="w"> </span>content.<span class="nt">&lt;/description&gt;</span>
<span class="w">    </span><span class="nt">&lt;/key&gt;</span>
<span class="w">    </span><span class="nt">&lt;key</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;transition&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;s&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;choices&gt;</span>
<span class="w">        </span><span class="nt">&lt;choice</span><span class="w"> </span><span class="na">value=</span><span class="s">&#39;none&#39;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;choice</span><span class="w"> </span><span class="na">value=</span><span class="s">&#39;crossfade&#39;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;choice</span><span class="w"> </span><span class="na">value=</span><span class="s">&#39;slide-left-right&#39;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/choices&gt;</span>
<span class="w">      </span><span class="nt">&lt;default&gt;</span>&#39;none&#39;<span class="nt">&lt;/default&gt;</span>
<span class="w">      </span><span class="nt">&lt;summary&gt;</span>Transition<span class="nt">&lt;/summary&gt;</span>
<span class="w">      </span><span class="nt">&lt;description&gt;</span>The<span class="w"> </span>transition<span class="w"> </span>to<span class="w"> </span>use<span class="w"> </span>when<span class="w"> </span>switching<span class="w"> </span>tabs.<span class="nt">&lt;/description&gt;</span>
<span class="w">    </span><span class="nt">&lt;/key&gt;</span>
<span class="w">  </span><span class="nt">&lt;/schema&gt;</span>
<span class="nt">&lt;/schemalist&gt;</span>
</code></pre></div>

<p>Before we can make use of this schema in our application, we need to compile
it into the binary form that GSettings expects. <span class="caps">GIO</span> provides macros to do
this in Autotools-based projects, whereas Meson provides the same
functionality through the <code>gnome</code> module.</p>
<p>Next, we need to connect our settings to the widgets that they are supposed
to control. One convenient way to do this is to use GSettings bind
functionality to bind settings keys to object properties, as we do here for
the transition&nbsp;setting.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ...</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">example_app_window_init</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleAppWindow</span><span class="w"> </span><span class="o">*</span><span class="n">win</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">ExampleAppWindowPrivate</span><span class="w"> </span><span class="o">*</span><span class="n">priv</span><span class="p">;</span>

<span class="w">  </span><span class="n">priv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">example_app_window_get_instance_private</span><span class="w"> </span><span class="p">(</span><span class="n">win</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_widget_init_template</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WIDGET</span><span class="w"> </span><span class="p">(</span><span class="n">win</span><span class="p">));</span>
<span class="w">  </span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g_settings_new</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;org.gtk.exampleapp&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="n">g_settings_bind</span><span class="w"> </span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">settings</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;transition&quot;</span><span class="p">,</span>
<span class="w">                   </span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">stack</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;transition-type&quot;</span><span class="p">,</span>
<span class="w">                   </span><span class="n">G_SETTINGS_BIND_DEFAULT</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ...</span>
</code></pre></div>

<p>(<a href="https://gitlab.gnome.org/GNOME/gtk/blob/gtk-3-22/examples/application5/exampleappwin.c">Full source</a>)</p>
<p>The code to connect the font setting is a little more involved, since there
is no simple object property that it corresponds to, so we are not going to
go into that&nbsp;here.</p>
<p>At this point, the application will already react if you change one of the
settings, e.g. using the gsettings commandline tool. Of course, we expect
the application to provide a preference dialog for these. So lets do that
now. Our preference dialog will be a subclass of <code>GtkDialog</code>, and we&#8217;ll use
the same techniques that we&#8217;ve already seen: templates, private structs,
settings&nbsp;bindings.</p>
<p>Lets start with the&nbsp;template:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;interface&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- interface-requires gtk+ 3.8 --&gt;</span>
<span class="w">  </span><span class="nt">&lt;template</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;ExampleAppPrefs&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;GtkDialog&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;title&quot;</span><span class="w"> </span><span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>Preferences<span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;resizable&quot;</span><span class="nt">&gt;</span>False<span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;modal&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;child</span><span class="w"> </span><span class="na">internal-child=</span><span class="s">&quot;vbox&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkBox&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;vbox&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;child&gt;</span>
<span class="w">          </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkGrid&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;grid&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;margin&quot;</span><span class="nt">&gt;</span>6<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;row-spacing&quot;</span><span class="nt">&gt;</span>12<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;column-spacing&quot;</span><span class="nt">&gt;</span>6<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;child&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkLabel&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;fontlabel&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;label&quot;</span><span class="nt">&gt;</span>_Font:<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;use-underline&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mnemonic-widget&quot;</span><span class="nt">&gt;</span>font<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;xalign&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">              </span><span class="nt">&lt;packing&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;left-attach&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;top-attach&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/packing&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">            </span><span class="nt">&lt;child&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkFontButton&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;font&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">              </span><span class="nt">&lt;packing&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;left-attach&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;top-attach&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/packing&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">            </span><span class="nt">&lt;child&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkLabel&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;transitionlabel&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;label&quot;</span><span class="nt">&gt;</span>_Transition:<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;use-underline&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mnemonic-widget&quot;</span><span class="nt">&gt;</span>transition<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;xalign&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">              </span><span class="nt">&lt;packing&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;left-attach&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;top-attach&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/packing&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">            </span><span class="nt">&lt;child&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkComboBoxText&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;transition&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;items&gt;</span>
<span class="w">                  </span><span class="nt">&lt;item</span><span class="w"> </span><span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;none&quot;</span><span class="nt">&gt;</span>None<span class="nt">&lt;/item&gt;</span>
<span class="w">                  </span><span class="nt">&lt;item</span><span class="w"> </span><span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;crossfade&quot;</span><span class="nt">&gt;</span>Fade<span class="nt">&lt;/item&gt;</span>
<span class="w">                  </span><span class="nt">&lt;item</span><span class="w"> </span><span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;slide-left-right&quot;</span><span class="nt">&gt;</span>Slide<span class="nt">&lt;/item&gt;</span>
<span class="w">                </span><span class="nt">&lt;/items&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">              </span><span class="nt">&lt;packing&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;left-attach&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;top-attach&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/packing&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">          </span><span class="nt">&lt;/object&gt;</span>
<span class="w">        </span><span class="nt">&lt;/child&gt;</span>
<span class="w">      </span><span class="nt">&lt;/object&gt;</span>
<span class="w">    </span><span class="nt">&lt;/child&gt;</span>
<span class="w">  </span><span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/interface&gt;</span>
</code></pre></div>

<p>Next comes the dialog&nbsp;class:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtk/gtk.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;exampleapp.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;exampleappwin.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;exampleappprefs.h&quot;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">_ExampleAppPrefs</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkDialog</span><span class="w"> </span><span class="n">parent</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">_ExampleAppPrefsPrivate</span><span class="w"> </span><span class="n">ExampleAppPrefsPrivate</span><span class="p">;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">_ExampleAppPrefsPrivate</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GSettings</span><span class="w"> </span><span class="o">*</span><span class="n">settings</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">font</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">transition</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">G_DEFINE_TYPE_WITH_PRIVATE</span><span class="p">(</span><span class="n">ExampleAppPrefs</span><span class="p">,</span><span class="w"> </span><span class="n">example_app_prefs</span><span class="p">,</span><span class="w"> </span><span class="n">GTK_TYPE_DIALOG</span><span class="p">)</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="n">example_app_prefs_init</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleAppPrefs</span><span class="w"> </span><span class="o">*</span><span class="n">prefs</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">ExampleAppPrefsPrivate</span><span class="w"> </span><span class="o">*</span><span class="n">priv</span><span class="p">;</span>

<span class="w">  </span><span class="n">priv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">example_app_prefs_get_instance_private</span><span class="w"> </span><span class="p">(</span><span class="n">prefs</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_widget_init_template</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WIDGET</span><span class="w"> </span><span class="p">(</span><span class="n">prefs</span><span class="p">));</span>
<span class="w">  </span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g_settings_new</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;org.gtk.exampleapp&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="n">g_settings_bind</span><span class="w"> </span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">settings</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;font&quot;</span><span class="p">,</span>
<span class="w">                   </span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">font</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;font&quot;</span><span class="p">,</span>
<span class="w">                   </span><span class="n">G_SETTINGS_BIND_DEFAULT</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_settings_bind</span><span class="w"> </span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">settings</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;transition&quot;</span><span class="p">,</span>
<span class="w">                   </span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">transition</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;active-id&quot;</span><span class="p">,</span>
<span class="w">                   </span><span class="n">G_SETTINGS_BIND_DEFAULT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="n">example_app_prefs_dispose</span><span class="w"> </span><span class="p">(</span><span class="n">GObject</span><span class="w"> </span><span class="o">*</span><span class="n">object</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">ExampleAppPrefsPrivate</span><span class="w"> </span><span class="o">*</span><span class="n">priv</span><span class="p">;</span>

<span class="w">  </span><span class="n">priv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">example_app_prefs_get_instance_private</span><span class="w"> </span><span class="p">(</span><span class="n">EXAMPLE_APP_PREFS</span><span class="w"> </span><span class="p">(</span><span class="n">object</span><span class="p">));</span>
<span class="w">  </span><span class="n">g_clear_object</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">settings</span><span class="p">);</span>

<span class="w">  </span><span class="n">G_OBJECT_CLASS</span><span class="w"> </span><span class="p">(</span><span class="n">example_app_prefs_parent_class</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">dispose</span><span class="w"> </span><span class="p">(</span><span class="n">object</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="n">example_app_prefs_class_init</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleAppPrefsClass</span><span class="w"> </span><span class="o">*</span><span class="n">class</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">G_OBJECT_CLASS</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">dispose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">example_app_prefs_dispose</span><span class="p">;</span>

<span class="w">  </span><span class="n">gtk_widget_class_set_template_from_resource</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WIDGET_CLASS</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="p">),</span>
<span class="w">                                               </span><span class="s">&quot;/org/gtk/exampleapp/prefs.ui&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_widget_class_bind_template_child_private</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WIDGET_CLASS</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="p">),</span><span class="w"> </span><span class="n">ExampleAppPrefs</span><span class="p">,</span><span class="w"> </span><span class="n">font</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_widget_class_bind_template_child_private</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WIDGET_CLASS</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="p">),</span><span class="w"> </span><span class="n">ExampleAppPrefs</span><span class="p">,</span><span class="w"> </span><span class="n">transition</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">ExampleAppPrefs</span><span class="w"> </span><span class="o">*</span>
<span class="n">example_app_prefs_new</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleAppWindow</span><span class="w"> </span><span class="o">*</span><span class="n">win</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">g_object_new</span><span class="w"> </span><span class="p">(</span><span class="n">EXAMPLE_APP_PREFS_TYPE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;transient-for&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">win</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;use-header-bar&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Now we revisit the <code>preferences_activated()</code> function in our application
class, and make it open a new preference&nbsp;dialog:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ...</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">preferences_activated</span><span class="w"> </span><span class="p">(</span><span class="n">GSimpleAction</span><span class="w"> </span><span class="o">*</span><span class="n">action</span><span class="p">,</span>
<span class="w">                       </span><span class="n">GVariant</span><span class="w">      </span><span class="o">*</span><span class="n">parameter</span><span class="p">,</span>
<span class="w">                       </span><span class="n">gpointer</span><span class="w">       </span><span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">ExampleAppPrefs</span><span class="w"> </span><span class="o">*</span><span class="n">prefs</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkWindow</span><span class="w"> </span><span class="o">*</span><span class="n">win</span><span class="p">;</span>

<span class="w">  </span><span class="n">win</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_application_get_active_window</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_APPLICATION</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">));</span>
<span class="w">  </span><span class="n">prefs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">example_app_prefs_new</span><span class="w"> </span><span class="p">(</span><span class="n">EXAMPLE_APP_WINDOW</span><span class="w"> </span><span class="p">(</span><span class="n">win</span><span class="p">));</span>
<span class="w">  </span><span class="n">gtk_window_present</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WINDOW</span><span class="w"> </span><span class="p">(</span><span class="n">prefs</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// ...</span>
</code></pre></div>

<p>(<a href="https://gitlab.gnome.org/GNOME/gtk/blob/gtk-3-22/examples/application6/exampleapp.c">Full source</a>)</p>
<p>After all this work, our application can now show a preference dialog like&nbsp;this:</p>
<p><img alt="" src="getting-started-app6.png" /></p>
<h3 id="adding-a-search-bar">Adding a search bar<a class="md-anchor" href="getting_started.html#adding-a-search-bar" title="Permanent link"></a></h3>
<p>We continue to flesh out the functionality of our application. For now, we
add search. <span class="caps">GTK</span> supports this with <code>GtkSearchEntry</code> and <code>GtkSearchBar</code>. The
search bar is a widget that can slide in from the top of a container to
present a search&nbsp;entry.</p>
<p>We add a toggle button to the header bar, which can be used to slide out the
search bar below the header&nbsp;bar.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;interface&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- interface-requires gtk+ 3.8 --&gt;</span>
<span class="w">  </span><span class="nt">&lt;template</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;ExampleAppWindow&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;GtkApplicationWindow&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;title&quot;</span><span class="w"> </span><span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>Example<span class="w"> </span>Application<span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;default-width&quot;</span><span class="nt">&gt;</span>600<span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;default-height&quot;</span><span class="nt">&gt;</span>400<span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;child&gt;</span>
<span class="w">      </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkBox&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;content_box&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;orientation&quot;</span><span class="nt">&gt;</span>vertical<span class="nt">&lt;/property&gt;</span>
<span class="w">        </span><span class="nt">&lt;child&gt;</span>
<span class="w">          </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkHeaderBar&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;header&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;child</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkStackSwitcher&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;tabs&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;stack&quot;</span><span class="nt">&gt;</span>stack<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">            </span><span class="nt">&lt;child&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkToggleButton&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;search&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;sensitive&quot;</span><span class="nt">&gt;</span>False<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;style&gt;</span>
<span class="w">                  </span><span class="nt">&lt;class</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;image-button&quot;</span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;/style&gt;</span>
<span class="w">                </span><span class="nt">&lt;child&gt;</span>
<span class="w">                  </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkImage&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;search-icon&quot;</span><span class="nt">&gt;</span>
<span class="w">                    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;icon-name&quot;</span><span class="nt">&gt;</span>edit-find-symbolic<span class="nt">&lt;/property&gt;</span>
<span class="w">                    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;icon-size&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
<span class="w">                  </span><span class="nt">&lt;/object&gt;</span>
<span class="w">                </span><span class="nt">&lt;/child&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">              </span><span class="nt">&lt;packing&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pack-type&quot;</span><span class="nt">&gt;</span>end<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/packing&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">          </span><span class="nt">&lt;/object&gt;</span>
<span class="w">        </span><span class="nt">&lt;/child&gt;</span>
<span class="w">        </span><span class="nt">&lt;child&gt;</span>
<span class="w">          </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkSearchBar&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;searchbar&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;child&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkSearchEntry&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;searchentry&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;signal</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;search-changed&quot;</span><span class="w"> </span><span class="na">handler=</span><span class="s">&quot;search_text_changed&quot;</span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">          </span><span class="nt">&lt;/object&gt;</span>
<span class="w">        </span><span class="nt">&lt;/child&gt;</span>
<span class="w">        </span><span class="nt">&lt;child&gt;</span>
<span class="w">          </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkStack&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;stack&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;signal</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;notify::visible-child&quot;</span><span class="w"> </span><span class="na">handler=</span><span class="s">&quot;visible_child_changed&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">          </span><span class="nt">&lt;/object&gt;</span>
<span class="w">        </span><span class="nt">&lt;/child&gt;</span>
<span class="w">      </span><span class="nt">&lt;/object&gt;</span>
<span class="w">    </span><span class="nt">&lt;/child&gt;</span>
<span class="w">  </span><span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/interface&gt;</span>
</code></pre></div>

<p>Implementing the search needs quite a few code changes that we are not going
to completely go over here. The central piece of the search implementation
is a signal handler that listens for text changes in the search&nbsp;entry:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ...</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">search_text_changed</span><span class="w"> </span><span class="p">(</span><span class="n">GtkEntry</span><span class="w">         </span><span class="o">*</span><span class="n">entry</span><span class="p">,</span>
<span class="w">                     </span><span class="n">ExampleAppWindow</span><span class="w"> </span><span class="o">*</span><span class="n">win</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">ExampleAppWindowPrivate</span><span class="w"> </span><span class="o">*</span><span class="n">priv</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">gchar</span><span class="w"> </span><span class="o">*</span><span class="n">text</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">tab</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">view</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkTextBuffer</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkTextIter</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">match_start</span><span class="p">,</span><span class="w"> </span><span class="n">match_end</span><span class="p">;</span>

<span class="w">  </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_entry_get_text</span><span class="w"> </span><span class="p">(</span><span class="n">entry</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>

<span class="w">  </span><span class="n">priv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">example_app_window_get_instance_private</span><span class="w"> </span><span class="p">(</span><span class="n">win</span><span class="p">);</span>

<span class="w">  </span><span class="n">tab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_stack_get_visible_child</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_STACK</span><span class="w"> </span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">stack</span><span class="p">));</span>
<span class="w">  </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_bin_get_child</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_BIN</span><span class="w"> </span><span class="p">(</span><span class="n">tab</span><span class="p">));</span>
<span class="w">  </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_text_view_get_buffer</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_TEXT_VIEW</span><span class="w"> </span><span class="p">(</span><span class="n">view</span><span class="p">));</span>

<span class="w">  </span><span class="cm">/* Very simple-minded search implementation */</span>
<span class="w">  </span><span class="n">gtk_text_buffer_get_start_iter</span><span class="w"> </span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">start</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_text_iter_forward_search</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">GTK_TEXT_SEARCH_CASE_INSENSITIVE</span><span class="p">,</span>
<span class="w">                                    </span><span class="o">&amp;</span><span class="n">match_start</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">match_end</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">gtk_text_buffer_select_range</span><span class="w"> </span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">match_start</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">match_end</span><span class="p">);</span>
<span class="w">      </span><span class="n">gtk_text_view_scroll_to_iter</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_TEXT_VIEW</span><span class="w"> </span><span class="p">(</span><span class="n">view</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">match_start</span><span class="p">,</span>
<span class="w">                                    </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">FALSE</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">example_app_window_init</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleAppWindow</span><span class="w"> </span><span class="o">*</span><span class="n">win</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// ...</span>

<span class="w">  </span><span class="n">gtk_widget_class_bind_template_callback</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WIDGET_CLASS</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="p">),</span><span class="w"> </span><span class="n">search_text_changed</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// ...</span>
</code></pre></div>

<p>(<a href="https://gitlab.gnome.org/GNOME/gtk/blob/gtk-3-22/examples/application7/exampleappwin.c">Full source</a>)</p>
<p>With the search bar, our application now looks like&nbsp;this:</p>
<p><img alt="" src="getting-started-app7.png" /></p>
<h3 id="adding-a-side-bar">Adding a side bar<a class="md-anchor" href="getting_started.html#adding-a-side-bar" title="Permanent link"></a></h3>
<p>As another piece of functionality, we are adding a sidebar, which
demonstrates <code>GtkMenuButton</code>, <code>GtkRevealer</code> and <code>GtkListBox</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;interface&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- interface-requires gtk+ 3.8 --&gt;</span>
<span class="w">  </span><span class="nt">&lt;template</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;ExampleAppWindow&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;GtkApplicationWindow&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;title&quot;</span><span class="w"> </span><span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>Example<span class="w"> </span>Application<span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;default-width&quot;</span><span class="nt">&gt;</span>600<span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;default-height&quot;</span><span class="nt">&gt;</span>400<span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;child&gt;</span>
<span class="w">      </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkBox&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;content_box&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;orientation&quot;</span><span class="nt">&gt;</span>vertical<span class="nt">&lt;/property&gt;</span>
<span class="w">        </span><span class="nt">&lt;child&gt;</span>
<span class="w">          </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkHeaderBar&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;header&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;child</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkStackSwitcher&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;tabs&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;stack&quot;</span><span class="nt">&gt;</span>stack<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">            </span><span class="nt">&lt;child&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkToggleButton&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;search&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;sensitive&quot;</span><span class="nt">&gt;</span>False<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;style&gt;</span>
<span class="w">                  </span><span class="nt">&lt;class</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;image-button&quot;</span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;/style&gt;</span>
<span class="w">                </span><span class="nt">&lt;child&gt;</span>
<span class="w">                  </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkImage&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;search-icon&quot;</span><span class="nt">&gt;</span>
<span class="w">                    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;icon-name&quot;</span><span class="nt">&gt;</span>edit-find-symbolic<span class="nt">&lt;/property&gt;</span>
<span class="w">                    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;icon-size&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
<span class="w">                  </span><span class="nt">&lt;/object&gt;</span>
<span class="w">                </span><span class="nt">&lt;/child&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">              </span><span class="nt">&lt;packing&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pack-type&quot;</span><span class="nt">&gt;</span>end<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/packing&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">            </span><span class="nt">&lt;child&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkMenuButton&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;gears&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;direction&quot;</span><span class="nt">&gt;</span>none<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;use-popover&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;style&gt;</span>
<span class="w">                  </span><span class="nt">&lt;class</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;image-button&quot;</span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;/style&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">              </span><span class="nt">&lt;packing&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pack-type&quot;</span><span class="nt">&gt;</span>end<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/packing&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">          </span><span class="nt">&lt;/object&gt;</span>
<span class="w">        </span><span class="nt">&lt;/child&gt;</span>
<span class="w">        </span><span class="nt">&lt;child&gt;</span>
<span class="w">          </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkSearchBar&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;searchbar&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;child&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkSearchEntry&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;searchentry&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;signal</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;search-changed&quot;</span><span class="w"> </span><span class="na">handler=</span><span class="s">&quot;search_text_changed&quot;</span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">          </span><span class="nt">&lt;/object&gt;</span>
<span class="w">        </span><span class="nt">&lt;/child&gt;</span>
<span class="w">        </span><span class="nt">&lt;child&gt;</span>
<span class="w">          </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkBox&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;hbox&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;child&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkRevealer&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;sidebar&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;transition-type&quot;</span><span class="nt">&gt;</span>slide-right<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;child&gt;</span>
<span class="w">                 </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkScrolledWindow&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;sidebar-sw&quot;</span><span class="nt">&gt;</span>
<span class="w">                   </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                   </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;hscrollbar-policy&quot;</span><span class="nt">&gt;</span>never<span class="nt">&lt;/property&gt;</span>
<span class="w">                   </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;vscrollbar-policy&quot;</span><span class="nt">&gt;</span>automatic<span class="nt">&lt;/property&gt;</span>
<span class="w">                   </span><span class="nt">&lt;child&gt;</span>
<span class="w">                     </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkListBox&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;words&quot;</span><span class="nt">&gt;</span>
<span class="w">                       </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                       </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;selection-mode&quot;</span><span class="nt">&gt;</span>none<span class="nt">&lt;/property&gt;</span>
<span class="w">                     </span><span class="nt">&lt;/object&gt;</span>
<span class="w">                   </span><span class="nt">&lt;/child&gt;</span>
<span class="w">                 </span><span class="nt">&lt;/object&gt;</span>
<span class="w">                </span><span class="nt">&lt;/child&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">            </span><span class="nt">&lt;child&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkStack&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;stack&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;signal</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;notify::visible-child&quot;</span><span class="w"> </span><span class="na">handler=</span><span class="s">&quot;visible_child_changed&quot;</span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">          </span><span class="nt">&lt;/object&gt;</span>
<span class="w">        </span><span class="nt">&lt;/child&gt;</span>
<span class="w">      </span><span class="nt">&lt;/object&gt;</span>
<span class="w">    </span><span class="nt">&lt;/child&gt;</span>
<span class="w">  </span><span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/interface&gt;</span>
</code></pre></div>

<p>The code to populate the sidebar with buttons for the words found in each
file is a little too involved to go into here. But we&#8217;ll look at the code to
add the gears&nbsp;menu.</p>
<p>As expected by now, the gears menu is specified in a <code>GtkBuilder</code> <span class="caps">UI</span>&nbsp;file:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;interface&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- interface-requires gtk+ 3.0 --&gt;</span>
<span class="w">  </span><span class="nt">&lt;menu</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;menu&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;section&gt;</span>
<span class="w">      </span><span class="nt">&lt;item&gt;</span>
<span class="w">        </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;label&quot;</span><span class="w"> </span><span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>_Words<span class="nt">&lt;/attribute&gt;</span>
<span class="w">        </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>win.show-words<span class="nt">&lt;/attribute&gt;</span>
<span class="w">      </span><span class="nt">&lt;/item&gt;</span>
<span class="w">    </span><span class="nt">&lt;/section&gt;</span>
<span class="w">  </span><span class="nt">&lt;/menu&gt;</span>
<span class="nt">&lt;/interface&gt;</span>
</code></pre></div>

<p>To connect the menuitem to the show-words setting, we use a <code>GAction</code>
corresponding to the given <code>GSettings</code> key.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ...</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">example_app_window_init</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleAppWindow</span><span class="w"> </span><span class="o">*</span><span class="n">win</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// ...</span>

<span class="w">  </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_builder_new_from_resource</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;/org/gtk/exampleapp/gears-menu.ui&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">menu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G_MENU_MODEL</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_builder_get_object</span><span class="w"> </span><span class="p">(</span><span class="n">builder</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;menu&quot;</span><span class="p">));</span>
<span class="w">  </span><span class="n">gtk_menu_button_set_menu_model</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_MENU_BUTTON</span><span class="w"> </span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">gears</span><span class="p">),</span><span class="w"> </span><span class="n">menu</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_object_unref</span><span class="w"> </span><span class="p">(</span><span class="n">builder</span><span class="p">);</span>

<span class="w">  </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g_settings_create_action</span><span class="w"> </span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">settings</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;show-words&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_action_map_add_action</span><span class="w"> </span><span class="p">(</span><span class="n">G_ACTION_MAP</span><span class="w"> </span><span class="p">(</span><span class="n">win</span><span class="p">),</span><span class="w"> </span><span class="n">action</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_object_unref</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ...</span>
</code></pre></div>

<p>(<a href="https://gitlab.gnome.org/GNOME/gtk/blob/gtk-3-22/examples/application8/exampleappwin.c">Full source</a>)</p>
<p>What our application looks like&nbsp;now:</p>
<p><img alt="" src="getting-started-app8.png" /></p>
<h3 id="properties">Properties<a class="md-anchor" href="getting_started.html#properties" title="Permanent link"></a></h3>
<p>Widgets and other objects have many useful&nbsp;properties.</p>
<p>Here we show some ways to use them in new and flexible ways, by wrapping
them in actions with <code>GPropertyAction</code> or by binding them with <code>GBinding</code>.</p>
<p>To set this up, we add two labels to the header bar in our window template,
named <code>lines_label</code> and <code>lines</code>, and bind them to struct members in the
private struct, as we&#8217;ve seen a couple of times by&nbsp;now.</p>
<p>We add a new &#8220;Lines&#8221; menu item to the gears menu, which triggers the
<code>show-lines</code> action:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;interface&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- interface-requires gtk+ 3.0 --&gt;</span>
<span class="w">  </span><span class="nt">&lt;menu</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;menu&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;section&gt;</span>
<span class="w">      </span><span class="nt">&lt;item&gt;</span>
<span class="w">        </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;label&quot;</span><span class="w"> </span><span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>_Words<span class="nt">&lt;/attribute&gt;</span>
<span class="w">        </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>win.show-words<span class="nt">&lt;/attribute&gt;</span>
<span class="w">      </span><span class="nt">&lt;/item&gt;</span>
<span class="w">      </span><span class="nt">&lt;item&gt;</span>
<span class="w">        </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;label&quot;</span><span class="w"> </span><span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>_Lines<span class="nt">&lt;/attribute&gt;</span>
<span class="w">        </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>win.show-lines<span class="nt">&lt;/attribute&gt;</span>
<span class="w">      </span><span class="nt">&lt;/item&gt;</span>
<span class="w">    </span><span class="nt">&lt;/section&gt;</span>
<span class="w">  </span><span class="nt">&lt;/menu&gt;</span>
<span class="nt">&lt;/interface&gt;</span>
</code></pre></div>

<p>To make this menu item do something, we create a property action for the
visible property of the <code>lines</code> label, and add it to the actions of the
window. The effect of this is that the visibility of the label gets toggled
every time the action is&nbsp;activated.</p>
<p>Since we want both labels to appear and disappear together, we bind the
visible property of the <code>lines_label</code> widget to the same property of the
<code>lines</code> widget.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ...</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">example_app_window_init</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleAppWindow</span><span class="w"> </span><span class="o">*</span><span class="n">win</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// ...</span>

<span class="w">  </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">GAction</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">g_property_action_new</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;show-lines&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">lines</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;visible&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_action_map_add_action</span><span class="w"> </span><span class="p">(</span><span class="n">G_ACTION_MAP</span><span class="w"> </span><span class="p">(</span><span class="n">win</span><span class="p">),</span><span class="w"> </span><span class="n">action</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_object_unref</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="p">);</span>

<span class="w">  </span><span class="n">g_object_bind_property</span><span class="w"> </span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">lines</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;visible&quot;</span><span class="p">,</span>
<span class="w">                          </span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">lines_label</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;visible&quot;</span><span class="p">,</span>
<span class="w">                          </span><span class="n">G_BINDING_DEFAULT</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ...</span>
</code></pre></div>

<p>(<a href="https://gitlab.gnome.org/GNOME/gtk/blob/gtk-3-22/examples/application9/exampleappwin.c">Full source</a>)</p>
<p>We also need a function that counts the lines of the currently active tab,
and updates the <code>lines</code> label. See the full source if you are interested in
the&nbsp;details.</p>
<p>This brings our example application to this&nbsp;appearance:</p>
<p><img alt="" src="getting-started-app9.png" /></p>
<h3 id="header-bar">Header bar<a class="md-anchor" href="getting_started.html#header-bar" title="Permanent link"></a></h3>
<p>Our application already uses a <code>GtkHeaderBar</code>, but so far it still gets a
&#8216;normal&#8217; window titlebar on top of that. This is a bit redundant, and we
will now tell <span class="caps">GTK</span> to use the header bar as replacement for the titlebar. To
do so, we move it around to be a direct child of the window, and set its
type to be <code>titlebar</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;interface&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- interface-requires gtk+ 3.8 --&gt;</span>
<span class="w">  </span><span class="nt">&lt;template</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;ExampleAppWindow&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;GtkApplicationWindow&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;title&quot;</span><span class="w"> </span><span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>Example<span class="w"> </span>Application<span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;default-width&quot;</span><span class="nt">&gt;</span>600<span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;default-height&quot;</span><span class="nt">&gt;</span>400<span class="nt">&lt;/property&gt;</span>
<span class="w">        </span><span class="nt">&lt;child</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;titlebar&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkHeaderBar&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;header&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;show-close-button&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;child&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkLabel&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;lines_label&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>False<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;label&quot;</span><span class="w"> </span><span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>Lines:<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">              </span><span class="nt">&lt;packing&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pack-type&quot;</span><span class="nt">&gt;</span>start<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/packing&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">            </span><span class="nt">&lt;child&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkLabel&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;lines&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>False<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">              </span><span class="nt">&lt;packing&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pack-type&quot;</span><span class="nt">&gt;</span>start<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/packing&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">            </span><span class="nt">&lt;child</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkStackSwitcher&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;tabs&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;stack&quot;</span><span class="nt">&gt;</span>stack<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">            </span><span class="nt">&lt;child&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkToggleButton&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;search&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;sensitive&quot;</span><span class="nt">&gt;</span>False<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;style&gt;</span>
<span class="w">                  </span><span class="nt">&lt;class</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;image-button&quot;</span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;/style&gt;</span>
<span class="w">                </span><span class="nt">&lt;child&gt;</span>
<span class="w">                  </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkImage&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;search-icon&quot;</span><span class="nt">&gt;</span>
<span class="w">                    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;icon-name&quot;</span><span class="nt">&gt;</span>edit-find-symbolic<span class="nt">&lt;/property&gt;</span>
<span class="w">                    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;icon-size&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
<span class="w">                  </span><span class="nt">&lt;/object&gt;</span>
<span class="w">                </span><span class="nt">&lt;/child&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">              </span><span class="nt">&lt;packing&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pack-type&quot;</span><span class="nt">&gt;</span>end<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/packing&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">            </span><span class="nt">&lt;child&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkMenuButton&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;gears&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;direction&quot;</span><span class="nt">&gt;</span>none<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;use-popover&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;style&gt;</span>
<span class="w">                  </span><span class="nt">&lt;class</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;image-button&quot;</span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;/style&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">              </span><span class="nt">&lt;packing&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pack-type&quot;</span><span class="nt">&gt;</span>end<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/packing&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">          </span><span class="nt">&lt;/object&gt;</span>
<span class="w">        </span><span class="nt">&lt;/child&gt;</span>
<span class="w">    </span><span class="nt">&lt;child&gt;</span>
<span class="w">      </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkBox&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;content_box&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;orientation&quot;</span><span class="nt">&gt;</span>vertical<span class="nt">&lt;/property&gt;</span>
<span class="w">        </span><span class="nt">&lt;child&gt;</span>
<span class="w">          </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkSearchBar&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;searchbar&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;child&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkSearchEntry&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;searchentry&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;signal</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;search-changed&quot;</span><span class="w"> </span><span class="na">handler=</span><span class="s">&quot;search_text_changed&quot;</span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">          </span><span class="nt">&lt;/object&gt;</span>
<span class="w">        </span><span class="nt">&lt;/child&gt;</span>
<span class="w">        </span><span class="nt">&lt;child&gt;</span>
<span class="w">          </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkBox&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;hbox&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">            </span><span class="nt">&lt;child&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkRevealer&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;sidebar&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;transition-type&quot;</span><span class="nt">&gt;</span>slide-right<span class="nt">&lt;/property&gt;</span>
<span class="w">                </span><span class="nt">&lt;child&gt;</span>
<span class="w">                 </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkScrolledWindow&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;sidebar-sw&quot;</span><span class="nt">&gt;</span>
<span class="w">                   </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                   </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;hscrollbar-policy&quot;</span><span class="nt">&gt;</span>never<span class="nt">&lt;/property&gt;</span>
<span class="w">                   </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;vscrollbar-policy&quot;</span><span class="nt">&gt;</span>automatic<span class="nt">&lt;/property&gt;</span>
<span class="w">                   </span><span class="nt">&lt;child&gt;</span>
<span class="w">                     </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkListBox&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;words&quot;</span><span class="nt">&gt;</span>
<span class="w">                       </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">                       </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;selection-mode&quot;</span><span class="nt">&gt;</span>none<span class="nt">&lt;/property&gt;</span>
<span class="w">                     </span><span class="nt">&lt;/object&gt;</span>
<span class="w">                   </span><span class="nt">&lt;/child&gt;</span>
<span class="w">                 </span><span class="nt">&lt;/object&gt;</span>
<span class="w">                </span><span class="nt">&lt;/child&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">            </span><span class="nt">&lt;child&gt;</span>
<span class="w">              </span><span class="nt">&lt;object</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;GtkStack&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;stack&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;signal</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;notify::visible-child&quot;</span><span class="w"> </span><span class="na">handler=</span><span class="s">&quot;visible_child_changed&quot;</span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visible&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
<span class="w">              </span><span class="nt">&lt;/object&gt;</span>
<span class="w">            </span><span class="nt">&lt;/child&gt;</span>
<span class="w">          </span><span class="nt">&lt;/object&gt;</span>
<span class="w">        </span><span class="nt">&lt;/child&gt;</span>
<span class="w">      </span><span class="nt">&lt;/object&gt;</span>
<span class="w">    </span><span class="nt">&lt;/child&gt;</span>
<span class="w">  </span><span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/interface&gt;</span>
</code></pre></div>

<p>A small extra bonus of using a header bar is that we get a fallback
application menu for free. Here is how the application now looks, if this
fallback is&nbsp;used:</p>
<p><img alt="" src="getting-started-app10.png" /></p>
<p>If we set up the window icon for our window, the menu button will use that
instead of the generic placeholder icon you see&nbsp;here.</p>
<h2 id="custom-drawing">Custom drawing<a class="md-anchor" href="getting_started.html#custom-drawing" title="Permanent link"></a></h2>
<p>Many widgets, like buttons, do all their drawing themselves. You just tell
them the label you want to see, and they figure out what font to use, draw
the button outline and focus rectangle, etc. Sometimes, it is necessary to
do some custom drawing. In that case, a <a href="class.DrawingArea.html"><code>GtkDrawingArea</code></a> might be the right
widget to use. It offers a canvas on which you can draw by connecting to the
<a href="signal.Widget.draw.html"><code>GtkWidget::draw</code></a>&nbsp;signal.</p>
<p>The contents of a widget often need to be partially or fully redrawn, e.g.
when another window is moved and uncovers part of the widget, or when the
window containing it is resized. It is also possible to explicitly cause
part or all of the widget to be redrawn, by calling <a href="method.Widget.queue_draw.html"><code>gtk_widget_queue_draw()</code></a>
or its variants. <span class="caps">GTK</span> takes care of most of the details by providing a
ready-to-use Cairo context to the <code>draw</code> signal&nbsp;handler.</p>
<p>The following example shows a <code>draw</code> signal handler. It is a bit more
complicated than the previous examples, since it also demonstrates input
event handling by means of <a href="signal.Widget.button-press-event.html"><code>GtkWidget::button-press-event</code></a> and
<a href="signal.Widget.motion-notify-event.html"><code>GtkWidget::motion-notify-event</code></a> signal&nbsp;handlers.</p>
<p><img alt="" src="drawing.png" /></p>
<p>Save the following example in a file name <code>example-4.c</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtk/gtk.h&gt;</span>

<span class="cm">/* Surface to store current scribbles */</span>
<span class="k">static</span><span class="w"> </span><span class="n">cairo_surface_t</span><span class="w"> </span><span class="o">*</span><span class="n">surface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">clear_surface</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">cairo_t</span><span class="w"> </span><span class="o">*</span><span class="n">cr</span><span class="p">;</span>

<span class="w">  </span><span class="n">cr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cairo_create</span><span class="w"> </span><span class="p">(</span><span class="n">surface</span><span class="p">);</span>

<span class="w">  </span><span class="n">cairo_set_source_rgb</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">cairo_paint</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>

<span class="w">  </span><span class="n">cairo_destroy</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Create a new surface of the appropriate size to store our scribbles */</span>
<span class="k">static</span><span class="w"> </span><span class="n">gboolean</span>
<span class="nf">configure_event_cb</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w">         </span><span class="o">*</span><span class="n">widget</span><span class="p">,</span>
<span class="w">                    </span><span class="n">GdkEventConfigure</span><span class="w"> </span><span class="o">*</span><span class="n">event</span><span class="p">,</span>
<span class="w">                    </span><span class="n">gpointer</span><span class="w">           </span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">surface</span><span class="p">)</span>
<span class="w">    </span><span class="n">cairo_surface_destroy</span><span class="w"> </span><span class="p">(</span><span class="n">surface</span><span class="p">);</span>

<span class="w">  </span><span class="n">surface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdk_window_create_similar_surface</span><span class="w"> </span><span class="p">(</span><span class="n">gtk_widget_get_window</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">),</span>
<span class="w">                                               </span><span class="n">CAIRO_CONTENT_COLOR</span><span class="p">,</span>
<span class="w">                                               </span><span class="n">gtk_widget_get_allocated_width</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">),</span>
<span class="w">                                               </span><span class="n">gtk_widget_get_allocated_height</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">));</span>

<span class="w">  </span><span class="cm">/* Initialize the surface to white */</span>
<span class="w">  </span><span class="n">clear_surface</span><span class="w"> </span><span class="p">();</span>

<span class="w">  </span><span class="cm">/* We&#39;ve handled the configure event, no need for further processing. */</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Redraw the screen from the surface. Note that the ::draw</span>
<span class="cm"> * signal receives a ready-to-be-used cairo_t that is already</span>
<span class="cm"> * clipped to only draw the exposed areas of the widget</span>
<span class="cm"> */</span>
<span class="k">static</span><span class="w"> </span><span class="n">gboolean</span>
<span class="nf">draw_cb</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">widget</span><span class="p">,</span>
<span class="w">         </span><span class="n">cairo_t</span><span class="w">   </span><span class="o">*</span><span class="n">cr</span><span class="p">,</span>
<span class="w">         </span><span class="n">gpointer</span><span class="w">   </span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">cairo_set_source_surface</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">,</span><span class="w"> </span><span class="n">surface</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">cairo_paint</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Draw a rectangle on the surface at the given position */</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">draw_brush</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">widget</span><span class="p">,</span>
<span class="w">            </span><span class="n">gdouble</span><span class="w">    </span><span class="n">x</span><span class="p">,</span>
<span class="w">            </span><span class="n">gdouble</span><span class="w">    </span><span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">cairo_t</span><span class="w"> </span><span class="o">*</span><span class="n">cr</span><span class="p">;</span>

<span class="w">  </span><span class="cm">/* Paint to the surface, where we store our state */</span>
<span class="w">  </span><span class="n">cr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cairo_create</span><span class="w"> </span><span class="p">(</span><span class="n">surface</span><span class="p">);</span>

<span class="w">  </span><span class="n">cairo_rectangle</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
<span class="w">  </span><span class="n">cairo_fill</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>

<span class="w">  </span><span class="n">cairo_destroy</span><span class="w"> </span><span class="p">(</span><span class="n">cr</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Now invalidate the affected region of the drawing area. */</span>
<span class="w">  </span><span class="n">gtk_widget_queue_draw_area</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Handle button press events by either drawing a rectangle</span>
<span class="cm"> * or clearing the surface, depending on which button was pressed.</span>
<span class="cm"> * The ::button-press signal handler receives a GdkEventButton</span>
<span class="cm"> * struct which contains this information.</span>
<span class="cm"> */</span>
<span class="k">static</span><span class="w"> </span><span class="n">gboolean</span>
<span class="nf">button_press_event_cb</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w">      </span><span class="o">*</span><span class="n">widget</span><span class="p">,</span>
<span class="w">                       </span><span class="n">GdkEventButton</span><span class="w"> </span><span class="o">*</span><span class="n">event</span><span class="p">,</span>
<span class="w">                       </span><span class="n">gpointer</span><span class="w">        </span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="cm">/* paranoia check, in case we haven&#39;t gotten a configure event */</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">surface</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FALSE</span><span class="p">;</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">button</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GDK_BUTTON_PRIMARY</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">draw_brush</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">,</span><span class="w"> </span><span class="n">event</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">event</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">button</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GDK_BUTTON_SECONDARY</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">clear_surface</span><span class="w"> </span><span class="p">();</span>
<span class="w">      </span><span class="n">gtk_widget_queue_draw</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="cm">/* We&#39;ve handled the event, stop processing */</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Handle motion events by continuing to draw if button 1 is</span>
<span class="cm"> * still held down. The ::motion-notify signal handler receives</span>
<span class="cm"> * a GdkEventMotion struct which contains this information.</span>
<span class="cm"> */</span>
<span class="k">static</span><span class="w"> </span><span class="n">gboolean</span>
<span class="nf">motion_notify_event_cb</span><span class="w"> </span><span class="p">(</span><span class="n">GtkWidget</span><span class="w">      </span><span class="o">*</span><span class="n">widget</span><span class="p">,</span>
<span class="w">                        </span><span class="n">GdkEventMotion</span><span class="w"> </span><span class="o">*</span><span class="n">event</span><span class="p">,</span>
<span class="w">                        </span><span class="n">gpointer</span><span class="w">        </span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="cm">/* paranoia check, in case we haven&#39;t gotten a configure event */</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">surface</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FALSE</span><span class="p">;</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">GDK_BUTTON1_MASK</span><span class="p">)</span>
<span class="w">    </span><span class="n">draw_brush</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="p">,</span><span class="w"> </span><span class="n">event</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">event</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* We&#39;ve handled it, stop processing */</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">close_window</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">surface</span><span class="p">)</span>
<span class="w">    </span><span class="n">cairo_surface_destroy</span><span class="w"> </span><span class="p">(</span><span class="n">surface</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">activate</span><span class="w"> </span><span class="p">(</span><span class="n">GtkApplication</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">,</span>
<span class="w">          </span><span class="n">gpointer</span><span class="w">        </span><span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">window</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">frame</span><span class="p">;</span>
<span class="w">  </span><span class="n">GtkWidget</span><span class="w"> </span><span class="o">*</span><span class="n">drawing_area</span><span class="p">;</span>

<span class="w">  </span><span class="n">window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_application_window_new</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_window_set_title</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_WINDOW</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Drawing Area&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="n">g_signal_connect</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;destroy&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="w"> </span><span class="p">(</span><span class="n">close_window</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_container_set_border_width</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_CONTAINER</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">),</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>

<span class="w">  </span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_frame_new</span><span class="w"> </span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_frame_set_shadow_type</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_FRAME</span><span class="w"> </span><span class="p">(</span><span class="n">frame</span><span class="p">),</span><span class="w"> </span><span class="n">GTK_SHADOW_IN</span><span class="p">);</span>
<span class="w">  </span><span class="n">gtk_container_add</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_CONTAINER</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">),</span><span class="w"> </span><span class="n">frame</span><span class="p">);</span>

<span class="w">  </span><span class="n">drawing_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_drawing_area_new</span><span class="w"> </span><span class="p">();</span>
<span class="w">  </span><span class="cm">/* set a minimum size */</span>
<span class="w">  </span><span class="n">gtk_widget_set_size_request</span><span class="w"> </span><span class="p">(</span><span class="n">drawing_area</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_container_add</span><span class="w"> </span><span class="p">(</span><span class="n">GTK_CONTAINER</span><span class="w"> </span><span class="p">(</span><span class="n">frame</span><span class="p">),</span><span class="w"> </span><span class="n">drawing_area</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Signals used to handle the backing surface */</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="w"> </span><span class="p">(</span><span class="n">drawing_area</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;draw&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">G_CALLBACK</span><span class="w"> </span><span class="p">(</span><span class="n">draw_cb</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="w"> </span><span class="p">(</span><span class="n">drawing_area</span><span class="p">,</span><span class="s">&quot;configure-event&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">G_CALLBACK</span><span class="w"> </span><span class="p">(</span><span class="n">configure_event_cb</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Event signals */</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="w"> </span><span class="p">(</span><span class="n">drawing_area</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;motion-notify-event&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">G_CALLBACK</span><span class="w"> </span><span class="p">(</span><span class="n">motion_notify_event_cb</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="w"> </span><span class="p">(</span><span class="n">drawing_area</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;button-press-event&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">G_CALLBACK</span><span class="w"> </span><span class="p">(</span><span class="n">button_press_event_cb</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="cm">/* Ask to receive events the drawing area doesn&#39;t normally</span>
<span class="cm">   * subscribe to. In particular, we need to ask for the</span>
<span class="cm">   * button press and motion notify events that want to handle.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="n">gtk_widget_set_events</span><span class="w"> </span><span class="p">(</span><span class="n">drawing_area</span><span class="p">,</span><span class="w"> </span><span class="n">gtk_widget_get_events</span><span class="w"> </span><span class="p">(</span><span class="n">drawing_area</span><span class="p">)</span>
<span class="w">                                     </span><span class="o">|</span><span class="w"> </span><span class="n">GDK_BUTTON_PRESS_MASK</span>
<span class="w">                                     </span><span class="o">|</span><span class="w"> </span><span class="n">GDK_POINTER_MOTION_MASK</span><span class="p">);</span>

<span class="w">  </span><span class="n">gtk_widget_show_all</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w">    </span><span class="n">argc</span><span class="p">,</span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">GtkApplication</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>

<span class="w">  </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gtk_application_new</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;org.gtk.example&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_APPLICATION_FLAGS_NONE</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_signal_connect</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;activate&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">G_CALLBACK</span><span class="w"> </span><span class="p">(</span><span class="n">activate</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g_application_run</span><span class="w"> </span><span class="p">(</span><span class="n">G_APPLICATION</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">),</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<span class="w">  </span><span class="n">g_object_unref</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>You can compile the program above with <span class="caps">GCC</span>&nbsp;using:</p>
<div class="codehilite"><pre><span></span><code>gcc `pkg-config --cflags gtk+-3.0` -o example-4 example-4.c `pkg-config --libs gtk+-3.0`
</code></pre></div>
    </div>
  </section>
</section>


    
<div id="toc" class="toc">
  <nav aria-labelledby="toc-title">
    <p id="toc-title">Content</p>
    <ul class="toc-list">
      
        
        <li class="toc-list-item"><a href="getting_started.html#basics"><span class="link-text">Basics</span></a></li>
          
        
        <li class="toc-list-item"><a href="getting_started.html#packing"><span class="link-text">Packing</span></a></li>
          
        
        <li class="toc-list-item"><a href="getting_started.html#building-user-interfaces"><span class="link-text">Building user interfaces</span></a></li>
          
        
        <li class="toc-list-item"><a href="getting_started.html#building-applications"><span class="link-text">Building applications</span></a></li>
          
          <ul class="toc-list">
          
            <li class="toc-list-item"><a href="getting_started.html#a-trivial-application"><span class="link-text">A trivial application</span></a></li>
          
            <li class="toc-list-item"><a href="getting_started.html#populating-the-window"><span class="link-text">Populating the window</span></a></li>
          
            <li class="toc-list-item"><a href="getting_started.html#opening-files"><span class="link-text">Opening files</span></a></li>
          
            <li class="toc-list-item"><a href="getting_started.html#an-application-menu"><span class="link-text">An application menu</span></a></li>
          
            <li class="toc-list-item"><a href="getting_started.html#a-preference-dialog"><span class="link-text">A preference dialog</span></a></li>
          
            <li class="toc-list-item"><a href="getting_started.html#adding-a-search-bar"><span class="link-text">Adding a search bar</span></a></li>
          
            <li class="toc-list-item"><a href="getting_started.html#adding-a-side-bar"><span class="link-text">Adding a side bar</span></a></li>
          
            <li class="toc-list-item"><a href="getting_started.html#properties"><span class="link-text">Properties</span></a></li>
          
            <li class="toc-list-item"><a href="getting_started.html#header-bar"><span class="link-text">Header bar</span></a></li>
          
          </ul>
          
        
        <li class="toc-list-item"><a href="getting_started.html#custom-drawing"><span class="link-text">Custom drawing</span></a></li>
          
        
      
    </ul>
  </nav>
</div>


    <section id="search" class="content hidden"></section>

    <footer>
    
    </footer>
  </div>
</body>
</html>